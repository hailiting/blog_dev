(window.webpackJsonp=window.webpackJsonp||[]).push([[26],{309:function(t,s,a){t.exports=a.p+"assets/img/node_event_loop.3491359f.png"},554:function(t,s,a){"use strict";a.r(s);var n=a(44),e=Object(n.a)({},(function(){var t=this,s=t.$createElement,n=t._self._c||s;return n("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[n("h1",{attrs:{id:"nodejs-项目架构与优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#nodejs-项目架构与优化"}},[t._v("#")]),t._v(" nodejs 项目架构与优化")]),t._v(" "),n("h2",{attrs:{id:"spa-和-mpa"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#spa-和-mpa"}},[t._v("#")]),t._v(" SPA 和 MPA")]),t._v(" "),n("p",[t._v("MPA(SSR) -> spa + (csr) mpa -> mpa -> spa")]),t._v(" "),n("h3",{attrs:{id:"spa-单页应用-singlepage-application"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#spa-单页应用-singlepage-application"}},[t._v("#")]),t._v(" SPA 单页应用 SinglePage Application")]),t._v(" "),n("ul",[n("li",[t._v("指只有一个主页面的应用，一开始只需要加载一次 js,css 等资源。所有资源都包含在主页面，对每个功能模块组件化。单页应用的跳转，就是组件之间的切换，只刷新局部资源。")])]),t._v(" "),n("h3",{attrs:{id:"mpa-multipage-application"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#mpa-multipage-application"}},[t._v("#")]),t._v(" MPA MultiPage Application")]),t._v(" "),n("ul",[n("li",[t._v("指有多个独立的页面的应用，每个页面必须重复加载 js,css 等资源。多页应用跳转需要整个资源的刷新。")])]),t._v(" "),n("h3",{attrs:{id:"单页应用项目过大-首页加载慢的优化策略"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#单页应用项目过大-首页加载慢的优化策略"}},[t._v("#")]),t._v(" 单页应用项目过大，首页加载慢的优化策略")]),t._v(" "),n("ul",[n("li",[t._v("使用 CDN 资源，减小服务器的宽带压力")]),t._v(" "),n("li",[t._v("路由懒加载")]),t._v(" "),n("li",[t._v("将一些静态 js,css 放到其他地方（如 OSS），减小服务器压力")]),t._v(" "),n("li",[t._v("按需加载三方资源，如 View,按需引入 View 中的组件")]),t._v(" "),n("li",[t._v("使用 nginx 开启 Gzip 减小网络传输的流量大小")]),t._v(" "),n("li",[t._v("webpack 开启 gzip 压缩")]),t._v(" "),n("li",[t._v("若首屏为登录页，可做多入口，登录页单独分离为一个入口")]),t._v(" "),n("li",[t._v("SSR 渲染")])]),t._v(" "),n("h3",{attrs:{id:"ssr-渲染"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#ssr-渲染"}},[t._v("#")]),t._v(" SSR 渲染")]),t._v(" "),n("ul",[n("li",[t._v("简单理解为将组件或页面通过服务器生成 HTML 字符串，再发送到浏览器，最后将静态标记为"),n("code",[t._v("混合")]),t._v("为客户端上完全交互的应用程序。")]),t._v(" "),n("li",[t._v("更快的响应时间")]),t._v(" "),n("li",[t._v("更好的 SEO")])]),t._v(" "),n("h4",{attrs:{id:"缺点"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#缺点"}},[t._v("#")]),t._v(" 缺点")]),t._v(" "),n("ul",[n("li",[t._v("相对于仅需要提供静态文件的服务器，SSR 中使用的渲染程序会更占用 CPU 和内存等资源")]),t._v(" "),n("li",[t._v("一些常用的浏览器 API 可能要加环境判断在使用，如 window, document, alert 等")]),t._v(" "),n("li",[t._v("开发调试会复杂一点")]),t._v(" "),n("li",[t._v("可能一些原因导致服务端和浏览器端渲染的结果不一致")])]),t._v(" "),n("h2",{attrs:{id:"node-异步-io-原理及优化"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node-异步-io-原理及优化"}},[t._v("#")]),t._v(" node 异步 IO 原理及优化")]),t._v(" "),n("h3",{attrs:{id:"node-对异步-io-的实现"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#node-对异步-io-的实现"}},[t._v("#")]),t._v(" Node 对异步 IO 的实现")]),t._v(" "),n("p",[t._v("完美的异步 IO 应该是应用程序发起非阻塞调用，无需通过遍历或事件循环等方式轮询")]),t._v(" "),n("p",[n("img",{attrs:{src:a(309),alt:"node_event_loop"}})]),t._v(" "),n("ul",[n("li",[t._v("nodejs 事件处理机制")]),t._v(" "),n("li",[t._v("js 解析先后顺序")])]),t._v(" "),n("h3",{attrs:{id:"几个特殊的-api"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#几个特殊的-api"}},[t._v("#")]),t._v(" 几个特殊的 API")]),t._v(" "),n("ul",[n("li",[n("code",[t._v("setTimeout")]),t._v("和"),n("code",[t._v("setInterval")]),t._v("线程池不参与")]),t._v(" "),n("li",[n("code",[t._v("process.nextTick()")]),t._v("实现类似"),n("code",[t._v("setTimeout(function(){},0)")]),t._v("，每次调用放入队列中，在下一轮循环中取出。")]),t._v(" "),n("li",[n("code",[t._v("setImmdiate()")]),t._v("比"),n("code",[t._v("process.nextTick()")]),t._v("优先级低")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("sleep")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("time")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("return")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v("resolve"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" time"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),t._v("\n\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("setImmediate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("Promise")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token parameter"}},[t._v("resolve"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" reject")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("4")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n  "),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("5")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nconsole"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("6")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nprocess"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("nextTick")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=>")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\n  console"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token number"}},[t._v("7")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[t._v("// 3 4 6 7 5  1 2")]),t._v("\n")])])]),n("h2",{attrs:{id:"函数式编程在-node-中的应用"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#函数式编程在-node-中的应用"}},[t._v("#")]),t._v(" 函数式编程在 Node 中的应用")]),t._v(" "),n("ul",[n("li",[t._v("高阶函数：可以将函数作为输入或返回值，形成一种后续传递风格的结果接受方式，而非单一的 返回值形式，而非单一的返回值形式。后续传递风格的程序将函数业务重点从返回值传递到回调函数中。")])]),t._v(" "),n("div",{staticClass:"language-js extra-class"},[n("pre",{pre:!0,attrs:{class:"language-js"}},[n("code",[t._v("app"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("use")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("var")]),t._v(" emitter "),n("span",{pre:!0,attrs:{class:"token operator"}},[t._v("=")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("new")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[t._v("event"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),t._v("eventEmitter")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\nemitter"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[t._v("on")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])])]),n("ul",[n("li",[t._v("偏函数：指定部分参数产生一个新的定制函数的形式就是偏函数。node 中异步编程非常常见，我们通过哨兵变量会造成业务混乱，"),n("code",[t._v("underscore")]),t._v(" "),n("code",[t._v("after")]),t._v("变量")])]),t._v(" "),n("h2",{attrs:{id:"常见的-node-控制异步技术手段"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#常见的-node-控制异步技术手段"}},[t._v("#")]),t._v(" 常见的 node 控制异步技术手段")]),t._v(" "),n("ul",[n("li",[t._v("step, wind, bigpipe, Q.js")]),t._v(" "),n("li",[t._v("asynic awit")]),t._v(" "),n("li",[t._v("promise/defferred 是一种先执行异步调用，延迟传递的方式。Promise 是高级接口，事件是低级接口。低级接口可以构建更多复杂的场景，高级接口一旦定义，不太容易变化，不再有低级接口的灵活性。")]),t._v(" "),n("li",[t._v("一个程序可以包含多个协程，可以对比一个进程包含多个线程来比较协程和线程。多个线程相对独立，由系统控制，而协程相对独立，有自己的上下文，但其切换由自己控制，由当前协程切换到其他协程由当前协程来控制")]),t._v(" "),n("li",[t._v("node 基于 v8，目前不支持协程。")])]),t._v(" "),n("p",[t._v("io 密集型")]),t._v(" "),n("p",[t._v("不适应 CPU 密集型")]),t._v(" "),n("ul",[n("li",[t._v("线程上")]),t._v(" "),n("li",[t._v("解释型和编译型")])]),t._v(" "),n("p",[t._v("cpu -> 计算\nio -> 流量")]),t._v(" "),n("p",[t._v("LIBUV\niocp")]),t._v(" "),n("p",[t._v("不占用系统的事件描述符")]),t._v(" "),n("p",[t._v("linux 自定义的线程池\nwindows LCP")]),t._v(" "),n("p",[t._v("进程 线程")]),t._v(" "),n("p",[t._v("本机 pm2\n网络 nginx")]),t._v(" "),n("p",[t._v("Nginx LVS 负载均衡 - 心跳包\npm2-> varnish / stupid\n-> CDN\nvarnish->java -> md-> 读/写 -> 冷热")]),t._v(" "),n("p",[t._v("throw new Error")])])}),[],!1,null,null,null);s.default=e.exports}}]);