<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>ReactChardingViewsocket | hailiting Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog_dev/logo.png">
    <meta name="description" content="hailiting Blog">
    
    <link rel="preload" href="/blog_dev/assets/css/0.styles.e9faf17d.css" as="style"><link rel="preload" href="/blog_dev/assets/js/app.709da227.js" as="script"><link rel="preload" href="/blog_dev/assets/js/2.556b46b5.js" as="script"><link rel="preload" href="/blog_dev/assets/js/169.67440797.js" as="script"><link rel="prefetch" href="/blog_dev/assets/js/10.d061a1d9.js"><link rel="prefetch" href="/blog_dev/assets/js/100.0c7b74b5.js"><link rel="prefetch" href="/blog_dev/assets/js/101.63725a21.js"><link rel="prefetch" href="/blog_dev/assets/js/102.a0aa8352.js"><link rel="prefetch" href="/blog_dev/assets/js/103.3f4859f8.js"><link rel="prefetch" href="/blog_dev/assets/js/104.c375d9a0.js"><link rel="prefetch" href="/blog_dev/assets/js/105.3ab4f216.js"><link rel="prefetch" href="/blog_dev/assets/js/106.39c53827.js"><link rel="prefetch" href="/blog_dev/assets/js/107.f2a28572.js"><link rel="prefetch" href="/blog_dev/assets/js/108.dba8d9ec.js"><link rel="prefetch" href="/blog_dev/assets/js/109.be1a59c4.js"><link rel="prefetch" href="/blog_dev/assets/js/11.1fac2bc6.js"><link rel="prefetch" href="/blog_dev/assets/js/110.4e9a9fb3.js"><link rel="prefetch" href="/blog_dev/assets/js/111.e70ebf37.js"><link rel="prefetch" href="/blog_dev/assets/js/112.c2acf0c5.js"><link rel="prefetch" href="/blog_dev/assets/js/113.2c4c2f15.js"><link rel="prefetch" href="/blog_dev/assets/js/114.395922dd.js"><link rel="prefetch" href="/blog_dev/assets/js/115.4bca9bf3.js"><link rel="prefetch" href="/blog_dev/assets/js/116.49621d87.js"><link rel="prefetch" href="/blog_dev/assets/js/117.16ada7ad.js"><link rel="prefetch" href="/blog_dev/assets/js/118.2565919e.js"><link rel="prefetch" href="/blog_dev/assets/js/119.c12bdd10.js"><link rel="prefetch" href="/blog_dev/assets/js/12.4576cc3f.js"><link rel="prefetch" href="/blog_dev/assets/js/120.7939ff97.js"><link rel="prefetch" href="/blog_dev/assets/js/121.c26e4264.js"><link rel="prefetch" href="/blog_dev/assets/js/122.50fc8ef5.js"><link rel="prefetch" href="/blog_dev/assets/js/123.ffe9a78f.js"><link rel="prefetch" href="/blog_dev/assets/js/124.5aee6dd1.js"><link rel="prefetch" href="/blog_dev/assets/js/125.11cf3383.js"><link rel="prefetch" href="/blog_dev/assets/js/126.b056850f.js"><link rel="prefetch" href="/blog_dev/assets/js/127.80bc5fff.js"><link rel="prefetch" href="/blog_dev/assets/js/128.afdd2e1e.js"><link rel="prefetch" href="/blog_dev/assets/js/129.bd933eb7.js"><link rel="prefetch" href="/blog_dev/assets/js/13.bc140e8c.js"><link rel="prefetch" href="/blog_dev/assets/js/130.a87b24d0.js"><link rel="prefetch" href="/blog_dev/assets/js/131.9127e428.js"><link rel="prefetch" href="/blog_dev/assets/js/132.5baa85a6.js"><link rel="prefetch" href="/blog_dev/assets/js/133.e6519713.js"><link rel="prefetch" href="/blog_dev/assets/js/134.dbdebdb7.js"><link rel="prefetch" href="/blog_dev/assets/js/135.50b8f3cc.js"><link rel="prefetch" href="/blog_dev/assets/js/136.c9731137.js"><link rel="prefetch" href="/blog_dev/assets/js/137.f57d3761.js"><link rel="prefetch" href="/blog_dev/assets/js/138.6a94bea2.js"><link rel="prefetch" href="/blog_dev/assets/js/139.cdff373d.js"><link rel="prefetch" href="/blog_dev/assets/js/14.d889f0ed.js"><link rel="prefetch" href="/blog_dev/assets/js/140.dd2e3ba1.js"><link rel="prefetch" href="/blog_dev/assets/js/141.7a915726.js"><link rel="prefetch" href="/blog_dev/assets/js/142.58a0db92.js"><link rel="prefetch" href="/blog_dev/assets/js/143.182403fc.js"><link rel="prefetch" href="/blog_dev/assets/js/144.dcd6bf77.js"><link rel="prefetch" href="/blog_dev/assets/js/145.d06933fa.js"><link rel="prefetch" href="/blog_dev/assets/js/146.fd698fa3.js"><link rel="prefetch" href="/blog_dev/assets/js/147.2eaef6d1.js"><link rel="prefetch" href="/blog_dev/assets/js/148.3e1c96ae.js"><link rel="prefetch" href="/blog_dev/assets/js/149.bb7c3714.js"><link rel="prefetch" href="/blog_dev/assets/js/15.4ca3d2e1.js"><link rel="prefetch" href="/blog_dev/assets/js/150.937db40c.js"><link rel="prefetch" href="/blog_dev/assets/js/151.e911967c.js"><link rel="prefetch" href="/blog_dev/assets/js/152.ba1a29a5.js"><link rel="prefetch" href="/blog_dev/assets/js/153.47a6243a.js"><link rel="prefetch" href="/blog_dev/assets/js/154.511b473a.js"><link rel="prefetch" href="/blog_dev/assets/js/155.b8cce54b.js"><link rel="prefetch" href="/blog_dev/assets/js/156.8898b2f9.js"><link rel="prefetch" href="/blog_dev/assets/js/157.5f06ed86.js"><link rel="prefetch" href="/blog_dev/assets/js/158.137235af.js"><link rel="prefetch" href="/blog_dev/assets/js/159.0e9ce62a.js"><link rel="prefetch" href="/blog_dev/assets/js/16.456961f6.js"><link rel="prefetch" href="/blog_dev/assets/js/160.38d855a7.js"><link rel="prefetch" href="/blog_dev/assets/js/161.3590c707.js"><link rel="prefetch" href="/blog_dev/assets/js/162.86630534.js"><link rel="prefetch" href="/blog_dev/assets/js/163.6e13f473.js"><link rel="prefetch" href="/blog_dev/assets/js/164.d1fb6be0.js"><link rel="prefetch" href="/blog_dev/assets/js/165.f60ddeb1.js"><link rel="prefetch" href="/blog_dev/assets/js/166.32edcf10.js"><link rel="prefetch" href="/blog_dev/assets/js/167.c186a3aa.js"><link rel="prefetch" href="/blog_dev/assets/js/168.b4d579ba.js"><link rel="prefetch" href="/blog_dev/assets/js/17.529aaf8b.js"><link rel="prefetch" href="/blog_dev/assets/js/170.9764038a.js"><link rel="prefetch" href="/blog_dev/assets/js/171.6f3a2180.js"><link rel="prefetch" href="/blog_dev/assets/js/172.519538bf.js"><link rel="prefetch" href="/blog_dev/assets/js/173.9f7d6b1c.js"><link rel="prefetch" href="/blog_dev/assets/js/174.135c3ff2.js"><link rel="prefetch" href="/blog_dev/assets/js/175.fad4b7cd.js"><link rel="prefetch" href="/blog_dev/assets/js/176.a7e8b342.js"><link rel="prefetch" href="/blog_dev/assets/js/177.bc7d98e9.js"><link rel="prefetch" href="/blog_dev/assets/js/178.013841ad.js"><link rel="prefetch" href="/blog_dev/assets/js/179.ea55a800.js"><link rel="prefetch" href="/blog_dev/assets/js/18.c501dfa3.js"><link rel="prefetch" href="/blog_dev/assets/js/180.3fc7fc18.js"><link rel="prefetch" href="/blog_dev/assets/js/181.00d79ee8.js"><link rel="prefetch" href="/blog_dev/assets/js/182.75ce3c02.js"><link rel="prefetch" href="/blog_dev/assets/js/183.a111b430.js"><link rel="prefetch" href="/blog_dev/assets/js/184.934f6bbd.js"><link rel="prefetch" href="/blog_dev/assets/js/185.fd9febdb.js"><link rel="prefetch" href="/blog_dev/assets/js/186.0a342597.js"><link rel="prefetch" href="/blog_dev/assets/js/187.9e4b1686.js"><link rel="prefetch" href="/blog_dev/assets/js/188.2989272b.js"><link rel="prefetch" href="/blog_dev/assets/js/189.f45e0987.js"><link rel="prefetch" href="/blog_dev/assets/js/19.d413d821.js"><link rel="prefetch" href="/blog_dev/assets/js/190.83d10781.js"><link rel="prefetch" href="/blog_dev/assets/js/191.2b4e0c89.js"><link rel="prefetch" href="/blog_dev/assets/js/192.48865ed5.js"><link rel="prefetch" href="/blog_dev/assets/js/193.c01826d8.js"><link rel="prefetch" href="/blog_dev/assets/js/194.74e50b36.js"><link rel="prefetch" href="/blog_dev/assets/js/195.aa29f582.js"><link rel="prefetch" href="/blog_dev/assets/js/196.aca00a42.js"><link rel="prefetch" href="/blog_dev/assets/js/197.40b2c10e.js"><link rel="prefetch" href="/blog_dev/assets/js/198.33842e64.js"><link rel="prefetch" href="/blog_dev/assets/js/199.29e6325b.js"><link rel="prefetch" href="/blog_dev/assets/js/20.c89e4367.js"><link rel="prefetch" href="/blog_dev/assets/js/200.a7bce9d6.js"><link rel="prefetch" href="/blog_dev/assets/js/201.5025c6d3.js"><link rel="prefetch" href="/blog_dev/assets/js/202.c99897b4.js"><link rel="prefetch" href="/blog_dev/assets/js/203.347f1189.js"><link rel="prefetch" href="/blog_dev/assets/js/204.8de572ee.js"><link rel="prefetch" href="/blog_dev/assets/js/205.45483b34.js"><link rel="prefetch" href="/blog_dev/assets/js/206.c31290f0.js"><link rel="prefetch" href="/blog_dev/assets/js/207.e3f41a9a.js"><link rel="prefetch" href="/blog_dev/assets/js/208.d0dfd243.js"><link rel="prefetch" href="/blog_dev/assets/js/209.995ec2cb.js"><link rel="prefetch" href="/blog_dev/assets/js/21.25b239e1.js"><link rel="prefetch" href="/blog_dev/assets/js/210.e7965c3a.js"><link rel="prefetch" href="/blog_dev/assets/js/211.6b257aba.js"><link rel="prefetch" href="/blog_dev/assets/js/212.4a1cc3ec.js"><link rel="prefetch" href="/blog_dev/assets/js/213.31f8bf45.js"><link rel="prefetch" href="/blog_dev/assets/js/214.313c7b41.js"><link rel="prefetch" href="/blog_dev/assets/js/215.ee241838.js"><link rel="prefetch" href="/blog_dev/assets/js/216.3543cf04.js"><link rel="prefetch" href="/blog_dev/assets/js/217.0d6ea85b.js"><link rel="prefetch" href="/blog_dev/assets/js/218.80640071.js"><link rel="prefetch" href="/blog_dev/assets/js/219.151cb78a.js"><link rel="prefetch" href="/blog_dev/assets/js/22.d89f4d90.js"><link rel="prefetch" href="/blog_dev/assets/js/220.0eae0afd.js"><link rel="prefetch" href="/blog_dev/assets/js/221.8f8817b7.js"><link rel="prefetch" href="/blog_dev/assets/js/222.ae4bc9b6.js"><link rel="prefetch" href="/blog_dev/assets/js/223.a7aed6fa.js"><link rel="prefetch" href="/blog_dev/assets/js/224.025821c5.js"><link rel="prefetch" href="/blog_dev/assets/js/225.97d213b8.js"><link rel="prefetch" href="/blog_dev/assets/js/226.4578e374.js"><link rel="prefetch" href="/blog_dev/assets/js/227.dfd2b951.js"><link rel="prefetch" href="/blog_dev/assets/js/228.f25dfcc5.js"><link rel="prefetch" href="/blog_dev/assets/js/229.49de06f2.js"><link rel="prefetch" href="/blog_dev/assets/js/23.37517448.js"><link rel="prefetch" href="/blog_dev/assets/js/230.74de1167.js"><link rel="prefetch" href="/blog_dev/assets/js/231.109f1608.js"><link rel="prefetch" href="/blog_dev/assets/js/232.b199ca54.js"><link rel="prefetch" href="/blog_dev/assets/js/233.e5505590.js"><link rel="prefetch" href="/blog_dev/assets/js/234.540cc14b.js"><link rel="prefetch" href="/blog_dev/assets/js/235.2c3a6404.js"><link rel="prefetch" href="/blog_dev/assets/js/236.7b387bc5.js"><link rel="prefetch" href="/blog_dev/assets/js/237.739ab0f9.js"><link rel="prefetch" href="/blog_dev/assets/js/238.fac109c9.js"><link rel="prefetch" href="/blog_dev/assets/js/239.1e997e2c.js"><link rel="prefetch" href="/blog_dev/assets/js/24.8c152fef.js"><link rel="prefetch" href="/blog_dev/assets/js/240.0b145d5f.js"><link rel="prefetch" href="/blog_dev/assets/js/241.09c4ce68.js"><link rel="prefetch" href="/blog_dev/assets/js/242.1e13a030.js"><link rel="prefetch" href="/blog_dev/assets/js/243.306372f7.js"><link rel="prefetch" href="/blog_dev/assets/js/244.63184878.js"><link rel="prefetch" href="/blog_dev/assets/js/245.8bcac252.js"><link rel="prefetch" href="/blog_dev/assets/js/246.99622cb5.js"><link rel="prefetch" href="/blog_dev/assets/js/247.34bd3960.js"><link rel="prefetch" href="/blog_dev/assets/js/248.2861f31a.js"><link rel="prefetch" href="/blog_dev/assets/js/249.6f62b76b.js"><link rel="prefetch" href="/blog_dev/assets/js/25.3bd7dbd6.js"><link rel="prefetch" href="/blog_dev/assets/js/250.441d1201.js"><link rel="prefetch" href="/blog_dev/assets/js/251.d1e30efd.js"><link rel="prefetch" href="/blog_dev/assets/js/252.1b993b77.js"><link rel="prefetch" href="/blog_dev/assets/js/253.7dd3cb2d.js"><link rel="prefetch" href="/blog_dev/assets/js/254.08d6a027.js"><link rel="prefetch" href="/blog_dev/assets/js/255.a95d32c3.js"><link rel="prefetch" href="/blog_dev/assets/js/256.4c0097ae.js"><link rel="prefetch" href="/blog_dev/assets/js/257.ccef358b.js"><link rel="prefetch" href="/blog_dev/assets/js/258.fcccb1d9.js"><link rel="prefetch" href="/blog_dev/assets/js/259.8c4e2a5b.js"><link rel="prefetch" href="/blog_dev/assets/js/26.357db678.js"><link rel="prefetch" href="/blog_dev/assets/js/260.45184866.js"><link rel="prefetch" href="/blog_dev/assets/js/261.57d645d4.js"><link rel="prefetch" href="/blog_dev/assets/js/262.cec8a62e.js"><link rel="prefetch" href="/blog_dev/assets/js/263.e8923920.js"><link rel="prefetch" href="/blog_dev/assets/js/264.37b490f7.js"><link rel="prefetch" href="/blog_dev/assets/js/265.ee7b00f6.js"><link rel="prefetch" href="/blog_dev/assets/js/266.0c31de3b.js"><link rel="prefetch" href="/blog_dev/assets/js/267.62925b15.js"><link rel="prefetch" href="/blog_dev/assets/js/268.6069bb2b.js"><link rel="prefetch" href="/blog_dev/assets/js/269.3c64c573.js"><link rel="prefetch" href="/blog_dev/assets/js/27.64c767de.js"><link rel="prefetch" href="/blog_dev/assets/js/270.ff44d5ab.js"><link rel="prefetch" href="/blog_dev/assets/js/271.de3eed75.js"><link rel="prefetch" href="/blog_dev/assets/js/272.9d9b6f12.js"><link rel="prefetch" href="/blog_dev/assets/js/273.b66c0be1.js"><link rel="prefetch" href="/blog_dev/assets/js/274.4d1bfedc.js"><link rel="prefetch" href="/blog_dev/assets/js/275.b7eceff6.js"><link rel="prefetch" href="/blog_dev/assets/js/276.eccd169a.js"><link rel="prefetch" href="/blog_dev/assets/js/277.a3a88438.js"><link rel="prefetch" href="/blog_dev/assets/js/278.22309baf.js"><link rel="prefetch" href="/blog_dev/assets/js/279.4373be14.js"><link rel="prefetch" href="/blog_dev/assets/js/28.0eaddbe2.js"><link rel="prefetch" href="/blog_dev/assets/js/280.bd9fb67f.js"><link rel="prefetch" href="/blog_dev/assets/js/281.2d9a98be.js"><link rel="prefetch" href="/blog_dev/assets/js/282.b90e372b.js"><link rel="prefetch" href="/blog_dev/assets/js/283.ec34c046.js"><link rel="prefetch" href="/blog_dev/assets/js/284.512f07f4.js"><link rel="prefetch" href="/blog_dev/assets/js/285.84d0ed1e.js"><link rel="prefetch" href="/blog_dev/assets/js/286.433c7816.js"><link rel="prefetch" href="/blog_dev/assets/js/287.0d3753f9.js"><link rel="prefetch" href="/blog_dev/assets/js/288.1c8d7744.js"><link rel="prefetch" href="/blog_dev/assets/js/289.476af6b9.js"><link rel="prefetch" href="/blog_dev/assets/js/29.5dd473c0.js"><link rel="prefetch" href="/blog_dev/assets/js/290.cbc40d8f.js"><link rel="prefetch" href="/blog_dev/assets/js/291.8346da5f.js"><link rel="prefetch" href="/blog_dev/assets/js/292.7384b627.js"><link rel="prefetch" href="/blog_dev/assets/js/293.63d74868.js"><link rel="prefetch" href="/blog_dev/assets/js/294.1410f408.js"><link rel="prefetch" href="/blog_dev/assets/js/295.952ce9ba.js"><link rel="prefetch" href="/blog_dev/assets/js/296.991a0da7.js"><link rel="prefetch" href="/blog_dev/assets/js/297.ec2fb727.js"><link rel="prefetch" href="/blog_dev/assets/js/298.c43e6ee0.js"><link rel="prefetch" href="/blog_dev/assets/js/299.02e81e03.js"><link rel="prefetch" href="/blog_dev/assets/js/3.bb975429.js"><link rel="prefetch" href="/blog_dev/assets/js/30.351b19a1.js"><link rel="prefetch" href="/blog_dev/assets/js/300.e4df5ed6.js"><link rel="prefetch" href="/blog_dev/assets/js/301.224fc9b4.js"><link rel="prefetch" href="/blog_dev/assets/js/302.ed9189c5.js"><link rel="prefetch" href="/blog_dev/assets/js/303.f0b78d10.js"><link rel="prefetch" href="/blog_dev/assets/js/304.6ec9ed66.js"><link rel="prefetch" href="/blog_dev/assets/js/305.c579e253.js"><link rel="prefetch" href="/blog_dev/assets/js/306.ac462491.js"><link rel="prefetch" href="/blog_dev/assets/js/307.abcd03c4.js"><link rel="prefetch" href="/blog_dev/assets/js/308.401c1772.js"><link rel="prefetch" href="/blog_dev/assets/js/309.84e52cc8.js"><link rel="prefetch" href="/blog_dev/assets/js/31.92bd6220.js"><link rel="prefetch" href="/blog_dev/assets/js/310.838924a1.js"><link rel="prefetch" href="/blog_dev/assets/js/311.c2d70590.js"><link rel="prefetch" href="/blog_dev/assets/js/312.892f867d.js"><link rel="prefetch" href="/blog_dev/assets/js/313.3f307c3e.js"><link rel="prefetch" href="/blog_dev/assets/js/314.a3ea90d5.js"><link rel="prefetch" href="/blog_dev/assets/js/315.6b095340.js"><link rel="prefetch" href="/blog_dev/assets/js/316.4f5b4c9b.js"><link rel="prefetch" href="/blog_dev/assets/js/317.66641d59.js"><link rel="prefetch" href="/blog_dev/assets/js/318.652dafd2.js"><link rel="prefetch" href="/blog_dev/assets/js/319.8dd6b519.js"><link rel="prefetch" href="/blog_dev/assets/js/32.fde56041.js"><link rel="prefetch" href="/blog_dev/assets/js/320.1fca28a4.js"><link rel="prefetch" href="/blog_dev/assets/js/321.6a52b165.js"><link rel="prefetch" href="/blog_dev/assets/js/322.4e9919d1.js"><link rel="prefetch" href="/blog_dev/assets/js/323.8a96f35f.js"><link rel="prefetch" href="/blog_dev/assets/js/324.590862d1.js"><link rel="prefetch" href="/blog_dev/assets/js/33.43b6d3a3.js"><link rel="prefetch" href="/blog_dev/assets/js/34.7ba26882.js"><link rel="prefetch" href="/blog_dev/assets/js/35.dd4ed088.js"><link rel="prefetch" href="/blog_dev/assets/js/36.114c5ba1.js"><link rel="prefetch" href="/blog_dev/assets/js/37.1952dd28.js"><link rel="prefetch" href="/blog_dev/assets/js/38.da914b09.js"><link rel="prefetch" href="/blog_dev/assets/js/39.7e26b7b2.js"><link rel="prefetch" href="/blog_dev/assets/js/4.47949fe2.js"><link rel="prefetch" href="/blog_dev/assets/js/40.b53ac1b8.js"><link rel="prefetch" href="/blog_dev/assets/js/41.ae8b1f98.js"><link rel="prefetch" href="/blog_dev/assets/js/42.479e9251.js"><link rel="prefetch" href="/blog_dev/assets/js/43.91d2fa5d.js"><link rel="prefetch" href="/blog_dev/assets/js/44.45a27817.js"><link rel="prefetch" href="/blog_dev/assets/js/45.9ba1f8c4.js"><link rel="prefetch" href="/blog_dev/assets/js/46.2eae6d1e.js"><link rel="prefetch" href="/blog_dev/assets/js/47.95b6f8e1.js"><link rel="prefetch" href="/blog_dev/assets/js/48.f0161ea5.js"><link rel="prefetch" href="/blog_dev/assets/js/49.5d642580.js"><link rel="prefetch" href="/blog_dev/assets/js/5.0ac632f7.js"><link rel="prefetch" href="/blog_dev/assets/js/50.8bd7a35f.js"><link rel="prefetch" href="/blog_dev/assets/js/51.56ae0cc4.js"><link rel="prefetch" href="/blog_dev/assets/js/52.ca920ca8.js"><link rel="prefetch" href="/blog_dev/assets/js/53.173c70ac.js"><link rel="prefetch" href="/blog_dev/assets/js/54.523b339d.js"><link rel="prefetch" href="/blog_dev/assets/js/55.ac75c90f.js"><link rel="prefetch" href="/blog_dev/assets/js/56.2e111d42.js"><link rel="prefetch" href="/blog_dev/assets/js/57.f51b48a0.js"><link rel="prefetch" href="/blog_dev/assets/js/58.1d77fc82.js"><link rel="prefetch" href="/blog_dev/assets/js/59.996c6ec0.js"><link rel="prefetch" href="/blog_dev/assets/js/6.7d92400c.js"><link rel="prefetch" href="/blog_dev/assets/js/60.9b1925f8.js"><link rel="prefetch" href="/blog_dev/assets/js/61.2622607d.js"><link rel="prefetch" href="/blog_dev/assets/js/62.9960ec8b.js"><link rel="prefetch" href="/blog_dev/assets/js/63.cc80d5d8.js"><link rel="prefetch" href="/blog_dev/assets/js/64.cd9d858a.js"><link rel="prefetch" href="/blog_dev/assets/js/65.2e5ca607.js"><link rel="prefetch" href="/blog_dev/assets/js/66.8be3c4c0.js"><link rel="prefetch" href="/blog_dev/assets/js/67.1eefd7d5.js"><link rel="prefetch" href="/blog_dev/assets/js/68.adf762ce.js"><link rel="prefetch" href="/blog_dev/assets/js/69.27c95c35.js"><link rel="prefetch" href="/blog_dev/assets/js/7.01b296e3.js"><link rel="prefetch" href="/blog_dev/assets/js/70.5097ac5d.js"><link rel="prefetch" href="/blog_dev/assets/js/71.e261fe0c.js"><link rel="prefetch" href="/blog_dev/assets/js/72.d5582ca6.js"><link rel="prefetch" href="/blog_dev/assets/js/73.8c99b9a5.js"><link rel="prefetch" href="/blog_dev/assets/js/74.360f75b2.js"><link rel="prefetch" href="/blog_dev/assets/js/75.31152e1a.js"><link rel="prefetch" href="/blog_dev/assets/js/76.1e48dadb.js"><link rel="prefetch" href="/blog_dev/assets/js/77.0d614aa8.js"><link rel="prefetch" href="/blog_dev/assets/js/78.d6dc4f4b.js"><link rel="prefetch" href="/blog_dev/assets/js/79.50283d30.js"><link rel="prefetch" href="/blog_dev/assets/js/8.7983d5a6.js"><link rel="prefetch" href="/blog_dev/assets/js/80.a52496b7.js"><link rel="prefetch" href="/blog_dev/assets/js/81.ea8065b9.js"><link rel="prefetch" href="/blog_dev/assets/js/82.8bc4a3cc.js"><link rel="prefetch" href="/blog_dev/assets/js/83.7fe873c1.js"><link rel="prefetch" href="/blog_dev/assets/js/84.d65a2741.js"><link rel="prefetch" href="/blog_dev/assets/js/85.27a9c21c.js"><link rel="prefetch" href="/blog_dev/assets/js/86.6d7e13c8.js"><link rel="prefetch" href="/blog_dev/assets/js/87.858dd9e0.js"><link rel="prefetch" href="/blog_dev/assets/js/88.c0d83d71.js"><link rel="prefetch" href="/blog_dev/assets/js/89.c6b08127.js"><link rel="prefetch" href="/blog_dev/assets/js/9.f2a5f044.js"><link rel="prefetch" href="/blog_dev/assets/js/90.4338e0cf.js"><link rel="prefetch" href="/blog_dev/assets/js/91.399fb4ca.js"><link rel="prefetch" href="/blog_dev/assets/js/92.ff317d0d.js"><link rel="prefetch" href="/blog_dev/assets/js/93.208e1694.js"><link rel="prefetch" href="/blog_dev/assets/js/94.13d481a5.js"><link rel="prefetch" href="/blog_dev/assets/js/95.984e2214.js"><link rel="prefetch" href="/blog_dev/assets/js/96.c1a273fa.js"><link rel="prefetch" href="/blog_dev/assets/js/97.bcbd1649.js"><link rel="prefetch" href="/blog_dev/assets/js/98.3fa49da9.js"><link rel="prefetch" href="/blog_dev/assets/js/99.fc09a5b7.js">
    <link rel="stylesheet" href="/blog_dev/assets/css/0.styles.e9faf17d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog_dev/" class="home-link router-link-active"><!----> <span class="site-name">hailiting Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Angular</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Demo笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog_dev/HTTP协议和反向代理.html" class="sidebar-link">浏览器行为与HTTP协议</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NodeJS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>React</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog_dev/React/Flux思想及Redux使用.html" class="sidebar-link">Flux 思想及 Redux 使用</a></li><li><a href="/blog_dev/React/React_ChardingView_socket.html" aria-current="page" class="active sidebar-link">ReactChardingViewsocket</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_dev/React/React_ChardingView_socket.html#文件结构" class="sidebar-link">文件结构</a></li><li class="sidebar-sub-header"><a href="/blog_dev/React/React_ChardingView_socket.html#常见问题" class="sidebar-link">常见问题</a></li><li class="sidebar-sub-header"><a href="/blog_dev/React/React_ChardingView_socket.html#方法一-npm-trader-view" class="sidebar-link">方法一： npm trader-view</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_dev/React/React_ChardingView_socket.html#tradingview-初始化图标" class="sidebar-link">TradingView 初始化图标</a></li><li class="sidebar-sub-header"><a href="/blog_dev/React/React_ChardingView_socket.html#websocket-链接获取数据" class="sidebar-link">websocket 链接获取数据</a></li><li class="sidebar-sub-header"><a href="/blog_dev/React/React_ChardingView_socket.html#更新-tradingview" class="sidebar-link">更新 tradingview</a></li></ul></li></ul></li><li><a href="/blog_dev/React/React_Hooks.html" class="sidebar-link">React Hooks</a></li><li><a href="/blog_dev/React/React_ts.html" class="sidebar-link">React_ts</a></li><li><a href="/blog_dev/React/React上拉加载和下拉刷新.html" class="sidebar-link">React 上拉加载和下拉刷新</a></li><li><a href="/blog_dev/React/React优化_ReactLoadable.html" class="sidebar-link">React 优化_ReactLoadable</a></li><li><a href="/blog_dev/React/React入门.html" class="sidebar-link">React 入门</a></li><li><a href="/blog_dev/React/React源码学习.html" class="sidebar-link">React 源码学习</a></li><li><a href="/blog_dev/React/React的setState到底是同步还是异步.html" class="sidebar-link">React 的 setState 到底是同步还是异步</a></li><li><a href="/blog_dev/React/React组件开发.html" class="sidebar-link">React 组件开发</a></li><li><a href="/blog_dev/React/React组件生命周期及单向数据流.html" class="sidebar-link">React 组件生命周期及单向数据流</a></li><li><a href="/blog_dev/React/React里怎么做单元测试.html" class="sidebar-link">React里怎么做单元测试</a></li><li><a href="/blog_dev/React/React项目搭建.html" class="sidebar-link">React项目搭建</a></li><li><a href="/blog_dev/React/Suspense_react16中如何处理异步和按需加载.html" class="sidebar-link">Suspense react16 中如何处理异步和按需加载</a></li><li><a href="/blog_dev/React/UmiJS_路由.html" class="sidebar-link">UmiJS_路由</a></li><li><a href="/blog_dev/React/antd使用经验.html" class="sidebar-link">antd 使用经验</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ReactNative</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Rust</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Wechat</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mongodb</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>npm</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>区块链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微信公众号</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>每日一道前端面试题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法与数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机服务基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>课程笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog_dev/课程表.html" class="sidebar-link">/课程表.html</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试之道</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="react-chardingview-socket"><a href="#react-chardingview-socket" class="header-anchor">#</a> React_ChardingView_socket</h1> <p>中文文档地址 https://b.aitrade.ga/books/tradingview/</p> <h2 id="文件结构"><a href="#文件结构" class="header-anchor">#</a> 文件结构</h2> <div class="language- extra-class"><pre class="language-text"><code>src
  |- service
  |     |- socket.js    // 链接ws，ws监听 推送 取消订阅 更新最新ticker 等的方法
  |- root.component.js  // 引用socket
  |- pages
  |    |-kLine
  |        |-index.js   // socket 订阅历史
</code></pre></div><h2 id="常见问题"><a href="#常见问题" class="header-anchor">#</a> 常见问题</h2> <div class="language- extra-class"><pre class="language-text"><code>// 设置图标价格精度
const e = chart.priceFormatter();
e.format = (v) =&gt; new bigNumber(v).toFixed(1, 1);
</code></pre></div><h2 id="方法一-npm-trader-view"><a href="#方法一-npm-trader-view" class="header-anchor">#</a> 方法一： npm trader-view</h2> <div class="language- extra-class"><pre class="language-text"><code>import {TradingView, Datafeed } from &quot;trader-view&quot;;
</code></pre></div><h3 id="tradingview-初始化图标"><a href="#tradingview-初始化图标" class="header-anchor">#</a> TradingView 初始化图标</h3> <div class="language- extra-class"><pre class="language-text"><code>// params ={symbol, resolution, from, to, firstDataRequest}
// list为数组 ep: [ {time,close,high,low,open,volume} ... ]
   initDatafeed() {
    const { symbol } = this.props;

    this.datafeed = new Datafeed({
      history: (params) =&gt; {
        return this.getHistData(
          params.symbol,
          params.resolution,
          params.from,
          params.to,
          params.firstDataRequest
        );
      },
      time: () =&gt; new Promise((resolve) =&gt; resolve(1)),
      config: () =&gt;
        new Promise((resolve) =&gt;
          resolve({
            supports_search: true,
            supports_group_request: false,
            supported_resolutions: [
              ...new Set(periods.map((item) =&gt; item.interval)),
            ],
            supports_marks: false,
            supports_timescale_marks: false,
            supports_time: true,
          })
        ),
      symbols: () =&gt;
        new Promise((resolve) =&gt; resolve(createSymbolInfo(symbol))),
    });

    this.datafeed.subscribeBars = (
      symbolInfo,
      resolution,
      onRealtimeCallback,
      subscribeUID,
      onResetCacheNeededCallback
    ) =&gt; {
      this.onRealtimeCallback = onRealtimeCallback;
      this.onResetCacheNeededCallback = onResetCacheNeededCallback;
    };
    /**
     * 解析商品信息
     */
    this.datafeed.resolveSymbol = (symbol, onResolve, onError) =&gt; {
      onResolve(createSymbolInfo(symbol));
    };
    this.datafeed.getBars = (
      symbolInfo,
      resolution,
      from,
      to,
      onHistoryCallback,
      onErrorCallback,
      firstDataRequest
    ) =&gt; {
      this.onHistoryCallback = onHistoryCallback;
      this.from = from;
      this.to = to;
      const { symbol, currentPeriod } = this.props;
      const { period, interval, count } = periods[currentPeriod];
      socket.subscribe(&quot;subHis&quot;, symbol, period, from);
      // this.initWebSocket().then((res) =&gt; {
      //   res.onopen = () =&gt; {
      //     const { symbol, currentPeriod } = this.props;
      //     const { period, interval, count } = periods[currentPeriod];
      //     if (res) {
      //       res.send(
      //         subscribe.subHis(
      //           symbol,
      //           period,
      //           from,
      //           Math.ceil((to - from) / 60 / count)
      //         )
      //       );
      //     }
      //   };
      // });
    };
  }
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>this.widget = new TradingView({
  // debug: true,
  // fullscreen: true,
  custom_css_url: host + &quot;charting_library/static/chardingView.css&quot;, // 自定义tradingview样式
  symbol: &quot;BTC&quot;, // 商品名
  interval: &quot;D&quot;, // 周期  1s 1m 1h 1W 1M 1Y ....
  preset: &quot;mobile&quot;,
  container_id: &quot;tv_chart_container&quot;,
  // datafeed JavaScript对象的实现接口，以反馈数据显示在图表上 必须项
  datafeed: this.datafeed,
  height: &quot;100%&quot;,
  width: &quot;100%&quot;,
  library_path: host+&quot;charting_library/&quot;,
  locale: &quot;zh&quot;,
  loading_screen:{
    backgroundColor: &quot;#fff&quot;,
    foregroundColor: &quot;#fff&quot;,
  },
  // 禁用自带的一些功能
  disabled_features: [
    &quot;left_toolbar&quot;,
    &quot;volume_force_overlay&quot;,
    &quot;create_volume_indicator_by_default&quot;,
    &quot;create_volume_indicator_by_default_once&quot;,
    &quot;format_button_in_legend&quot;,
    &quot;hide_left_toolbar_by_default&quot;,
    &quot;go_to_date&quot;,
    &quot;use_localstorage_for_settings&quot;,
    &quot;save_chart_properties_to_local_storage&quot;,
    &quot;main_series_scale_menu&quot;,
    &quot;show_logo_on_all_charts&quot; // 在多图表布局的每个图表上显示微标
    &quot;header_settings&quot;,
    &quot;timeframes_toolbar&quot;,
    &quot;chart_property_page_background&quot;,
    &quot;compare_symbol&quot;,
    &quot;go_to_date&quot;,
    &quot;header_chart_type&quot;,
    &quot;header_compare&quot;,
    &quot;header_interval_dialog_button&quot;,
    &quot;header_screenshot&quot;,
    &quot;header_symbol_search&quot;, // 头部搜索
    &quot;header_widget_dom_node&quot;, // 隐藏头部组件
    &quot;source_selection_markers&quot;, // 禁用系列和指示器的选择标记
    &quot;header_indicators&quot;, // 图标指标
    &quot;adaptive_logo&quot;, // 移动端隐藏logo
    &quot;header_undo_redo&quot;, // 撤销返回
    &quot;show_hide_button_in_legend&quot;,
    &quot;show_interval_dialog_on_key_press&quot;,
    &quot;snapshot_trading_drawings&quot;,
    &quot;symbol_info&quot;,
    &quot;border_around_the_chart&quot;,
    &quot;remove_library_container_border&quot;,
    &quot;header_saveload&quot;,
    &quot;header_resolutions&quot;,
  ],
  overrides: getOverrides(&quot;white&quot;),
  studies_overrides: {
    &quot;volume.volume.color.0&quot;: &quot;#eb4d5c&quot;,
    &quot;volume.valume.color.1&quot;: &quot;#53b987&quot;,
    &quot;volume.volume.transparency&quot;: 70,
    &quot;volume.options.showStudyArguments&quot;: !1,
    &quot;MA Cross.short:plot.color&quot;: &quot;#6b3798&quot;,
    &quot;MA Cross.long:plot.color&quot;: &quot;#708957&quot;,
  },
  enabled_features: [&quot;hide_last_na_study_output&quot;],
  charts_storage_url: &quot;http://saveload.tradingview.com&quot;,
  charts_storage_api_version:&quot;1.1&quot;,
  client_id: &quot;tradingview.com&quot;,
  user_id:&quot;public_user_id&quot;,
  theme: &quot;Light&quot;,
  timezone: &quot;Asia/Shannghai&quot;
});
this.widget.onChartReady(()=&gt;{
  const chart = this.widget.chart();
  chart.setResolution(inte, ()=&gt;{});
  chart.setChartType(chartType);
  // 每当十字线位置改变时，图标库将会调用回调函数
  chart.crossHairMoved(({time})=&gt;{
    if(!time){
      return;
    }
  })
})
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>export const getOverrides = (theme) =&gt; {
  const themes = {
    white: {
      up: &quot;#1dc6ac&quot;,
      down: &quot;#e8506c&quot;,
      bg: &quot;rgba(255, 255, 255, 0)&quot;,
      grid: &quot;#EDF1F7&quot;,
      cross: &quot;#CAD1E7&quot;,
      border: &quot;#EDF1F7&quot;,
      text: &quot;#CAD1E7&quot;,
      areatop: &quot;rgba(71, 78, 112, 0.1)&quot;,
      areadown: &quot;rgba(71, 78, 112, 0.02)&quot;,
      line: &quot;#EDF1F7&quot;,
    },
    black: {
      //url: &quot;night.css&quot;,
      up: &quot;#589065&quot;,
      down: &quot;#ae4e54&quot;,
      bg: &quot;#181B2A&quot;,
      grid: &quot;#1f2943&quot;,
      cross: &quot;#9194A3&quot;,
      border: &quot;#4e5b85&quot;,
      text: &quot;#61688A&quot;,
      areatop: &quot;rgba(122, 152, 247, .1)&quot;,
      areadown: &quot;rgba(122, 152, 247, .02)&quot;,
      line: &quot;#737375&quot;,
    },
    mobile: {
      //url: &quot;mobile.css&quot;,
      up: &quot;#03C087&quot;,
      down: &quot;#E76D42&quot;,
      bg: &quot;#ffffff&quot;,
      grid: &quot;#f7f8fa&quot;,
      cross: &quot;#23283D&quot;,
      border: &quot;#C5CFD5&quot;,
      text: &quot;#8C9FAD&quot;,
      areatop: &quot;rgba(71, 78, 112, 0.1)&quot;,
      areadown: &quot;rgba(71, 78, 112, 0.02)&quot;,
      showLegend: !0,
    },
  };
  const t = themes[theme];
  return {
    volumePaneSize: &quot;medium&quot;,
    &quot;scalesProperties.lineColor&quot;: t.text,
    &quot;scalesProperties.textColor&quot;: t.text,
    &quot;paneProperties.background&quot;: t.bg,
    &quot;paneProperties.vertGridProperties.color&quot;: t.grid,
    &quot;paneProperties.horzGridProperties.color&quot;: t.grid,
    &quot;paneProperties.crossHairProperties.color&quot;: t.cross,
    &quot;paneProperties.legendProperties.showLegend&quot;: !!t.showLegend,
    &quot;paneProperties.legendProperties.showStudyArguments&quot;: !0,
    &quot;paneProperties.legendProperties.showStudyTitles&quot;: !0,
    &quot;paneProperties.legendProperties.showStudyValues&quot;: !0,
    &quot;paneProperties.legendProperties.showSeriesTitle&quot;: !0,
    &quot;paneProperties.legendProperties.showSeriesOHLC&quot;: !0,
    &quot;mainSeriesProperties.candleStyle.upColor&quot;: t.up,
    &quot;mainSeriesProperties.candleStyle.downColor&quot;: t.down,
    &quot;mainSeriesProperties.candleStyle.drawWick&quot;: !0,
    &quot;mainSeriesProperties.candleStyle.drawBorder&quot;: !0,
    &quot;mainSeriesProperties.candleStyle.borderColor&quot;: t.border,
    &quot;mainSeriesProperties.candleStyle.borderUpColor&quot;: t.up,
    &quot;mainSeriesProperties.candleStyle.borderDownColor&quot;: t.down,
    &quot;mainSeriesProperties.candleStyle.wickUpColor&quot;: t.up,
    &quot;mainSeriesProperties.candleStyle.wickDownColor&quot;: t.down,
    &quot;mainSeriesProperties.candleStyle.barColorsOnPrevClose&quot;: !1,
    &quot;mainSeriesProperties.hollowCandleStyle.upColor&quot;: t.up,
    &quot;mainSeriesProperties.hollowCandleStyle.downColor&quot;: t.down,
    &quot;mainSeriesProperties.hollowCandleStyle.drawWick&quot;: !0,
    &quot;mainSeriesProperties.hollowCandleStyle.drawBorder&quot;: !0,
    &quot;mainSeriesProperties.hollowCandleStyle.borderColor&quot;: t.border,
    &quot;mainSeriesProperties.hollowCandleStyle.borderUpColor&quot;: t.up,
    &quot;mainSeriesProperties.hollowCandleStyle.borderDownColor&quot;: t.down,
    &quot;mainSeriesProperties.hollowCandleStyle.wickColor&quot;: t.line,
    &quot;mainSeriesProperties.haStyle.upColor&quot;: t.up,
    &quot;mainSeriesProperties.haStyle.downColor&quot;: t.down,
    &quot;mainSeriesProperties.haStyle.drawWick&quot;: !0,
    &quot;mainSeriesProperties.haStyle.drawBorder&quot;: !0,
    &quot;mainSeriesProperties.haStyle.borderColor&quot;: t.border,
    &quot;mainSeriesProperties.haStyle.borderUpColor&quot;: t.up,
    &quot;mainSeriesProperties.haStyle.borderDownColor&quot;: t.down,
    &quot;mainSeriesProperties.haStyle.wickColor&quot;: t.border,
    &quot;mainSeriesProperties.haStyle.barColorsOnPrevClose&quot;: !1,
    &quot;mainSeriesProperties.barStyle.upColor&quot;: t.up,
    &quot;mainSeriesProperties.barStyle.downColor&quot;: t.down,
    &quot;mainSeriesProperties.barStyle.barColorsOnPrevClose&quot;: !1,
    &quot;mainSeriesProperties.barStyle.dontDrawOpen&quot;: !1,
    &quot;mainSeriesProperties.lineStyle.color&quot;: t.border,
    &quot;mainSeriesProperties.lineStyle.linewidth&quot;: 1,
    &quot;mainSeriesProperties.lineStyle.priceSource&quot;: &quot;close&quot;,
    &quot;mainSeriesProperties.areaStyle.color1&quot;: t.areatop,
    &quot;mainSeriesProperties.areaStyle.color2&quot;: t.areadown,
    &quot;mainSeriesProperties.areaStyle.linecolor&quot;: t.border,
    &quot;mainSeriesProperties.areaStyle.linewidth&quot;: 1,
    &quot;mainSeriesProperties.areaStyle.priceSource&quot;: &quot;close&quot;,
  };
};
</code></pre></div><h4 id="设置图表背景"><a href="#设置图表背景" class="header-anchor">#</a> 设置图表背景</h4> <div class="language- extra-class"><pre class="language-text"><code>// chardingView.css
table.chart-markup-table {
  background-color: #fafafd;
  background: url(&quot;./images/logo.png&quot;) #fafafd no-repeat center center;
  background-size: 251px 51px;
}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>export const resolveSymbol = ({
  Sec: t,
  PrzClose: c,
  PrzHigh: h,
  PrzLow: l,
  PrzOpen: o,
  Volume: v,
}) =&gt; ({
  time: t * 1000,
  close: toNumber(c),
  high: toNumber(h),
  low: toNumber(l),
  open: toNumber(o),
  volume: toNumber(v),
});

</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>export const createSymbolInfo =(symbol)=&gt;({
  name: symbol,
  full_name: symbol,
  description: symbol,
  ticker: symbol,
  session: &quot;24x7&quot;,
  exchange: &quot;&quot;,
  listed_exchange: &quot;&quot;,
  timezone: &quot;Asia/Shanghai&quot;,
  format: &quot;price&quot;,
  pricescale: 100,
  minmov: 1,
  minmov2: 2,
  has_intraday: true,
  has_no_valume: false,
  has_daily: true,
  has_weekly_and_monthly: true,
  has_empty_bars: true,
  supported_resolutions: periods.map((item)=&gt; item.interval),
  intraday_multipliers: periods.map((item)=&gt; item.interval),
})
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>export const getOverrides = (theme) =&gt; {
  const themes = {
    white: {
      //url: &quot;day.css&quot;,
      up: &quot;#03c087&quot;,
      down: &quot;#ef5555&quot;,
      bg: &quot;rgba(0, 0, 0, 0)&quot;,
      grid: &quot;#EDF1F7&quot;,
      cross: &quot;#CAD1E7&quot;,
      border: &quot;#EDF1F7&quot;,
      text: &quot;#CAD1E7&quot;,
      areatop: &quot;rgba(71, 78, 112, 0.1)&quot;,
      areadown: &quot;rgba(71, 78, 112, 0.02)&quot;,
      line: &quot;#EDF1F7&quot;,
    },
    black: {
      //url: &quot;night.css&quot;,
      up: &quot;#589065&quot;,
      down: &quot;#ae4e54&quot;,
      bg: &quot;#181B2A&quot;,
      grid: &quot;#1f2943&quot;,
      cross: &quot;#9194A3&quot;,
      border: &quot;#4e5b85&quot;,
      text: &quot;#61688A&quot;,
      areatop: &quot;rgba(122, 152, 247, .1)&quot;,
      areadown: &quot;rgba(122, 152, 247, .02)&quot;,
      line: &quot;#737375&quot;,
    },
    mobile: {
      //url: &quot;mobile.css&quot;,
      up: &quot;#03C087&quot;,
      down: &quot;#E76D42&quot;,
      bg: &quot;#ffffff&quot;,
      grid: &quot;#f7f8fa&quot;,
      cross: &quot;#23283D&quot;,
      border: &quot;#C5CFD5&quot;,
      text: &quot;#8C9FAD&quot;,
      areatop: &quot;rgba(71, 78, 112, 0.1)&quot;,
      areadown: &quot;rgba(71, 78, 112, 0.02)&quot;,
      showLegend: !0,
    },
  };
  const t = themes[theme];
  return {
    volumePaneSize: &quot;medium&quot;,
    &quot;scalesProperties.lineColor&quot;: t.text,
    &quot;scalesProperties.textColor&quot;: t.text,
    &quot;paneProperties.background&quot;: t.bg,
    &quot;paneProperties.vertGridProperties.color&quot;: t.grid,
    &quot;paneProperties.horzGridProperties.color&quot;: t.grid,
    &quot;paneProperties.crossHairProperties.color&quot;: t.cross,
    &quot;paneProperties.legendProperties.showLegend&quot;: !!t.showLegend,
    &quot;paneProperties.legendProperties.showStudyArguments&quot;: !0,
    &quot;paneProperties.legendProperties.showStudyTitles&quot;: !0,
    &quot;paneProperties.legendProperties.showStudyValues&quot;: !0,
    &quot;paneProperties.legendProperties.showSeriesTitle&quot;: !0,
    &quot;paneProperties.legendProperties.showSeriesOHLC&quot;: !0,
    &quot;mainSeriesProperties.candleStyle.upColor&quot;: t.up,
    &quot;mainSeriesProperties.candleStyle.downColor&quot;: t.down,
    &quot;mainSeriesProperties.candleStyle.drawWick&quot;: !0,
    &quot;mainSeriesProperties.candleStyle.drawBorder&quot;: !0,
    &quot;mainSeriesProperties.candleStyle.borderColor&quot;: t.border,
    &quot;mainSeriesProperties.candleStyle.borderUpColor&quot;: t.up,
    &quot;mainSeriesProperties.candleStyle.borderDownColor&quot;: t.down,
    &quot;mainSeriesProperties.candleStyle.wickUpColor&quot;: t.up,
    &quot;mainSeriesProperties.candleStyle.wickDownColor&quot;: t.down,
    &quot;mainSeriesProperties.candleStyle.barColorsOnPrevClose&quot;: !1,
    &quot;mainSeriesProperties.hollowCandleStyle.upColor&quot;: t.up,
    &quot;mainSeriesProperties.hollowCandleStyle.downColor&quot;: t.down,
    &quot;mainSeriesProperties.hollowCandleStyle.drawWick&quot;: !0,
    &quot;mainSeriesProperties.hollowCandleStyle.drawBorder&quot;: !0,
    &quot;mainSeriesProperties.hollowCandleStyle.borderColor&quot;: t.border,
    &quot;mainSeriesProperties.hollowCandleStyle.borderUpColor&quot;: t.up,
    &quot;mainSeriesProperties.hollowCandleStyle.borderDownColor&quot;: t.down,
    &quot;mainSeriesProperties.hollowCandleStyle.wickColor&quot;: t.line,
    &quot;mainSeriesProperties.haStyle.upColor&quot;: t.up,
    &quot;mainSeriesProperties.haStyle.downColor&quot;: t.down,
    &quot;mainSeriesProperties.haStyle.drawWick&quot;: !0,
    &quot;mainSeriesProperties.haStyle.drawBorder&quot;: !0,
    &quot;mainSeriesProperties.haStyle.borderColor&quot;: t.border,
    &quot;mainSeriesProperties.haStyle.borderUpColor&quot;: t.up,
    &quot;mainSeriesProperties.haStyle.borderDownColor&quot;: t.down,
    &quot;mainSeriesProperties.haStyle.wickColor&quot;: t.border,
    &quot;mainSeriesProperties.haStyle.barColorsOnPrevClose&quot;: !1,
    &quot;mainSeriesProperties.barStyle.upColor&quot;: t.up,
    &quot;mainSeriesProperties.barStyle.downColor&quot;: t.down,
    &quot;mainSeriesProperties.barStyle.barColorsOnPrevClose&quot;: !1,
    &quot;mainSeriesProperties.barStyle.dontDrawOpen&quot;: !1,
    &quot;mainSeriesProperties.lineStyle.color&quot;: t.border,
    &quot;mainSeriesProperties.lineStyle.linewidth&quot;: 1,
    &quot;mainSeriesProperties.lineStyle.priceSource&quot;: &quot;close&quot;,
    &quot;mainSeriesProperties.areaStyle.color1&quot;: t.areatop,
    &quot;mainSeriesProperties.areaStyle.color2&quot;: t.areadown,
    &quot;mainSeriesProperties.areaStyle.linecolor&quot;: t.border,
    &quot;mainSeriesProperties.areaStyle.linewidth&quot;: 1,
    &quot;mainSeriesProperties.areaStyle.priceSource&quot;: &quot;close&quot;,
  };
};
</code></pre></div><h3 id="websocket-链接获取数据"><a href="#websocket-链接获取数据" class="header-anchor">#</a> websocket 链接获取数据</h3> <div class="language- extra-class"><pre class="language-text"><code>let _cache = {}; // 暂存所有交易对信息
initWebSocket(isFirst = false){
  this.socket = new WebSocket(&quot;wss://ss....&quot;);
  // 最基础的需要订阅k线数据，最新ticker
  this.socket.onmessage=(e)=&gt;{
    this.onSocketMessage(e.data);
  }
}
onSocketMessage(data){
  try{
    if(!data){
      return;
    }
    if(data === &quot;PONG&quot;){
      return;
    }
    const _data = JSON.parse(data);
    if(_data.subj===&quot;index&quot;){
      if(this.onRealtimeCallback){
        const bars = Object.entries(_cache).sort((a,b)=&gt;a[0]-b[0]);
        // 最后一条数据用最新数据
        const item = bars[bars.length-1];
        if(item){
          const bar = item[1];
          bar.close = _data.data.Prz;
          bar.time = item[0]/1;
          this.onRealtimeCallback(bar);
        }
      }
    } else if(_data.subj === &quot;kline&quot;){
      const bars = resolveSymbol(_data.data);
      _cache[bar.time] = bar;
      _lastBar = {...bar};
      if(this.onRealtimeCallback){
        setTimeout(()=&gt;{
          this.onRealtimeCallback(bar);
        }, 100);
      }
    } else if(_data.data.Count){
      if(this.onHistoryCallback){
        const {
          Sec, PrzOpen, PrzClose, PrzHigh, PrzLow, Volume, Count
        } = _data.data;
        const {symbol, currentPeriod} = this.props;
        const {period, interval} = periods[currentPeriod];
        const list = [];
        for(let i=0;i&lt;Count; i++){
          const bar = {
            time: Sec[i]*1000,
            close: toNumber(PrzClose[i]),
            high: toNumber(PrzHigh[i]),
            low: toNumber(PrzLow[i]),
            open: toNumber(PrzOpen[i]),
            volume: toNumber(Volume[i]),
          }
          list.push(bar);
          _cache[bar.time] = bar;
          if(i===Count-1){
            _lastBar = {...bar};
            console.log(&quot;last&quot;, bar.time);
          }
        }
        this.onHistoryCallback(list, {
          noData: !list.length,
          nextTime: Sec[Sec.length -1]*1000,
        });
        if(this.socket){
          this.socket.send(subscribe.sub(symbol, period));
        }
      }
    }
  }
}
</code></pre></div><p>websock 订阅的参数</p> <div class="language- extra-class"><pre class="language-text"><code>let hisPage = &quot;1&quot;;
const subscribe = {
  sub: (symbol, period) =&gt;{
    ++hisPage;
    return JSON.stringify({
      req: &quot;Sub&quot;,
      rid: `${hisPage}`,
      args: [
        `kline_${period}_GMEX_CI_${symbol}`,
        `index_GMEX_CI_${symbol}`,
        '__slow__',
      ],
      expires: +new Date(),
    })
  },
  unsub: (symbol, period, all=true){
    ++hisPage;
    return JSON.stringify({
      req: &quot;Unsub&quot;,
      rid: `${hisPage}`,
      args: all ? [
          `index_GMEX_CI_${symbol}`,
          `kline_${period}_GMEX_CI_${symbol}`,
          `GMEX_CI_${symbol}`,
        ]
        : [`GMEX_CI_${symbol}`],
      expires: +new Date(),
    });
  },
  subHis: (symbol, period, Sec, Count) =&gt; {
    ++hisPage;
    return JSON.stringify({
      req: &quot;GetHistKLine&quot;,
      rid: `${hisPage}`,
      args: {
        Sym: `GMEX_CI_${symbol}`,
        Typ: period,
        Sec,
        Offset: 0,
        Count,
      },
      expires: +new Date(),
    });
  },
}
</code></pre></div><h4 id="生命周期销毁的时候"><a href="#生命周期销毁的时候" class="header-anchor">#</a> 生命周期销毁的时候</h4> <div class="language- extra-class"><pre class="language-text"><code>
</code></pre></div><h3 id="更新-tradingview"><a href="#更新-tradingview" class="header-anchor">#</a> 更新 tradingview</h3> <div class="language- extra-class"><pre class="language-text"><code>componentWillUpdate(nextProps) {
  const { currentPeriod, symbol } = nextProps;
  const { currentPeriod: c, symbol: s } = this.props;
  const period = periods[currentPeriod];
  if (!this.widget) {
    return;
  }

  if (c !== currentPeriod) {
    this.widget.chart().setResolution(period.interval, () =&gt; { });
    this.widget.chart().setChartType(period.chartType);
    // this.onResetCacheNeededCallback &amp;&amp; this.onResetCacheNeededCallback();
    // this.widget.chart().resetData();
    _cache = {};
    this.socket.send(subscribe.unsub(s, periods[c].period));
    // this.initSub(nextProps);
  }
}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>// kLine/index.js
import React from &quot;react&quot;;
import moment from &quot;moment&quot;;
import { connect } from &quot;react-redux&quot;;
import { Scoped } from &quot;kremling&quot;;
import { TradingView, Datafeed } from &quot;trader-view&quot;;
import {
  periods,
  studys,
  resolveSymbol,
  createSymbolInfo,
  toNumber,
  getOverrides,
} from &quot;@/utils/tradingviewHelper&quot;;
import socket from &quot;@/service/socket&quot;;
import Text from &quot;@/components/text&quot;;
import styles from &quot;./index.krem.scss&quot;;

// http://localhost:9001
const host = process.env.NODE_ENV === &quot;development&quot; ? &quot;/&quot; : &quot;/micro/contract/&quot;;

// 暂存所以交易对信息
let _cache = {};
let _lastBar = null;
let _selectTime = &quot;&quot;;
@connect(({ allSymbolsContract: { currentPeriod, symbol } }) =&gt; {
  return {
    currentPeriod,
    symbol,
  };
})
export default class Kline extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      show: false,
      minTime: 0, // 不在此范围内，弹层将被隐藏
      maxTime: 0, // 不在此范围内，弹层将被隐藏
      bar: {}, // 当前选中的bar
      prevBar: {}, // 当前选中bar的前一个bar
    };
  }
  /**
   * 初始订阅
   */
  async initSub({ symbol, currentPeriod }) {
    const { period, interval, count } = periods[currentPeriod];
    await socket.subscribe(&quot;subHis&quot;, symbol, period, this.from);
  }

  /**
   * 监听WebSocket响应
   * @param msg string
   */
  onSocketMessage = (data) =&gt; {
    if (data.subj === &quot;index&quot;) {
      // 更新最后一条数据
      if (this.onRealtimeCallback) {
        const bars = Object.entries(_cache).sort((a, b) =&gt; a[0] - b[0]); //;
        const item = bars[bars.length - 1];
        if (item) {
          const bar = item[1];
          bar.close = data.data.Prz;
          bar.time = item[0] / 1;
          this.onRealtimeCallback(bar);
        }
      }
    } else if (data.subj === &quot;kline&quot;) {
      const bar = resolveSymbol(data.data);
      // 存入缓存
      _cache[bar.time] = bar;
      _lastBar = { ...bar };
      // console.log(&quot;kline&quot;, _lastBar);
      console.log(&quot;put&quot;, bar.time);
      if (this.onRealtimeCallback) {
        setTimeout(() =&gt; {
          this.onRealtimeCallback(bar);
        }, 100);
      }
    } else if (data.data.Count) {
      if (this.onHistoryCallback) {
        const {
          Sec,
          PrzOpen,
          PrzClose,
          PrzHigh,
          PrzLow,
          Volume,
          Count,
        } = data.data;

        const { symbol, currentPeriod } = this.props;
        const { period, interval } = periods[currentPeriod];
        const list = [];

        for (let i = 0; i &lt; Count; i++) {
          const bar = {
            time: Sec[i] * 1000,
            close: toNumber(PrzClose[i]),
            high: toNumber(PrzHigh[i]),
            low: toNumber(PrzLow[i]),
            open: toNumber(PrzOpen[i]),
            volume: toNumber(Volume[i]),
          };
          list.push(bar);
          // 存入缓存
          _cache[bar.time] = bar;
          if (i === Count - 1) {
            _lastBar = { ...bar };
            console.log(&quot;last&quot;, bar.time);
          }
        }

        this.onHistoryCallback(list, {
          noData: !list.length,
          nextTime: Sec[Sec.length - 1] * 1000,
        });

        socket.subscribe(&quot;sub&quot;, symbol, period);
      }
    }
  };

  /**
   * 初始化 JS API
   */
  initDatafeed() {
    const { symbol } = this.props;

    this.datafeed = new Datafeed({
      history: (params) =&gt; {
        return this.getHistData(
          params.symbol,
          params.resolution,
          params.from,
          params.to,
          params.firstDataRequest
        );
      },
      time: () =&gt; new Promise((resolve) =&gt; resolve(1)),
      config: () =&gt;
        new Promise((resolve) =&gt;
          resolve({
            supports_search: true,
            supports_group_request: false,
            supported_resolutions: [
              ...new Set(periods.map((item) =&gt; item.interval)),
            ],
            supports_marks: false,
            supports_timescale_marks: false,
            supports_time: true,
          })
        ),
      symbols: () =&gt;
        new Promise((resolve) =&gt; resolve(createSymbolInfo(symbol))),
    });

    this.datafeed.subscribeBars = (
      symbolInfo,
      resolution,
      onRealtimeCallback,
      subscribeUID,
      onResetCacheNeededCallback
    ) =&gt; {
      this.onRealtimeCallback = onRealtimeCallback;
      this.onResetCacheNeededCallback = onResetCacheNeededCallback;
    };
    /**
     * 解析商品信息
     */
    this.datafeed.resolveSymbol = (symbol, onResolve, onError) =&gt; {
      onResolve(createSymbolInfo(symbol));
    };
    this.datafeed.getBars = (
      symbolInfo,
      resolution,
      from,
      to,
      onHistoryCallback,
      onErrorCallback,
      firstDataRequest
    ) =&gt; {
      this.onHistoryCallback = onHistoryCallback;
      this.from = from;
      this.to = to;
      const { symbol, currentPeriod } = this.props;
      const { period, interval, count } = periods[currentPeriod];
      socket.subscribe(&quot;subHis&quot;, symbol, period, from);
      // this.initWebSocket().then((res) =&gt; {
      //   res.onopen = () =&gt; {
      //     const { symbol, currentPeriod } = this.props;
      //     const { period, interval, count } = periods[currentPeriod];
      //     if (res) {
      //       res.send(
      //         subscribe.subHis(
      //           symbol,
      //           period,
      //           from,
      //           Math.ceil((to - from) / 60 / count)
      //         )
      //       );
      //     }
      //   };
      // });
    };
  }
  async getHistData() {
    const list = await new Promise();
    return {
      bars: [],
      meta: { noData: false },
    };
  }
  /**
   * 初始化图表
   */
  initTradingView = () =&gt; {
    if (!this.datafeed) {
      return;
    }
    const { currentPeriod, symbol } = this.props;
    const { time: interval, chartType, interval: inte } = periods[
      currentPeriod
    ];
    const localeMap = {
      &quot;zh-CN&quot;: &quot;zh&quot;,
      &quot;ko-KR&quot;: &quot;ko&quot;,
      &quot;en-US&quot;: &quot;en&quot;,
    };
    this.widget = new TradingView({
      // debug: true, // uncomment this line to see Library errors and warnings in the console
      // fullscreen: true,
      custom_css_url: host + &quot;charting_library/static/style.css&quot;,
      symbol,
      interval,
      preset: &quot;mobile&quot;,
      container_id: &quot;tv_chart_container&quot;,
      datafeed: this.datafeed,
      height: &quot;100%&quot;,
      width: &quot;100%&quot;,
      library_path: host + &quot;charting_library/&quot;,
      locale: &quot;zh&quot;,
      loading_screen: {
        // backgroundColor: &quot;#fff&quot;,
        // foregroundColor: &quot;#fff&quot;
      },
      disabled_features: [
        &quot;left_toolbar&quot;,
        &quot;volume_force_overlay&quot;,
        &quot;create_volume_indicator_by_default&quot;,
        &quot;create_volume_indicator_by_default_once&quot;,
        &quot;format_button_in_legend&quot;,
        &quot;hide_left_toolbar_by_default&quot;,
        &quot;go_to_date&quot;,
        &quot;use_localstorage_for_settings&quot;,
        &quot;save_chart_properties_to_local_storage&quot;,
        &quot;main_series_scale_menu&quot;,
        &quot;show_logo_on_all_charts&quot;,
        &quot;header_settings&quot;,
        &quot;timeframes_toolbar&quot;,
        &quot;chart_property_page_background&quot;,
        &quot;timeframes_toolbar&quot;,
        &quot;compare_symbol&quot;,
        &quot;go_to_date&quot;,
        &quot;header_chart_type&quot;, // k线样式
        &quot;header_compare&quot;,
        &quot;header_interval_dialog_button&quot;,
        &quot;header_screenshot&quot;, // 截图
        &quot;header_symbol_search&quot;,
        &quot;header_undo_redo&quot;,
        &quot;show_hide_button_in_legend&quot;,
        &quot;show_interval_dialog_on_key_press&quot;,
        &quot;snapshot_trading_drawings&quot;,
        &quot;symbol_info&quot;,
        &quot;border_around_the_chart&quot;,
        &quot;remove_library_container_border&quot;,
        &quot;header_saveload&quot;,
        &quot;header_resolutions&quot;,
      ],
      overrides: getOverrides(&quot;white&quot;),
      studies_overrides: {
        &quot;volume.volume.color.0&quot;: &quot;#eb4d5c&quot;,
        &quot;volume.volume.color.1&quot;: &quot;#53b987&quot;,
        &quot;volume.volume.transparency&quot;: 70,
        &quot;volume.options.showStudyArguments&quot;: !1,
        &quot;MA Cross.short:plot.color&quot;: &quot;#6B3798&quot;,
        &quot;MA Cross.long:plot.color&quot;: &quot;#708957&quot;,
      },
      enabled_features: [&quot;hide_last_na_study_output&quot;],
      charts_storage_url: &quot;http://saveload.tradingview.com&quot;,
      charts_storage_api_version: &quot;1.1&quot;,
      client_id: &quot;tradingview.com&quot;,
      user_id: &quot;public_user_id&quot;,
      theme: &quot;Light&quot;,
      timezone: &quot;Asia/Shanghai&quot;,
    });

    this.widget.onChartReady(() =&gt; {
      // 辅助线
      const chart = this.widget.chart();
      chart.setResolution(inte, () =&gt; {});
      chart.setChartType(chartType);

      // 每当十字线位置改变时，图表库将会调用回调函数。
      chart.crossHairMoved(({ time }) =&gt; {
        if (!time) {
          return;
        }
        const bars = Object.entries(_cache).sort((a, b) =&gt; a[0] - b[0]); //;
        const index = bars.findIndex((item) =&gt; item[1].time === time * 1000);
        const bar = bars[index]?.[1];
        // console.log(&quot;111&quot;, time, bar, _cache);
        if (bar) {
          const { minTime, maxTime } = this.state;
          let show = true;
          if (minTime &amp;&amp; maxTime) {
            show = bar.time &lt;= maxTime &amp;&amp; bar.time &gt;= minTime;
          }
          this.setState(
            {
              show,
              bar: bar,
              prevBar: bars[index - 1]?.[1] || {},
              minTime: show ? bars[index - 2]?.[1]?.time || 0 : 0,
              maxTime: show ? bars[index + 2]?.[1]?.time || 0 : 0,
            },
            () =&gt; {
              _selectTime = time;
            }
          );
        } else {
          this.setState({
            show: false,
          });
        }
      });

      for (let i = 0, l = studys.length; i &lt; l; i++) {
        chart.createStudy(...studys[i]);
      }
    });
  };
  componentWillUnmount() {
    const { currentPeriod, symbol } = this.props;
    socket.unsubscribe(symbol, currentPeriod);
  }
  componentWillReceiveProps(nextProps) {
    const { currentPeriod, symbol } = nextProps;
    const { currentPeriod: c, symbol: s } = this.props;
    const period = periods[currentPeriod];
    if (!this.widget) {
      return;
    }

    if (c !== currentPeriod) {
      this.widget.chart().setResolution(period.interval, () =&gt; {});
      this.widget.chart().setChartType(period.chartType);
      _cache = {};
      socket.unsubscribe(s, periods[c].period);
    }
  }

  async componentDidMount() {
    // onmessage事件
    socket.onMessage(this.onSocketMessage);
    this.initDatafeed();
    // this.initWebSocket();
    this.initTradingView();
  }

  render() {
    const {
      show,
      prevBar,
      bar: { time, close, high, low, open, volume },
    } = this.state;
    const pClose = prevBar.close || 0;
    const num = close - pClose;
    const percent = ((close - pClose) / close) * 100;
    return (
      &lt;Scoped css={styles}&gt;
        &lt;div className=&quot;contract-home-kline&quot;&gt;
          {show ? (
            &lt;ul className=&quot;float-panle&quot;&gt;
              &lt;li&gt;
                &lt;Text type=&quot;date&quot; format=&quot;YYYY-MM-DD HH:mm&quot;&gt;
                  {time}
                &lt;/Text&gt;
              &lt;/li&gt;
              &lt;li&gt;
                &lt;div&gt;开:&lt;/div&gt;
                &lt;Text type=&quot;number&quot;&gt;{open}&lt;/Text&gt;
              &lt;/li&gt;
              &lt;li&gt;
                &lt;div&gt;高:&lt;/div&gt;
                &lt;Text type=&quot;number&quot;&gt;{high}&lt;/Text&gt;
              &lt;/li&gt;
              &lt;li&gt;
                &lt;div&gt;低:&lt;/div&gt;
                &lt;Text type=&quot;number&quot;&gt;{low}&lt;/Text&gt;
              &lt;/li&gt;
              &lt;li&gt;
                &lt;div&gt;收:&lt;/div&gt;
                &lt;Text type=&quot;number&quot;&gt;{close}&lt;/Text&gt;
              &lt;/li&gt;
              &lt;li&gt;
                &lt;div&gt;涨跌额: &lt;/div&gt;
                &lt;span className={num &gt;= 0 ? &quot;green&quot; : &quot;red&quot;}&gt;
                  {num &gt;= 0 ? &quot;+&quot; : &quot;&quot;}
                  &lt;Text type=&quot;number&quot;&gt;{num}&lt;/Text&gt;
                &lt;/span&gt;
              &lt;/li&gt;
              &lt;li&gt;
                &lt;div&gt;涨跌幅: &lt;/div&gt;
                &lt;span className={percent &gt;= 0 ? &quot;green&quot; : &quot;red&quot;}&gt;
                  {percent &gt;= 0 ? &quot;+&quot; : &quot;&quot;}
                  &lt;Text type=&quot;number&quot;&gt;{percent}&lt;/Text&gt;%
                &lt;/span&gt;
              &lt;/li&gt;
            &lt;/ul&gt;
          ) : null}
          &lt;div
            className=&quot;kline-percentage&quot;
            ref={(ref) =&gt; (this.percentage = ref)}
          &gt;
            111%
          &lt;/div&gt;
          &lt;div id=&quot;tv_chart_container&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/Scoped&gt;
    );
  }
}
import React from &quot;react&quot;;
import moment from &quot;moment&quot;;
import { connect } from &quot;react-redux&quot;;
import { Scoped } from &quot;kremling&quot;;
import { TradingView, Datafeed } from &quot;trader-view&quot;;
import {
  periods,
  studys,
  resolveSymbol,
  createSymbolInfo,
  toNumber,
  getOverrides,
} from &quot;@/utils/tradingviewHelper&quot;;
import socket from &quot;@/service/socket&quot;;
import Text from &quot;@/components/text&quot;;
import styles from &quot;./index.krem.scss&quot;;

// http://localhost:9001
const host = process.env.NODE_ENV === &quot;development&quot; ? &quot;/&quot; : &quot;/micro/contract/&quot;;

// 暂存所以交易对信息
let _cache = {};
let _lastBar = null;
let _selectTime = &quot;&quot;;
@connect(({ allSymbolsContract: { currentPeriod, symbol } }) =&gt; {
  return {
    currentPeriod,
    symbol,
  };
})
export default class Kline extends React.Component {
  constructor(props) {
    super(props);
    this.state = {
      show: false,
      minTime: 0, // 不在此范围内，弹层将被隐藏
      maxTime: 0, // 不在此范围内，弹层将被隐藏
      bar: {}, // 当前选中的bar
      prevBar: {}, // 当前选中bar的前一个bar
    };
  }
  /**
   * 初始订阅
   */
  async initSub({ symbol, currentPeriod }) {
    const { period, interval, count } = periods[currentPeriod];
    await socket.subscribe(&quot;subHis&quot;, symbol, period, this.from);
  }

  /**
   * 监听WebSocket响应
   * @param msg string
   */
  onSocketMessage = (data) =&gt; {
    if (data.subj === &quot;index&quot;) {
      // 更新最后一条数据
      if (this.onRealtimeCallback) {
        const bars = Object.entries(_cache).sort((a, b) =&gt; a[0] - b[0]); //;
        const item = bars[bars.length - 1];
        if (item) {
          const bar = item[1];
          bar.close = data.data.Prz;
          bar.time = item[0] / 1;
          this.onRealtimeCallback(bar);
        }
      }
    } else if (data.subj === &quot;kline&quot;) {
      const bar = resolveSymbol(data.data);
      // 存入缓存
      _cache[bar.time] = bar;
      _lastBar = { ...bar };
      // console.log(&quot;kline&quot;, _lastBar);
      console.log(&quot;put&quot;, bar.time);
      if (this.onRealtimeCallback) {
        setTimeout(() =&gt; {
          this.onRealtimeCallback(bar);
        }, 100);
      }
    } else if (data.data.Count) {
      if (this.onHistoryCallback) {
        const {
          Sec,
          PrzOpen,
          PrzClose,
          PrzHigh,
          PrzLow,
          Volume,
          Count,
        } = data.data;

        const { symbol, currentPeriod } = this.props;
        const { period, interval } = periods[currentPeriod];
        const list = [];

        for (let i = 0; i &lt; Count; i++) {
          const bar = {
            time: Sec[i] * 1000,
            close: toNumber(PrzClose[i]),
            high: toNumber(PrzHigh[i]),
            low: toNumber(PrzLow[i]),
            open: toNumber(PrzOpen[i]),
            volume: toNumber(Volume[i]),
          };
          list.push(bar);
          // 存入缓存
          _cache[bar.time] = bar;
          if (i === Count - 1) {
            _lastBar = { ...bar };
            console.log(&quot;last&quot;, bar.time);
          }
        }

        this.onHistoryCallback(list, {
          noData: !list.length,
          nextTime: Sec[Sec.length - 1] * 1000,
        });

        socket.subscribe(&quot;sub&quot;, symbol, period);
      }
    }
  };

  /**
   * 初始化 JS API
   */
  initDatafeed() {
    const { symbol } = this.props;

    this.datafeed = new Datafeed({
      history: (params) =&gt; {
        return this.getHistData(
          params.symbol,
          params.resolution,
          params.from,
          params.to,
          params.firstDataRequest
        );
      },
      time: () =&gt; new Promise((resolve) =&gt; resolve(1)),
      config: () =&gt;
        new Promise((resolve) =&gt;
          resolve({
            supports_search: true,
            supports_group_request: false,
            supported_resolutions: [
              ...new Set(periods.map((item) =&gt; item.interval)),
            ],
            supports_marks: false,
            supports_timescale_marks: false,
            supports_time: true,
          })
        ),
      symbols: () =&gt;
        new Promise((resolve) =&gt; resolve(createSymbolInfo(symbol))),
    });

    this.datafeed.subscribeBars = (
      symbolInfo,
      resolution,
      onRealtimeCallback,
      subscribeUID,
      onResetCacheNeededCallback
    ) =&gt; {
      this.onRealtimeCallback = onRealtimeCallback;
      this.onResetCacheNeededCallback = onResetCacheNeededCallback;
    };
    /**
     * 解析商品信息
     */
    this.datafeed.resolveSymbol = (symbol, onResolve, onError) =&gt; {
      onResolve(createSymbolInfo(symbol));
    };
    this.datafeed.getBars = (
      symbolInfo,
      resolution,
      from,
      to,
      onHistoryCallback,
      onErrorCallback,
      firstDataRequest
    ) =&gt; {
      this.onHistoryCallback = onHistoryCallback;
      this.from = from;
      this.to = to;
      const { symbol, currentPeriod } = this.props;
      const { period, interval, count } = periods[currentPeriod];
      socket.subscribe(&quot;subHis&quot;, symbol, period, from);
      // this.initWebSocket().then((res) =&gt; {
      //   res.onopen = () =&gt; {
      //     const { symbol, currentPeriod } = this.props;
      //     const { period, interval, count } = periods[currentPeriod];
      //     if (res) {
      //       res.send(
      //         subscribe.subHis(
      //           symbol,
      //           period,
      //           from,
      //           Math.ceil((to - from) / 60 / count)
      //         )
      //       );
      //     }
      //   };
      // });
    };
  }
  async getHistData() {
    const list = await new Promise();
    return {
      bars: [],
      meta: { noData: false },
    };
  }
  /**
   * 初始化图表
   */
  initTradingView = () =&gt; {
    if (!this.datafeed) {
      return;
    }
    const { currentPeriod, symbol } = this.props;
    const { time: interval, chartType, interval: inte } = periods[
      currentPeriod
    ];
    const localeMap = {
      &quot;zh-CN&quot;: &quot;zh&quot;,
      &quot;ko-KR&quot;: &quot;ko&quot;,
      &quot;en-US&quot;: &quot;en&quot;,
    };
    this.widget = new TradingView({
      // debug: true, // uncomment this line to see Library errors and warnings in the console
      // fullscreen: true,
      custom_css_url: host + &quot;charting_library/static/style.css&quot;,
      symbol,
      interval,
      preset: &quot;mobile&quot;,
      container_id: &quot;tv_chart_container&quot;,
      datafeed: this.datafeed,
      height: &quot;100%&quot;,
      width: &quot;100%&quot;,
      library_path: host + &quot;charting_library/&quot;,
      locale: &quot;zh&quot;,
      loading_screen: {
        // backgroundColor: &quot;#fff&quot;,
        // foregroundColor: &quot;#fff&quot;
      },
      disabled_features: [
        &quot;header_fullscreen_button&quot;, // 全屏
        &quot;property_pages&quot;,  // 禁用所有属性页
        &quot;left_toolbar&quot;,
        &quot;volume_force_overlay&quot;,  // 防止重叠
        &quot;create_volume_indicator_by_default&quot;,
        &quot;create_volume_indicator_by_default_once&quot;,
        &quot;format_button_in_legend&quot;,
        &quot;hide_left_toolbar_by_default&quot;,
        &quot;go_to_date&quot;,
        &quot;use_localstorage_for_settings&quot;,
        &quot;save_chart_properties_to_local_storage&quot;,
        &quot;main_series_scale_menu&quot;,
        &quot;show_logo_on_all_charts&quot;,
        &quot;header_settings&quot;,  // 设置
        &quot;timeframes_toolbar&quot;, // 下面的时间
        &quot;chart_property_page_background&quot;,
        &quot;compare_symbol&quot;,
        &quot;go_to_date&quot;,
        &quot;header_chart_type&quot;,
        &quot;header_compare&quot;, // 图标对比
        &quot;header_interval_dialog_button&quot;,
        &quot;header_screenshot&quot;,
        &quot;header_symbol_search&quot;,
        &quot;header_undo_redo&quot;,
        &quot;show_hide_button_in_legend&quot;,
        &quot;show_interval_dialog_on_key_press&quot;,
        &quot;snapshot_trading_drawings&quot;,
        &quot;symbol_info&quot;,
        &quot;border_around_the_chart&quot;,
        &quot;remove_library_container_border&quot;,
        &quot;header_saveload&quot;,
        &quot;header_resolutions&quot;, // 头部时间s
      ],
      overrides: getOverrides(&quot;white&quot;),
      studies_overrides: {
        &quot;volume.volume.color.0&quot;: &quot;#eb4d5c&quot;,
        &quot;volume.volume.color.1&quot;: &quot;#53b987&quot;,
        &quot;volume.volume.transparency&quot;: 70,
        &quot;volume.options.showStudyArguments&quot;: !1,
        &quot;MA Cross.short:plot.color&quot;: &quot;#6B3798&quot;,
        &quot;MA Cross.long:plot.color&quot;: &quot;#708957&quot;,
      },
      enabled_features: [&quot;hide_last_na_study_output&quot;],
      charts_storage_url: &quot;http://saveload.tradingview.com&quot;,
      charts_storage_api_version: &quot;1.1&quot;,
      client_id: &quot;tradingview.com&quot;,
      user_id: &quot;public_user_id&quot;,
      theme: &quot;Light&quot;,
      timezone: &quot;Asia/Shanghai&quot;,
    });

    this.widget.onChartReady(() =&gt; {
      // 辅助线
      const chart = this.widget.chart();
      chart.setResolution(inte, () =&gt; {});
      chart.setChartType(chartType);

      // 每当十字线位置改变时，图表库将会调用回调函数。
      chart.crossHairMoved(({ time }) =&gt; {
        if (!time) {
          return;
        }
        const bars = Object.entries(_cache).sort((a, b) =&gt; a[0] - b[0]); //;
        const index = bars.findIndex((item) =&gt; item[1].time === time * 1000);
        const bar = bars[index]?.[1];
        // console.log(&quot;111&quot;, time, bar, _cache);
        if (bar) {
          const { minTime, maxTime } = this.state;
          let show = true;
          if (minTime &amp;&amp; maxTime) {
            show = bar.time &lt;= maxTime &amp;&amp; bar.time &gt;= minTime;
          }
          this.setState(
            {
              show,
              bar: bar,
              prevBar: bars[index - 1]?.[1] || {},
              minTime: show ? bars[index - 2]?.[1]?.time || 0 : 0,
              maxTime: show ? bars[index + 2]?.[1]?.time || 0 : 0,
            },
            () =&gt; {
              _selectTime = time;
            }
          );
        } else {
          this.setState({
            show: false,
          });
        }
      });

      for (let i = 0, l = studys.length; i &lt; l; i++) {
        chart.createStudy(...studys[i]);
      }
    });
  };
  componentWillUnmount() {
    const { currentPeriod, symbol } = this.props;
    socket.unsubscribe(symbol, currentPeriod);
  }
  componentWillReceiveProps(nextProps) {
    const { currentPeriod, symbol } = nextProps;
    const { currentPeriod: c, symbol: s } = this.props;
    const period = periods[currentPeriod];
    if (!this.widget) {
      return;
    }

    if (c !== currentPeriod) {
      this.widget.chart().setResolution(period.interval, () =&gt; {});
      this.widget.chart().setChartType(period.chartType);
      _cache = {};
      socket.unsubscribe(s, periods[c].period);
    }
  }

  async componentDidMount() {
    // onmessage事件
    socket.onMessage(this.onSocketMessage);
    this.initDatafeed();
    // this.initWebSocket();
    this.initTradingView();
  }

  render() {
    const {
      show,
      prevBar,
      bar: { time, close, high, low, open, volume },
    } = this.state;
    const pClose = prevBar.close || 0;
    const num = close - pClose;
    const percent = ((close - pClose) / close) * 100;
    return (
      &lt;Scoped css={styles}&gt;
          &lt;div
            className=&quot;kline-percentage&quot;
            ref={(ref) =&gt; (this.percentage = ref)}
          &gt;
            111%
          &lt;/div&gt;
          &lt;div id=&quot;tv_chart_container&quot;&gt;&lt;/div&gt;
        &lt;/div&gt;
      &lt;/Scoped&gt;
    );
  }
}
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>// service/socket.js
import { tickerSymbol, periods } from &quot;@/utils/tradingviewHelper&quot;;
let ws = &quot;wss://XXX/market&quot;;
let index = 1;
let socket = null;
let onMessageFn = null;
let dispatch = null;
let state = null;
let timer = null;
let subQueue = []; // 订阅队列

export const subscribeTypeMap = {
  sub: (symbol, period) =&gt;
    JSON.stringify({
      req: &quot;Sub&quot;,
      rid: `${++index}`,
      args: [`kline_${period}_GMEX_CI_${symbol}`],
      expires: +new Date(),
    }),
  unSub: (symbol, period, all = true) =&gt;
    JSON.stringify({
      req: &quot;UnSub&quot;,
      rid: `${++index}`,
      args: all
        ? [`kline_${period}_GMEX_CI_${symbol}`, `GMEX_CI_${symbol}`]
        : [`GMEX_CI_${symbol}`],
      expires: +new Date(),
    }),
  subHis: (symbol, period, Sec) =&gt;
    JSON.stringify({
      req: &quot;GetHistKLine&quot;,
      rid: `${++index}`,
      args: {
        Sym: `GMEX_CI_${symbol}`,
        Typ: period,
        Sec: Sec,
        Offset: 0,
        Count: 10000000,
      },
      expires: +new Date(),
    }),
};

const throwErr = () =&gt; {
  throw &quot;先执行service/socket.js的run方法&quot;;
};
/**
 * 提供给外界使用
 * @param {*} fn
 */
export const onMessage = (fn) =&gt; {
  if (socket) {
    onMessageFn = fn;
  } else {
    throwErr();
  }
};

/**
 * 启动，初始化
 */
export const run = (d, s) =&gt;
  new Promise(function (resolve, reject) {
    if (socket) {
      const { readyState, OPEN, CLOSED, CLOSING } = socket;
      if (readyState === OPEN) {
        resolve(socket);
      } else if (readyState === CLOSING || readyState === CLOSED) {
        socket = new WebSocket(ws);
      }
    } else {
      socket = new WebSocket(ws);
    }
    // 给重连时使用
    dispatch = d;
    state = s;
    // 进入正常逻辑
    const {
      allSymbolsContract: { currentPeriod, symbol },
    } = state;
    const { period } = periods[currentPeriod];

    socket.onmessage = (e) =&gt; {
      try {
        const data = JSON.parse(e.data);
        // 对外提供onmessage方法
        if (onMessageFn) {
          onMessageFn(data);
        }
        // 存储数据
        if (data.subj === &quot;index&quot;) {
          dispatch({
            type: &quot;global/updateState&quot;,
            state: {
              kline: tickerSymbol(data.data),
            },
          });
        }
      } catch (err) {
        console.error(err);
      }
    };

    /**
     * 链接出错
     */
    socket.onerror = (e) =&gt; {
      reject(e);
    };
    /**
     * 订阅k线
     */
    socket.onopen = () =&gt; {
      // 链接打开成功
      resolve(socket);
      /**
       * 大部分页面都会使用，所以全局开启订阅
       */
      socket.send(
        JSON.stringify({
          req: &quot;Sub&quot;,
          rid: `${++index}`,
          expires: Date.now() + 500 + 30000,
          args: [&quot;index_GMEX_CI_BTC&quot;, &quot;__slow__&quot;],
        })
      );
    };
  });

/**
 * 连接成功后，发送订阅队列
 * 调用之前必需保证连接成功
 */
const send = (resolve) =&gt; {
  for (let subString of subQueue) {
    socket.send(subString);
  }
  resolve(socket);
  // 订阅成功后清除对列
  subQueue = [];
};
export const subscribe = (sub, ...args) =&gt;
  new Promise(function (resolve, reject) {
    // 订阅的字符串
    subQueue.push(subscribeTypeMap[sub] ? subscribeTypeMap[sub](...args) : sub);
    if (socket) {
      const { readyState, OPEN, CLOSED, CLOSING } = socket;

      // 连接成功
      if (readyState === OPEN) {
        send(resolve);
      } else if (readyState === CLOSED || readyState === CLOSING) {
        // 连接关闭
        if (dispatch &amp;&amp; state) {
          run(dispatch, state)
            .then(() =&gt; {
              send(resolve);
            })
            .catch(reject);
        } else {
          throwErr();
        }
      } else {
        // 链接中
        timer = setInterval(() =&gt; {
          /**
           * 开启定时器检测状态
           * 连接成功后关闭定时器并订阅所有订阅
           */
          const { OPEN, readyState } = socket;
          if (OPEN === readyState) {
            clearInterval(timer);
            timer = null;
            send(resolve);
          }
        }, 100);
      }
    } else {
      throwErr();
    }
  });

/**
 * 取消订阅，在使用之前保证连接成功
 * @param {*} sub
 * @param  {...any} args
 */
export const unsubscribe = (...args) =&gt; {
  if (socket) {
    const subString = subscribeTypeMap.unSub(...args);
    socket.send(subString);
  } else {
    throwErr();
  }
};
export default { run, onMessage, subscribe, unsubscribe };
</code></pre></div><div class="language- extra-class"><pre class="language-text"><code>// root.component.js
async componentDidMount() {
  const { store } = this.props;
  await socket.run(store.dispatch, store.getState());
}
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog_dev/React/Flux思想及Redux使用.html" class="prev">
        Flux 思想及 Redux 使用
      </a></span> <span class="next"><a href="/blog_dev/React/React_Hooks.html">
        React Hooks
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog_dev/assets/js/app.709da227.js" defer></script><script src="/blog_dev/assets/js/2.556b46b5.js" defer></script><script src="/blog_dev/assets/js/169.67440797.js" defer></script>
  </body>
</html>
