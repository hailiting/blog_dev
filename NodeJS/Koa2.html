<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Koa2 | hailiting Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog_dev/logo.png">
    <meta name="description" content="hailiting Blog">
    
    <link rel="preload" href="/blog_dev/assets/css/0.styles.e9faf17d.css" as="style"><link rel="preload" href="/blog_dev/assets/js/app.709da227.js" as="script"><link rel="preload" href="/blog_dev/assets/js/2.556b46b5.js" as="script"><link rel="preload" href="/blog_dev/assets/js/138.6a94bea2.js" as="script"><link rel="prefetch" href="/blog_dev/assets/js/10.d061a1d9.js"><link rel="prefetch" href="/blog_dev/assets/js/100.0c7b74b5.js"><link rel="prefetch" href="/blog_dev/assets/js/101.63725a21.js"><link rel="prefetch" href="/blog_dev/assets/js/102.a0aa8352.js"><link rel="prefetch" href="/blog_dev/assets/js/103.3f4859f8.js"><link rel="prefetch" href="/blog_dev/assets/js/104.c375d9a0.js"><link rel="prefetch" href="/blog_dev/assets/js/105.3ab4f216.js"><link rel="prefetch" href="/blog_dev/assets/js/106.39c53827.js"><link rel="prefetch" href="/blog_dev/assets/js/107.f2a28572.js"><link rel="prefetch" href="/blog_dev/assets/js/108.dba8d9ec.js"><link rel="prefetch" href="/blog_dev/assets/js/109.be1a59c4.js"><link rel="prefetch" href="/blog_dev/assets/js/11.1fac2bc6.js"><link rel="prefetch" href="/blog_dev/assets/js/110.4e9a9fb3.js"><link rel="prefetch" href="/blog_dev/assets/js/111.e70ebf37.js"><link rel="prefetch" href="/blog_dev/assets/js/112.c2acf0c5.js"><link rel="prefetch" href="/blog_dev/assets/js/113.2c4c2f15.js"><link rel="prefetch" href="/blog_dev/assets/js/114.395922dd.js"><link rel="prefetch" href="/blog_dev/assets/js/115.4bca9bf3.js"><link rel="prefetch" href="/blog_dev/assets/js/116.49621d87.js"><link rel="prefetch" href="/blog_dev/assets/js/117.16ada7ad.js"><link rel="prefetch" href="/blog_dev/assets/js/118.2565919e.js"><link rel="prefetch" href="/blog_dev/assets/js/119.c12bdd10.js"><link rel="prefetch" href="/blog_dev/assets/js/12.4576cc3f.js"><link rel="prefetch" href="/blog_dev/assets/js/120.7939ff97.js"><link rel="prefetch" href="/blog_dev/assets/js/121.c26e4264.js"><link rel="prefetch" href="/blog_dev/assets/js/122.50fc8ef5.js"><link rel="prefetch" href="/blog_dev/assets/js/123.ffe9a78f.js"><link rel="prefetch" href="/blog_dev/assets/js/124.5aee6dd1.js"><link rel="prefetch" href="/blog_dev/assets/js/125.11cf3383.js"><link rel="prefetch" href="/blog_dev/assets/js/126.b056850f.js"><link rel="prefetch" href="/blog_dev/assets/js/127.80bc5fff.js"><link rel="prefetch" href="/blog_dev/assets/js/128.afdd2e1e.js"><link rel="prefetch" href="/blog_dev/assets/js/129.bd933eb7.js"><link rel="prefetch" href="/blog_dev/assets/js/13.bc140e8c.js"><link rel="prefetch" href="/blog_dev/assets/js/130.a87b24d0.js"><link rel="prefetch" href="/blog_dev/assets/js/131.9127e428.js"><link rel="prefetch" href="/blog_dev/assets/js/132.5baa85a6.js"><link rel="prefetch" href="/blog_dev/assets/js/133.e6519713.js"><link rel="prefetch" href="/blog_dev/assets/js/134.dbdebdb7.js"><link rel="prefetch" href="/blog_dev/assets/js/135.50b8f3cc.js"><link rel="prefetch" href="/blog_dev/assets/js/136.c9731137.js"><link rel="prefetch" href="/blog_dev/assets/js/137.f57d3761.js"><link rel="prefetch" href="/blog_dev/assets/js/139.cdff373d.js"><link rel="prefetch" href="/blog_dev/assets/js/14.d889f0ed.js"><link rel="prefetch" href="/blog_dev/assets/js/140.dd2e3ba1.js"><link rel="prefetch" href="/blog_dev/assets/js/141.7a915726.js"><link rel="prefetch" href="/blog_dev/assets/js/142.58a0db92.js"><link rel="prefetch" href="/blog_dev/assets/js/143.182403fc.js"><link rel="prefetch" href="/blog_dev/assets/js/144.dcd6bf77.js"><link rel="prefetch" href="/blog_dev/assets/js/145.d06933fa.js"><link rel="prefetch" href="/blog_dev/assets/js/146.fd698fa3.js"><link rel="prefetch" href="/blog_dev/assets/js/147.2eaef6d1.js"><link rel="prefetch" href="/blog_dev/assets/js/148.3e1c96ae.js"><link rel="prefetch" href="/blog_dev/assets/js/149.bb7c3714.js"><link rel="prefetch" href="/blog_dev/assets/js/15.4ca3d2e1.js"><link rel="prefetch" href="/blog_dev/assets/js/150.937db40c.js"><link rel="prefetch" href="/blog_dev/assets/js/151.e911967c.js"><link rel="prefetch" href="/blog_dev/assets/js/152.ba1a29a5.js"><link rel="prefetch" href="/blog_dev/assets/js/153.47a6243a.js"><link rel="prefetch" href="/blog_dev/assets/js/154.511b473a.js"><link rel="prefetch" href="/blog_dev/assets/js/155.b8cce54b.js"><link rel="prefetch" href="/blog_dev/assets/js/156.8898b2f9.js"><link rel="prefetch" href="/blog_dev/assets/js/157.5f06ed86.js"><link rel="prefetch" href="/blog_dev/assets/js/158.137235af.js"><link rel="prefetch" href="/blog_dev/assets/js/159.0e9ce62a.js"><link rel="prefetch" href="/blog_dev/assets/js/16.456961f6.js"><link rel="prefetch" href="/blog_dev/assets/js/160.38d855a7.js"><link rel="prefetch" href="/blog_dev/assets/js/161.3590c707.js"><link rel="prefetch" href="/blog_dev/assets/js/162.86630534.js"><link rel="prefetch" href="/blog_dev/assets/js/163.6e13f473.js"><link rel="prefetch" href="/blog_dev/assets/js/164.d1fb6be0.js"><link rel="prefetch" href="/blog_dev/assets/js/165.f60ddeb1.js"><link rel="prefetch" href="/blog_dev/assets/js/166.32edcf10.js"><link rel="prefetch" href="/blog_dev/assets/js/167.c186a3aa.js"><link rel="prefetch" href="/blog_dev/assets/js/168.b4d579ba.js"><link rel="prefetch" href="/blog_dev/assets/js/169.67440797.js"><link rel="prefetch" href="/blog_dev/assets/js/17.529aaf8b.js"><link rel="prefetch" href="/blog_dev/assets/js/170.9764038a.js"><link rel="prefetch" href="/blog_dev/assets/js/171.6f3a2180.js"><link rel="prefetch" href="/blog_dev/assets/js/172.519538bf.js"><link rel="prefetch" href="/blog_dev/assets/js/173.9f7d6b1c.js"><link rel="prefetch" href="/blog_dev/assets/js/174.135c3ff2.js"><link rel="prefetch" href="/blog_dev/assets/js/175.fad4b7cd.js"><link rel="prefetch" href="/blog_dev/assets/js/176.a7e8b342.js"><link rel="prefetch" href="/blog_dev/assets/js/177.bc7d98e9.js"><link rel="prefetch" href="/blog_dev/assets/js/178.013841ad.js"><link rel="prefetch" href="/blog_dev/assets/js/179.ea55a800.js"><link rel="prefetch" href="/blog_dev/assets/js/18.c501dfa3.js"><link rel="prefetch" href="/blog_dev/assets/js/180.3fc7fc18.js"><link rel="prefetch" href="/blog_dev/assets/js/181.00d79ee8.js"><link rel="prefetch" href="/blog_dev/assets/js/182.75ce3c02.js"><link rel="prefetch" href="/blog_dev/assets/js/183.a111b430.js"><link rel="prefetch" href="/blog_dev/assets/js/184.934f6bbd.js"><link rel="prefetch" href="/blog_dev/assets/js/185.fd9febdb.js"><link rel="prefetch" href="/blog_dev/assets/js/186.0a342597.js"><link rel="prefetch" href="/blog_dev/assets/js/187.9e4b1686.js"><link rel="prefetch" href="/blog_dev/assets/js/188.2989272b.js"><link rel="prefetch" href="/blog_dev/assets/js/189.f45e0987.js"><link rel="prefetch" href="/blog_dev/assets/js/19.d413d821.js"><link rel="prefetch" href="/blog_dev/assets/js/190.83d10781.js"><link rel="prefetch" href="/blog_dev/assets/js/191.2b4e0c89.js"><link rel="prefetch" href="/blog_dev/assets/js/192.48865ed5.js"><link rel="prefetch" href="/blog_dev/assets/js/193.c01826d8.js"><link rel="prefetch" href="/blog_dev/assets/js/194.74e50b36.js"><link rel="prefetch" href="/blog_dev/assets/js/195.aa29f582.js"><link rel="prefetch" href="/blog_dev/assets/js/196.aca00a42.js"><link rel="prefetch" href="/blog_dev/assets/js/197.40b2c10e.js"><link rel="prefetch" href="/blog_dev/assets/js/198.33842e64.js"><link rel="prefetch" href="/blog_dev/assets/js/199.29e6325b.js"><link rel="prefetch" href="/blog_dev/assets/js/20.c89e4367.js"><link rel="prefetch" href="/blog_dev/assets/js/200.a7bce9d6.js"><link rel="prefetch" href="/blog_dev/assets/js/201.5025c6d3.js"><link rel="prefetch" href="/blog_dev/assets/js/202.c99897b4.js"><link rel="prefetch" href="/blog_dev/assets/js/203.347f1189.js"><link rel="prefetch" href="/blog_dev/assets/js/204.8de572ee.js"><link rel="prefetch" href="/blog_dev/assets/js/205.45483b34.js"><link rel="prefetch" href="/blog_dev/assets/js/206.c31290f0.js"><link rel="prefetch" href="/blog_dev/assets/js/207.e3f41a9a.js"><link rel="prefetch" href="/blog_dev/assets/js/208.d0dfd243.js"><link rel="prefetch" href="/blog_dev/assets/js/209.995ec2cb.js"><link rel="prefetch" href="/blog_dev/assets/js/21.25b239e1.js"><link rel="prefetch" href="/blog_dev/assets/js/210.e7965c3a.js"><link rel="prefetch" href="/blog_dev/assets/js/211.6b257aba.js"><link rel="prefetch" href="/blog_dev/assets/js/212.4a1cc3ec.js"><link rel="prefetch" href="/blog_dev/assets/js/213.31f8bf45.js"><link rel="prefetch" href="/blog_dev/assets/js/214.313c7b41.js"><link rel="prefetch" href="/blog_dev/assets/js/215.ee241838.js"><link rel="prefetch" href="/blog_dev/assets/js/216.3543cf04.js"><link rel="prefetch" href="/blog_dev/assets/js/217.0d6ea85b.js"><link rel="prefetch" href="/blog_dev/assets/js/218.80640071.js"><link rel="prefetch" href="/blog_dev/assets/js/219.151cb78a.js"><link rel="prefetch" href="/blog_dev/assets/js/22.d89f4d90.js"><link rel="prefetch" href="/blog_dev/assets/js/220.0eae0afd.js"><link rel="prefetch" href="/blog_dev/assets/js/221.8f8817b7.js"><link rel="prefetch" href="/blog_dev/assets/js/222.ae4bc9b6.js"><link rel="prefetch" href="/blog_dev/assets/js/223.a7aed6fa.js"><link rel="prefetch" href="/blog_dev/assets/js/224.025821c5.js"><link rel="prefetch" href="/blog_dev/assets/js/225.97d213b8.js"><link rel="prefetch" href="/blog_dev/assets/js/226.4578e374.js"><link rel="prefetch" href="/blog_dev/assets/js/227.dfd2b951.js"><link rel="prefetch" href="/blog_dev/assets/js/228.f25dfcc5.js"><link rel="prefetch" href="/blog_dev/assets/js/229.49de06f2.js"><link rel="prefetch" href="/blog_dev/assets/js/23.37517448.js"><link rel="prefetch" href="/blog_dev/assets/js/230.74de1167.js"><link rel="prefetch" href="/blog_dev/assets/js/231.109f1608.js"><link rel="prefetch" href="/blog_dev/assets/js/232.b199ca54.js"><link rel="prefetch" href="/blog_dev/assets/js/233.e5505590.js"><link rel="prefetch" href="/blog_dev/assets/js/234.540cc14b.js"><link rel="prefetch" href="/blog_dev/assets/js/235.2c3a6404.js"><link rel="prefetch" href="/blog_dev/assets/js/236.7b387bc5.js"><link rel="prefetch" href="/blog_dev/assets/js/237.739ab0f9.js"><link rel="prefetch" href="/blog_dev/assets/js/238.fac109c9.js"><link rel="prefetch" href="/blog_dev/assets/js/239.1e997e2c.js"><link rel="prefetch" href="/blog_dev/assets/js/24.8c152fef.js"><link rel="prefetch" href="/blog_dev/assets/js/240.0b145d5f.js"><link rel="prefetch" href="/blog_dev/assets/js/241.09c4ce68.js"><link rel="prefetch" href="/blog_dev/assets/js/242.1e13a030.js"><link rel="prefetch" href="/blog_dev/assets/js/243.306372f7.js"><link rel="prefetch" href="/blog_dev/assets/js/244.63184878.js"><link rel="prefetch" href="/blog_dev/assets/js/245.8bcac252.js"><link rel="prefetch" href="/blog_dev/assets/js/246.99622cb5.js"><link rel="prefetch" href="/blog_dev/assets/js/247.34bd3960.js"><link rel="prefetch" href="/blog_dev/assets/js/248.2861f31a.js"><link rel="prefetch" href="/blog_dev/assets/js/249.6f62b76b.js"><link rel="prefetch" href="/blog_dev/assets/js/25.3bd7dbd6.js"><link rel="prefetch" href="/blog_dev/assets/js/250.441d1201.js"><link rel="prefetch" href="/blog_dev/assets/js/251.d1e30efd.js"><link rel="prefetch" href="/blog_dev/assets/js/252.1b993b77.js"><link rel="prefetch" href="/blog_dev/assets/js/253.7dd3cb2d.js"><link rel="prefetch" href="/blog_dev/assets/js/254.08d6a027.js"><link rel="prefetch" href="/blog_dev/assets/js/255.a95d32c3.js"><link rel="prefetch" href="/blog_dev/assets/js/256.4c0097ae.js"><link rel="prefetch" href="/blog_dev/assets/js/257.ccef358b.js"><link rel="prefetch" href="/blog_dev/assets/js/258.fcccb1d9.js"><link rel="prefetch" href="/blog_dev/assets/js/259.8c4e2a5b.js"><link rel="prefetch" href="/blog_dev/assets/js/26.357db678.js"><link rel="prefetch" href="/blog_dev/assets/js/260.45184866.js"><link rel="prefetch" href="/blog_dev/assets/js/261.57d645d4.js"><link rel="prefetch" href="/blog_dev/assets/js/262.cec8a62e.js"><link rel="prefetch" href="/blog_dev/assets/js/263.e8923920.js"><link rel="prefetch" href="/blog_dev/assets/js/264.37b490f7.js"><link rel="prefetch" href="/blog_dev/assets/js/265.ee7b00f6.js"><link rel="prefetch" href="/blog_dev/assets/js/266.0c31de3b.js"><link rel="prefetch" href="/blog_dev/assets/js/267.62925b15.js"><link rel="prefetch" href="/blog_dev/assets/js/268.6069bb2b.js"><link rel="prefetch" href="/blog_dev/assets/js/269.3c64c573.js"><link rel="prefetch" href="/blog_dev/assets/js/27.64c767de.js"><link rel="prefetch" href="/blog_dev/assets/js/270.ff44d5ab.js"><link rel="prefetch" href="/blog_dev/assets/js/271.de3eed75.js"><link rel="prefetch" href="/blog_dev/assets/js/272.9d9b6f12.js"><link rel="prefetch" href="/blog_dev/assets/js/273.b66c0be1.js"><link rel="prefetch" href="/blog_dev/assets/js/274.4d1bfedc.js"><link rel="prefetch" href="/blog_dev/assets/js/275.b7eceff6.js"><link rel="prefetch" href="/blog_dev/assets/js/276.eccd169a.js"><link rel="prefetch" href="/blog_dev/assets/js/277.a3a88438.js"><link rel="prefetch" href="/blog_dev/assets/js/278.22309baf.js"><link rel="prefetch" href="/blog_dev/assets/js/279.4373be14.js"><link rel="prefetch" href="/blog_dev/assets/js/28.0eaddbe2.js"><link rel="prefetch" href="/blog_dev/assets/js/280.bd9fb67f.js"><link rel="prefetch" href="/blog_dev/assets/js/281.2d9a98be.js"><link rel="prefetch" href="/blog_dev/assets/js/282.b90e372b.js"><link rel="prefetch" href="/blog_dev/assets/js/283.ec34c046.js"><link rel="prefetch" href="/blog_dev/assets/js/284.512f07f4.js"><link rel="prefetch" href="/blog_dev/assets/js/285.84d0ed1e.js"><link rel="prefetch" href="/blog_dev/assets/js/286.433c7816.js"><link rel="prefetch" href="/blog_dev/assets/js/287.0d3753f9.js"><link rel="prefetch" href="/blog_dev/assets/js/288.1c8d7744.js"><link rel="prefetch" href="/blog_dev/assets/js/289.476af6b9.js"><link rel="prefetch" href="/blog_dev/assets/js/29.5dd473c0.js"><link rel="prefetch" href="/blog_dev/assets/js/290.cbc40d8f.js"><link rel="prefetch" href="/blog_dev/assets/js/291.8346da5f.js"><link rel="prefetch" href="/blog_dev/assets/js/292.7384b627.js"><link rel="prefetch" href="/blog_dev/assets/js/293.63d74868.js"><link rel="prefetch" href="/blog_dev/assets/js/294.1410f408.js"><link rel="prefetch" href="/blog_dev/assets/js/295.952ce9ba.js"><link rel="prefetch" href="/blog_dev/assets/js/296.991a0da7.js"><link rel="prefetch" href="/blog_dev/assets/js/297.ec2fb727.js"><link rel="prefetch" href="/blog_dev/assets/js/298.c43e6ee0.js"><link rel="prefetch" href="/blog_dev/assets/js/299.02e81e03.js"><link rel="prefetch" href="/blog_dev/assets/js/3.bb975429.js"><link rel="prefetch" href="/blog_dev/assets/js/30.351b19a1.js"><link rel="prefetch" href="/blog_dev/assets/js/300.e4df5ed6.js"><link rel="prefetch" href="/blog_dev/assets/js/301.224fc9b4.js"><link rel="prefetch" href="/blog_dev/assets/js/302.ed9189c5.js"><link rel="prefetch" href="/blog_dev/assets/js/303.f0b78d10.js"><link rel="prefetch" href="/blog_dev/assets/js/304.6ec9ed66.js"><link rel="prefetch" href="/blog_dev/assets/js/305.c579e253.js"><link rel="prefetch" href="/blog_dev/assets/js/306.ac462491.js"><link rel="prefetch" href="/blog_dev/assets/js/307.abcd03c4.js"><link rel="prefetch" href="/blog_dev/assets/js/308.401c1772.js"><link rel="prefetch" href="/blog_dev/assets/js/309.84e52cc8.js"><link rel="prefetch" href="/blog_dev/assets/js/31.92bd6220.js"><link rel="prefetch" href="/blog_dev/assets/js/310.838924a1.js"><link rel="prefetch" href="/blog_dev/assets/js/311.c2d70590.js"><link rel="prefetch" href="/blog_dev/assets/js/312.892f867d.js"><link rel="prefetch" href="/blog_dev/assets/js/313.3f307c3e.js"><link rel="prefetch" href="/blog_dev/assets/js/314.a3ea90d5.js"><link rel="prefetch" href="/blog_dev/assets/js/315.6b095340.js"><link rel="prefetch" href="/blog_dev/assets/js/316.4f5b4c9b.js"><link rel="prefetch" href="/blog_dev/assets/js/317.66641d59.js"><link rel="prefetch" href="/blog_dev/assets/js/318.652dafd2.js"><link rel="prefetch" href="/blog_dev/assets/js/319.8dd6b519.js"><link rel="prefetch" href="/blog_dev/assets/js/32.fde56041.js"><link rel="prefetch" href="/blog_dev/assets/js/320.1fca28a4.js"><link rel="prefetch" href="/blog_dev/assets/js/321.6a52b165.js"><link rel="prefetch" href="/blog_dev/assets/js/322.4e9919d1.js"><link rel="prefetch" href="/blog_dev/assets/js/323.8a96f35f.js"><link rel="prefetch" href="/blog_dev/assets/js/324.590862d1.js"><link rel="prefetch" href="/blog_dev/assets/js/33.43b6d3a3.js"><link rel="prefetch" href="/blog_dev/assets/js/34.7ba26882.js"><link rel="prefetch" href="/blog_dev/assets/js/35.dd4ed088.js"><link rel="prefetch" href="/blog_dev/assets/js/36.114c5ba1.js"><link rel="prefetch" href="/blog_dev/assets/js/37.1952dd28.js"><link rel="prefetch" href="/blog_dev/assets/js/38.da914b09.js"><link rel="prefetch" href="/blog_dev/assets/js/39.7e26b7b2.js"><link rel="prefetch" href="/blog_dev/assets/js/4.47949fe2.js"><link rel="prefetch" href="/blog_dev/assets/js/40.b53ac1b8.js"><link rel="prefetch" href="/blog_dev/assets/js/41.ae8b1f98.js"><link rel="prefetch" href="/blog_dev/assets/js/42.479e9251.js"><link rel="prefetch" href="/blog_dev/assets/js/43.91d2fa5d.js"><link rel="prefetch" href="/blog_dev/assets/js/44.45a27817.js"><link rel="prefetch" href="/blog_dev/assets/js/45.9ba1f8c4.js"><link rel="prefetch" href="/blog_dev/assets/js/46.2eae6d1e.js"><link rel="prefetch" href="/blog_dev/assets/js/47.95b6f8e1.js"><link rel="prefetch" href="/blog_dev/assets/js/48.f0161ea5.js"><link rel="prefetch" href="/blog_dev/assets/js/49.5d642580.js"><link rel="prefetch" href="/blog_dev/assets/js/5.0ac632f7.js"><link rel="prefetch" href="/blog_dev/assets/js/50.8bd7a35f.js"><link rel="prefetch" href="/blog_dev/assets/js/51.56ae0cc4.js"><link rel="prefetch" href="/blog_dev/assets/js/52.ca920ca8.js"><link rel="prefetch" href="/blog_dev/assets/js/53.173c70ac.js"><link rel="prefetch" href="/blog_dev/assets/js/54.523b339d.js"><link rel="prefetch" href="/blog_dev/assets/js/55.ac75c90f.js"><link rel="prefetch" href="/blog_dev/assets/js/56.2e111d42.js"><link rel="prefetch" href="/blog_dev/assets/js/57.f51b48a0.js"><link rel="prefetch" href="/blog_dev/assets/js/58.1d77fc82.js"><link rel="prefetch" href="/blog_dev/assets/js/59.996c6ec0.js"><link rel="prefetch" href="/blog_dev/assets/js/6.7d92400c.js"><link rel="prefetch" href="/blog_dev/assets/js/60.9b1925f8.js"><link rel="prefetch" href="/blog_dev/assets/js/61.2622607d.js"><link rel="prefetch" href="/blog_dev/assets/js/62.9960ec8b.js"><link rel="prefetch" href="/blog_dev/assets/js/63.cc80d5d8.js"><link rel="prefetch" href="/blog_dev/assets/js/64.cd9d858a.js"><link rel="prefetch" href="/blog_dev/assets/js/65.2e5ca607.js"><link rel="prefetch" href="/blog_dev/assets/js/66.8be3c4c0.js"><link rel="prefetch" href="/blog_dev/assets/js/67.1eefd7d5.js"><link rel="prefetch" href="/blog_dev/assets/js/68.adf762ce.js"><link rel="prefetch" href="/blog_dev/assets/js/69.27c95c35.js"><link rel="prefetch" href="/blog_dev/assets/js/7.01b296e3.js"><link rel="prefetch" href="/blog_dev/assets/js/70.5097ac5d.js"><link rel="prefetch" href="/blog_dev/assets/js/71.e261fe0c.js"><link rel="prefetch" href="/blog_dev/assets/js/72.d5582ca6.js"><link rel="prefetch" href="/blog_dev/assets/js/73.8c99b9a5.js"><link rel="prefetch" href="/blog_dev/assets/js/74.360f75b2.js"><link rel="prefetch" href="/blog_dev/assets/js/75.31152e1a.js"><link rel="prefetch" href="/blog_dev/assets/js/76.1e48dadb.js"><link rel="prefetch" href="/blog_dev/assets/js/77.0d614aa8.js"><link rel="prefetch" href="/blog_dev/assets/js/78.d6dc4f4b.js"><link rel="prefetch" href="/blog_dev/assets/js/79.50283d30.js"><link rel="prefetch" href="/blog_dev/assets/js/8.7983d5a6.js"><link rel="prefetch" href="/blog_dev/assets/js/80.a52496b7.js"><link rel="prefetch" href="/blog_dev/assets/js/81.ea8065b9.js"><link rel="prefetch" href="/blog_dev/assets/js/82.8bc4a3cc.js"><link rel="prefetch" href="/blog_dev/assets/js/83.7fe873c1.js"><link rel="prefetch" href="/blog_dev/assets/js/84.d65a2741.js"><link rel="prefetch" href="/blog_dev/assets/js/85.27a9c21c.js"><link rel="prefetch" href="/blog_dev/assets/js/86.6d7e13c8.js"><link rel="prefetch" href="/blog_dev/assets/js/87.858dd9e0.js"><link rel="prefetch" href="/blog_dev/assets/js/88.c0d83d71.js"><link rel="prefetch" href="/blog_dev/assets/js/89.c6b08127.js"><link rel="prefetch" href="/blog_dev/assets/js/9.f2a5f044.js"><link rel="prefetch" href="/blog_dev/assets/js/90.4338e0cf.js"><link rel="prefetch" href="/blog_dev/assets/js/91.399fb4ca.js"><link rel="prefetch" href="/blog_dev/assets/js/92.ff317d0d.js"><link rel="prefetch" href="/blog_dev/assets/js/93.208e1694.js"><link rel="prefetch" href="/blog_dev/assets/js/94.13d481a5.js"><link rel="prefetch" href="/blog_dev/assets/js/95.984e2214.js"><link rel="prefetch" href="/blog_dev/assets/js/96.c1a273fa.js"><link rel="prefetch" href="/blog_dev/assets/js/97.bcbd1649.js"><link rel="prefetch" href="/blog_dev/assets/js/98.3fa49da9.js"><link rel="prefetch" href="/blog_dev/assets/js/99.fc09a5b7.js">
    <link rel="stylesheet" href="/blog_dev/assets/css/0.styles.e9faf17d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog_dev/" class="home-link router-link-active"><!----> <span class="site-name">hailiting Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Angular</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Demo笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog_dev/HTTP协议和反向代理.html" class="sidebar-link">浏览器行为与HTTP协议</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>NodeJS</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog_dev/NodeJS/Hapi.html" class="sidebar-link">Hapi</a></li><li><a href="/blog_dev/NodeJS/Koa.html" class="sidebar-link">Koa</a></li><li><a href="/blog_dev/NodeJS/Koa2.html" aria-current="page" class="active sidebar-link">Koa2</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#简单启动" class="sidebar-link">简单启动</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#不简单的启动文件" class="sidebar-link">不简单的启动文件</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#常用的依赖包安装" class="sidebar-link">常用的依赖包安装</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#解析请求体" class="sidebar-link">解析请求体</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#路由" class="sidebar-link">路由</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#设置路由可以跨域" class="sidebar-link">设置路由可以跨域</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#模板" class="sidebar-link">模板</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#静态资源处理" class="sidebar-link">静态资源处理</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#session-验证" class="sidebar-link">session 验证</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#token-验证" class="sidebar-link">token 验证</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#网络安全" class="sidebar-link">网络安全</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#压缩响应体" class="sidebar-link">压缩响应体</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#输出请求日志" class="sidebar-link">输出请求日志</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#数据库" class="sidebar-link">数据库</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#缓存" class="sidebar-link">缓存</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#文档" class="sidebar-link">文档</a></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#jslink-检查" class="sidebar-link">jslink 检查</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog_dev/NodeJS/Koa2.html#常用的文件结构" class="sidebar-link">常用的文件结构</a></li></ul></li><li><a href="/blog_dev/NodeJS/Koa2实战笔记.html" class="sidebar-link">Koa2 实战笔记</a></li><li><a href="/blog_dev/NodeJS/Mac安装多个版本Node.html" class="sidebar-link">Mac 安装多个版本 Node</a></li><li><a href="/blog_dev/NodeJS/" aria-current="page" class="sidebar-link">淘宝镜像</a></li><li><a href="/blog_dev/NodeJS/Web常用框架核心思想.html" class="sidebar-link">Web 常用框架核心思想</a></li><li><a href="/blog_dev/NodeJS/express入门.html" class="sidebar-link">Express 基础</a></li><li><a href="/blog_dev/NodeJS/express入门_实战.html" class="sidebar-link">express 入门实战</a></li><li><a href="/blog_dev/NodeJS/nodejs.html" class="sidebar-link">NodeJS</a></li><li><a href="/blog_dev/NodeJS/nodejs_特殊Api.html" class="sidebar-link">nodejs_特殊 Api</a></li><li><a href="/blog_dev/NodeJS/nodejs入门.html" class="sidebar-link">nodejs 入门</a></li><li><a href="/blog_dev/NodeJS/nodejs源码学习.html" class="sidebar-link">nodejs 源码学习</a></li><li><a href="/blog_dev/NodeJS/nodejs线上部署.html" class="sidebar-link">nodejs 线上部署</a></li><li><a href="/blog_dev/NodeJS/nodejs项目架构与优化.html" class="sidebar-link">nodejs 项目架构与优化</a></li><li><a href="/blog_dev/NodeJS/npx.html" class="sidebar-link">npx</a></li><li><a href="/blog_dev/NodeJS/pm2.html" class="sidebar-link">pm2</a></li><li><a href="/blog_dev/NodeJS/一般接口容错方法集.html" class="sidebar-link">一般接口容错方法集</a></li><li><a href="/blog_dev/NodeJS/升级node到指定版本.html" class="sidebar-link">升级 node 到指定版本</a></li><li><a href="/blog_dev/NodeJS/卸载和安装nodejs.html" class="sidebar-link">卸载和安装 nodejs</a></li><li><a href="/blog_dev/NodeJS/数据推送.html" class="sidebar-link">数据推送</a></li><li><a href="/blog_dev/NodeJS/爬虫系统.html" class="sidebar-link">爬虫系统</a></li><li><a href="/blog_dev/NodeJS/用node起一个简单的服务.html" class="sidebar-link">用 node 起一个简单的服务</a></li><li><a href="/blog_dev/NodeJS/面向切面编程SOLID.html" class="sidebar-link">面向切面编程 SOLID</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ReactNative</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Rust</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Wechat</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mongodb</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>npm</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>区块链</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微信公众号</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>每日一道前端面试题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法与数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机服务基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>课程笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog_dev/课程表.html" class="sidebar-link">/课程表.html</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试之道</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="koa2"><a href="#koa2" class="header-anchor">#</a> Koa2</h1> <h2 id="简单启动"><a href="#简单启动" class="header-anchor">#</a> 简单启动</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm i koa2 <span class="token operator">--</span>save

<span class="token keyword">const</span> koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token parameter">ctx</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token string">&quot;hello world&quot;</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><h2 id="不简单的启动文件"><a href="#不简单的启动文件" class="header-anchor">#</a> 不简单的启动文件</h2> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> helmet <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-helmet&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> route <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-route&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> cors <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-cors&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> moment <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;moment&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> koajwt <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-jwt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> compress <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-compress&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> koaBody <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-body&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> serve <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-static&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> path <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;path&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./config/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./controller/index.js&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">cors</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    allowMethods<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;GET&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;DELETE&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PUT&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;PATCH&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">helmet</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">&quot;OPTIONS&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token number">200</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">serve</span><span class="token punctuation">(</span>__dirname <span class="token operator">+</span> <span class="token string">&quot;/public&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">koaBody</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    formLimit<span class="token operator">:</span> <span class="token string">&quot;10mb&quot;</span><span class="token punctuation">,</span>
    jsonLimit<span class="token operator">:</span> <span class="token string">&quot;10mb&quot;</span><span class="token punctuation">,</span>
    textLimit<span class="token operator">:</span> <span class="token string">&quot;10mb&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">catch</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token parameter">err</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>err<span class="token punctuation">.</span>status <span class="token operator">===</span> <span class="token number">401</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">401</span><span class="token punctuation">;</span>
      ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;err&quot;</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">throw</span> err<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">koajwt</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    secret<span class="token operator">:</span> config<span class="token punctuation">.</span>tokenSecret<span class="token punctuation">,</span>
    debug<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    passthrough<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">unless</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    path<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;/articles&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// [/^\/login/]</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span>auth<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// auth权限控制</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/main&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> router<span class="token punctuation">.</span>main<span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/doLogin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> router<span class="token punctuation">.</span>doLogin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// app.use(compress()); // 对资源文件进行压缩</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="auth-权限控制"><a href="#auth-权限控制" class="header-anchor">#</a> auth 权限控制</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> <span class="token function-variable function">auth</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token comment">// 这可以放在config</span>
  <span class="token keyword">const</span> lengthPath <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;/doLogin&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/insertUser&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/articles&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;/main&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token comment">/**
   * ctx.request.path
   * ctx.url
   * ctx.state.user
   * ctx.response.status
   */</span>

  <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> lengthPath<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>path <span class="token operator">===</span> lengthPath<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>ctx<span class="token punctuation">.</span>state<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>status <span class="token operator">=</span> <span class="token number">401</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>response<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token string">&quot;请先登录&quot;</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="常用的依赖包安装"><a href="#常用的依赖包安装" class="header-anchor">#</a> 常用的依赖包安装</h2> <p><code>koa-bodyparser</code>, <code>koa-router</code>, <code>koa-views + ejs</code>, <code>koa-static</code>, <code>koa-session</code>, <code>koa-jwt</code>, <code>koa-helmet</code>, <code>koa-compress</code>, <code>koa-logger</code>, <code>koa-convert</code>, <code>koa-compose</code>, <code>koa-http-request</code>, <code>koa-conditional-get</code>, <code>koa-csrf</code>, <code>koa-ejs</code>, <code>koa-etag</code>, <code>koa-favicon</code>, <code>koa-generic-session</code>, <code>koa-onerror</code>, <code>koa-redis</code>, <code>koa-resource-router</code>, <code>koa-rewrite</code>, <code>koa-rt</code>, <code>koa-safe-jsonp</code>, <code>koa-static-cache</code></p> <h3 id="解析请求体"><a href="#解析请求体" class="header-anchor">#</a> 解析请求体</h3> <ul><li><code>koa-bodyparser</code> form-data 类型不太方便</li> <li>其他插件<code>body-parser</code>， <code>koa-body</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-bodyparser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token function-variable function">htmlText</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token parameter">body</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">
      &lt;!DOCTYPE html&gt;
      &lt;html lang=&quot;en&quot;&gt;
      &lt;head&gt;
        &lt;meta charset=&quot;UTF-8&quot;&gt;
        &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;
        &lt;title&gt;demo&lt;/title&gt;
      &lt;/head&gt;
      &lt;body&gt;
        </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>body<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">
      &lt;/body&gt;
      &lt;/html&gt;
      </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">&quot;GET&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> html <span class="token operator">=</span> <span class="token function">htmlText</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h1&gt;body parser demo&lt;/h1&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> html<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>url <span class="token operator">===</span> <span class="token string">&quot;/&quot;</span> <span class="token operator">&amp;&amp;</span> ctx<span class="token punctuation">.</span>method <span class="token operator">===</span> <span class="token string">&quot;POST&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> postData <span class="token operator">=</span> ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>postData<span class="token punctuation">)</span><span class="token punctuation">;</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> postData<span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    ctx<span class="token punctuation">.</span>body <span class="token operator">=</span> <span class="token function">htmlText</span><span class="token punctuation">(</span><span class="token string">&quot;&lt;h1&gt;404&lt;/h1&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p><code>tips</code>: koa-body 会与 koa-bodyParser 冲突。</p> <h5 id="detectjson"><a href="#detectjson" class="header-anchor">#</a> detectJSON</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">detectJSON</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token regex"><span class="token regex-delimiter">/</span><span class="token regex-source language-regex">\.json$</span><span class="token regex-delimiter">/</span><span class="token regex-flags">i</span></span><span class="token punctuation">.</span><span class="token function">test</span><span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>path<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="extendtypes"><a href="#extendtypes" class="header-anchor">#</a> extendTypes</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    extendTypes<span class="token operator">:</span> <span class="token punctuation">{</span>
      json<span class="token operator">:</span> <span class="token punctuation">[</span><span class="token string">&quot;application/x-javascript&quot;</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment">// application/json  multipart/form-data</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="onerror"><a href="#onerror" class="header-anchor">#</a> onerror</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>
  <span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token function-variable function">onerror</span><span class="token operator">:</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">err<span class="token punctuation">,</span> ctx</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      ctx<span class="token punctuation">.</span><span class="token function">throw</span><span class="token punctuation">(</span><span class="token string">&quot;body parse error&quot;</span><span class="token punctuation">,</span> <span class="token number">422</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h5 id="disableebodyparser"><a href="#disableebodyparser" class="header-anchor">#</a> disableeBodyParser</h5> <div class="language-javascript extra-class"><pre class="language-javascript"><code>app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>ctx<span class="token punctuation">.</span>path <span class="token operator">===</span> <span class="token string">&quot;/disable&quot;</span><span class="token punctuation">)</span> ctx<span class="token punctuation">.</span>disableBodyParser <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h4 id="可以给项目加中间件"><a href="#可以给项目加中间件" class="header-anchor">#</a> 可以给项目加中间件</h4> <div class="language-JavaScript extra-class"><pre class="language-javascript"><code><span class="token comment">// 添加params属性，方便获取get或post请求参数</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx<span class="token punctuation">,</span> next</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>params <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token operator">...</span>ctx<span class="token punctuation">.</span>request<span class="token punctuation">.</span>body<span class="token punctuation">,</span>
    <span class="token operator">...</span>ctx<span class="token punctuation">.</span>query<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">await</span> <span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="路由"><a href="#路由" class="header-anchor">#</a> 路由</h3> <ul><li><code>koa-router</code></li></ul> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa2&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Router <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-router&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> bodyParser <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-bodyparser&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">bodyParser</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">const</span> router <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Router</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment">// post delete put get</span>
router<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token parameter">ctx</span><span class="token punctuation">)</span><span class="token operator">=&gt;</span><span class="token punctuation">{</span>
  ctx<span class="token punctuation">.</span>body<span class="token operator">=</span><span class="token string">&quot;首页&quot;</span>，
<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token comment">// 启动路由</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">routes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span>router<span class="token punctuation">.</span><span class="token function">allowedMethods</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">listen</span><span class="token punctuation">(</span><span class="token number">3000</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="get-请求获取参数"><a href="#get-请求获取参数" class="header-anchor">#</a> get 请求获取参数</h4> <p>Get 传值通过<code>request</code>接收，但接收方法有两个: query 和 querystring</p> <ul><li>query：返回的是格式化好的参数对象</li> <li>querystring: 返回的是请求字符串</li></ul> <div class="language- extra-class"><pre class="language-text"><code>// /newlink?aid=123&amp;&amp;name=zhangsan
console.log(ctx.request.url);
console.log(ctx.request.query);   //{ aid: '123', name: 'zhangsan' }  对象
console.log(ctx.request.querystring);   //aid=123&amp;name=zhangsan
</code></pre></div><h3 id="设置路由可以跨域"><a href="#设置路由可以跨域" class="header-anchor">#</a> 设置路由可以跨域</h3> <p><code>koa-cors</code></p> <h3 id="模板"><a href="#模板" class="header-anchor">#</a> 模板</h3> <p><code>koa-views</code> <code>ejs</code></p> <h3 id="静态资源处理"><a href="#静态资源处理" class="header-anchor">#</a> 静态资源处理</h3> <p><code>koa-static</code></p> <h3 id="session-验证"><a href="#session-验证" class="header-anchor">#</a> session 验证</h3> <p><code>koa-session</code>
session 是一种记录客户状态的机制，和 Cookie 不同的是，Cookie 是在客户端浏览器，而 session 是保存在服务器的。</p> <h4 id="session-工作流程"><a href="#session-工作流程" class="header-anchor">#</a> Session 工作流程</h4> <p>当浏览器访问服务器并发送第一次请求时，服务端会创建一个 session 对象。
生成类似 key，valu 的键值对，然后将 key(cookie)返回到浏览器(客户端)，浏览器下次在访问时，携带 key(cookie)，找到对应 session(value)。客户端信息保存在 session 中。</p> <h4 id="session-使用"><a href="#session-使用" class="header-anchor">#</a> session 使用</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm i koa<span class="token operator">-</span>session <span class="token operator">--</span>save
</code></pre></div><p>文档</p> <div class="language-js extra-class"><pre class="language-js"><code>app<span class="token punctuation">.</span>keys <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">&quot;some secret hurr&quot;</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> <span class="token constant">CONFIG</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  key<span class="token operator">:</span> <span class="token string">&quot;koa:sess&quot;</span><span class="token punctuation">,</span> <span class="token comment">// cookie key (default is koa:sess)</span>
  maxAge<span class="token operator">:</span> <span class="token number">86400000</span><span class="token punctuation">,</span> <span class="token comment">// cookie的过期时间 (default is 1 days)</span>
  overwrite<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 是否可以overwrite</span>
  httpOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// cookie是否只有服务器端可以访问(default true)</span>
  signed<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// 签名默认true</span>
  rolling<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// 在每次请求时强行设置cookie，这将重置cookie过期时间</span>
  renew<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">session</span><span class="token punctuation">(</span><span class="token constant">CONFIG</span><span class="token punctuation">,</span> app<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>使用</p> <div class="language-js extra-class"><pre class="language-js"><code>设置值 ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username<span class="token operator">=</span><span class="token string">&quot;周三&quot;</span>
获取值 ctx<span class="token punctuation">.</span>session<span class="token punctuation">.</span>username
</code></pre></div><h5 id="cookie-和-session"><a href="#cookie-和-session" class="header-anchor">#</a> cookie 和 session</h5> <ol><li>cookie 数据存放在客户的浏览器上，session 数据放在服务器上</li> <li>cookie 会被窃取，所以应该使用 session</li> <li>session 会在一定时间内保存在服务器，访问增多会占用服务器的性能，考虑服务器性能方面的压力，应适当使用 cookie</li> <li>单个 cookie 保存的数据不能超过 4k, 最多不超过 20 个 cookie</li></ol> <h3 id="token-验证"><a href="#token-验证" class="header-anchor">#</a> token 验证</h3> <ul><li><code>koa-jwt</code></li></ul> <h4 id="koa-jwt主要知识点"><a href="#koa-jwt主要知识点" class="header-anchor">#</a> <code>koa-jwt</code>主要知识点</h4> <ol><li>主要提供路由权限控制功能，对需要限制的资源请求进行检查。</li> <li>token 默认被携带在 Headers 中的名为<code>Authorization</code>键值对中。</li> <li>可以提供 Cookie 来提供令牌。</li> <li>通过添加<code>passthrough</code>选项来保证始终传递到下一个中间件
<code>app.use(jwt({secret: &quot;shared-secret&quot;,passthrough:true}))</code></li> <li>使用<code>ctx.key</code>来表示解码数据，然后就可以通过<code>ctx.state.jwtdata</code>代替<code>ctx.state.user</code>获得解码数据.</li> <li><code>secret</code>的值可以使用函数代替，以此来产生动态的加密密钥</li> <li><code>koa-jwt</code>依赖于<code>jsonwebtoken</code>和<code>koa-unless</code>两个库</li></ol> <h4 id="可选择参数"><a href="#可选择参数" class="header-anchor">#</a> 可选择参数</h4> <div class="language-js extra-class"><pre class="language-js"><code>declare <span class="token keyword">function</span> <span class="token function">jwt</span><span class="token punctuation">(</span><span class="token parameter">options<span class="token operator">:</span> jwt<span class="token punctuation">.</span>Options</span><span class="token punctuation">)</span><span class="token operator">:</span> jwt<span class="token punctuation">.</span>Middleware<span class="token punctuation">;</span>
declare namespace jwt <span class="token punctuation">{</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Options</span> <span class="token punctuation">{</span>
    secret<span class="token operator">:</span> string <span class="token operator">|</span> Buffer<span class="token punctuation">;</span>
    key<span class="token operator">?</span><span class="token operator">:</span>string<span class="token punctuation">;</span>
    tokenKey<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
    getToken<span class="token operator">?</span><span class="token punctuation">(</span>opts<span class="token operator">:</span> jwt<span class="token punctuation">.</span>Options<span class="token punctuation">)</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
    isRevoked<span class="token operator">?</span><span class="token punctuation">(</span>ctx<span class="token operator">:</span> Koa<span class="token punctuation">.</span>Context<span class="token punctuation">,</span> decodedToken<span class="token operator">:</span> object<span class="token punctuation">,</span> token<span class="token operator">:</span> string<span class="token punctuation">)</span><span class="token operator">:</span>Promise<span class="token operator">&lt;</span>boolean<span class="token operator">&gt;</span><span class="token punctuation">;</span>
    passthrough<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span>
    cookie<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
    debug<span class="token operator">?</span><span class="token operator">:</span> boolean<span class="token punctuation">;</span>
    audience<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
    issuer<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">;</span>
    algorithms<span class="token operator">?</span><span class="token operator">:</span> string<span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">Middlware</span> <span class="token keyword">extends</span> <span class="token class-name">Koa<span class="token punctuation">.</span>Middleware</span> <span class="token punctuation">{</span>
    <span class="token function">unless</span><span class="token punctuation">(</span>params<span class="token operator">?</span><span class="token operator">:</span>any<span class="token punctuation">)</span><span class="token operator">:</span> any<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="网络安全"><a href="#网络安全" class="header-anchor">#</a> 网络安全</h3> <ul><li><code>koa-helmet</code> <code>helmet</code>通过增加如：<code>Strict-Transport-Security</code>,<code>X-Frame-Options</code>,<code>X-Frame-Options</code>等 HTTP 头，提高<code>Express</code>应用程序的安全性。</li></ul> <h3 id="压缩响应体"><a href="#压缩响应体" class="header-anchor">#</a> 压缩响应体</h3> <p><code>koa-compress</code></p> <h3 id="输出请求日志"><a href="#输出请求日志" class="header-anchor">#</a> 输出请求日志</h3> <ol><li>日志大体分为访问日志和应用日志。
访问日志记录客户端对项目的访问，主要是 http 请求，这些属于运营数据，也可以帮助改进和提升网站的性能和用户体验。
应用日志是项目中需要特殊标记和记录位置打印日志，包括出现异常的地方，方便开发查询项目的运行和定位 bug。</li> <li>日志记录什么东西：接口前后，重要方法，容易出处的地方，业务需求的埋点。
注意：手机号，银行卡，身份证等敏感信息不能打到日志里，用唯一标识找出错误信息。</li></ol> <h4 id="常用插件"><a href="#常用插件" class="header-anchor">#</a> 常用插件</h4> <ul><li><code>log4js</code></li> <li><code>koa-logger</code></li></ul> <h4 id="log4js"><a href="#log4js" class="header-anchor">#</a> log4js</h4> <h5 id="日志级别【从高到底】"><a href="#日志级别【从高到底】" class="header-anchor">#</a> 日志级别【从高到底】</h5> <p>在应用中按照级别记录日志，日后可以按照指定级别输出高于指定级别的日志。
<code>off</code>, <code>mark</code>, <code>fatal</code>, <code>error</code>, <code>warn</code>, <code>info</code>, <code>debug</code>, <code>trace</code>, <code>all</code></p> <h5 id="应用"><a href="#应用" class="header-anchor">#</a> 应用</h5> <ol><li>依赖安装</li></ol> <div class="language-shell extra-class"><pre class="language-shell"><code><span class="token function">npm</span> i log4js --save
<span class="token function">npm</span> i <span class="token function">ip</span> --save
</code></pre></div><ol start="2"><li>文件结构</li></ol> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token comment">// ./middleware/index.js</span>
<span class="token comment">// ./middleware/mi-log/logger.js</span>
<span class="token comment">// ./middleware/mi-log/access.js</span>
<span class="token comment">// ./middleware/mi-log/index.js</span>
</code></pre></div><h4 id="koa-logger"><a href="#koa-logger" class="header-anchor">#</a> koa-logger</h4> <div class="language-javascript extra-class"><pre class="language-javascript"><code>npm i koa<span class="token operator">-</span>logger <span class="token operator">--</span>save
<span class="token keyword">const</span> logger <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa-logger&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> Koa <span class="token operator">=</span> <span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;koa&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> app <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Koa</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
app<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token function">logger</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="数据库"><a href="#数据库" class="header-anchor">#</a> 数据库</h3> <p><code>mongoose</code></p> <h3 id="缓存"><a href="#缓存" class="header-anchor">#</a> 缓存</h3> <p><code>ioredis</code></p> <h3 id="文档"><a href="#文档" class="header-anchor">#</a> 文档</h3> <p><code>jsdoc</code></p> <h3 id="jslink-检查"><a href="#jslink-检查" class="header-anchor">#</a> jslink 检查</h3> <h2 id="常用的文件结构"><a href="#常用的文件结构" class="header-anchor">#</a> 常用的文件结构</h2> <div class="language- extra-class"><pre class="language-text"><code>├── node_modules
├── package-lock.json
├── package.json
└── src
    ├── app.js  主入口
    ├── config   全局用的参数，如：数据库地址，用户名，地址，端口号等等
    │   └── index.js
    ├── controller   具体业务编写
    │   └── controllerUser.js
    ├── middleware   中间层，每个接口都经过这里
    │   ├── auth.js
    │   ├── index.js
    │   └── log.js
    ├── models    数据库模型或URI接口转接
    │   ├── logs.js
    │   └── user.js
    ├── plugin   插件
    │   ├── mongodb.js
    │   └── redis.js
    ├── public    公共资源
    ├── route     路由分发
    │   ├── routeIndex.js
    │   └── routeUser.js
    ├── test   测试
    |   └── index.spec.js
    ├── util   方法库
    └── view   模板
        ├── index.ejs
        └── layout.ejs
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog_dev/NodeJS/Koa.html" class="prev">
        Koa
      </a></span> <span class="next"><a href="/blog_dev/NodeJS/Koa2实战笔记.html">
        Koa2 实战笔记
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog_dev/assets/js/app.709da227.js" defer></script><script src="/blog_dev/assets/js/2.556b46b5.js" defer></script><script src="/blog_dev/assets/js/138.6a94bea2.js" defer></script>
  </body>
</html>
