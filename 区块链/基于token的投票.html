<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>基于 token 的投票 - 用 truffle 构建简单投票 DApp | hailiting Blog</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/blog_dev/logo.png">
    <meta name="description" content="hailiting Blog">
    
    <link rel="preload" href="/blog_dev/assets/css/0.styles.e9faf17d.css" as="style"><link rel="preload" href="/blog_dev/assets/js/app.709da227.js" as="script"><link rel="preload" href="/blog_dev/assets/js/2.556b46b5.js" as="script"><link rel="preload" href="/blog_dev/assets/js/31.92bd6220.js" as="script"><link rel="prefetch" href="/blog_dev/assets/js/10.d061a1d9.js"><link rel="prefetch" href="/blog_dev/assets/js/100.0c7b74b5.js"><link rel="prefetch" href="/blog_dev/assets/js/101.63725a21.js"><link rel="prefetch" href="/blog_dev/assets/js/102.a0aa8352.js"><link rel="prefetch" href="/blog_dev/assets/js/103.3f4859f8.js"><link rel="prefetch" href="/blog_dev/assets/js/104.c375d9a0.js"><link rel="prefetch" href="/blog_dev/assets/js/105.3ab4f216.js"><link rel="prefetch" href="/blog_dev/assets/js/106.39c53827.js"><link rel="prefetch" href="/blog_dev/assets/js/107.f2a28572.js"><link rel="prefetch" href="/blog_dev/assets/js/108.dba8d9ec.js"><link rel="prefetch" href="/blog_dev/assets/js/109.be1a59c4.js"><link rel="prefetch" href="/blog_dev/assets/js/11.1fac2bc6.js"><link rel="prefetch" href="/blog_dev/assets/js/110.4e9a9fb3.js"><link rel="prefetch" href="/blog_dev/assets/js/111.e70ebf37.js"><link rel="prefetch" href="/blog_dev/assets/js/112.c2acf0c5.js"><link rel="prefetch" href="/blog_dev/assets/js/113.2c4c2f15.js"><link rel="prefetch" href="/blog_dev/assets/js/114.395922dd.js"><link rel="prefetch" href="/blog_dev/assets/js/115.4bca9bf3.js"><link rel="prefetch" href="/blog_dev/assets/js/116.49621d87.js"><link rel="prefetch" href="/blog_dev/assets/js/117.16ada7ad.js"><link rel="prefetch" href="/blog_dev/assets/js/118.2565919e.js"><link rel="prefetch" href="/blog_dev/assets/js/119.c12bdd10.js"><link rel="prefetch" href="/blog_dev/assets/js/12.4576cc3f.js"><link rel="prefetch" href="/blog_dev/assets/js/120.7939ff97.js"><link rel="prefetch" href="/blog_dev/assets/js/121.c26e4264.js"><link rel="prefetch" href="/blog_dev/assets/js/122.50fc8ef5.js"><link rel="prefetch" href="/blog_dev/assets/js/123.ffe9a78f.js"><link rel="prefetch" href="/blog_dev/assets/js/124.5aee6dd1.js"><link rel="prefetch" href="/blog_dev/assets/js/125.11cf3383.js"><link rel="prefetch" href="/blog_dev/assets/js/126.b056850f.js"><link rel="prefetch" href="/blog_dev/assets/js/127.80bc5fff.js"><link rel="prefetch" href="/blog_dev/assets/js/128.afdd2e1e.js"><link rel="prefetch" href="/blog_dev/assets/js/129.bd933eb7.js"><link rel="prefetch" href="/blog_dev/assets/js/13.bc140e8c.js"><link rel="prefetch" href="/blog_dev/assets/js/130.a87b24d0.js"><link rel="prefetch" href="/blog_dev/assets/js/131.9127e428.js"><link rel="prefetch" href="/blog_dev/assets/js/132.5baa85a6.js"><link rel="prefetch" href="/blog_dev/assets/js/133.e6519713.js"><link rel="prefetch" href="/blog_dev/assets/js/134.dbdebdb7.js"><link rel="prefetch" href="/blog_dev/assets/js/135.50b8f3cc.js"><link rel="prefetch" href="/blog_dev/assets/js/136.c9731137.js"><link rel="prefetch" href="/blog_dev/assets/js/137.f57d3761.js"><link rel="prefetch" href="/blog_dev/assets/js/138.6a94bea2.js"><link rel="prefetch" href="/blog_dev/assets/js/139.cdff373d.js"><link rel="prefetch" href="/blog_dev/assets/js/14.d889f0ed.js"><link rel="prefetch" href="/blog_dev/assets/js/140.dd2e3ba1.js"><link rel="prefetch" href="/blog_dev/assets/js/141.7a915726.js"><link rel="prefetch" href="/blog_dev/assets/js/142.58a0db92.js"><link rel="prefetch" href="/blog_dev/assets/js/143.182403fc.js"><link rel="prefetch" href="/blog_dev/assets/js/144.dcd6bf77.js"><link rel="prefetch" href="/blog_dev/assets/js/145.d06933fa.js"><link rel="prefetch" href="/blog_dev/assets/js/146.fd698fa3.js"><link rel="prefetch" href="/blog_dev/assets/js/147.2eaef6d1.js"><link rel="prefetch" href="/blog_dev/assets/js/148.3e1c96ae.js"><link rel="prefetch" href="/blog_dev/assets/js/149.bb7c3714.js"><link rel="prefetch" href="/blog_dev/assets/js/15.4ca3d2e1.js"><link rel="prefetch" href="/blog_dev/assets/js/150.937db40c.js"><link rel="prefetch" href="/blog_dev/assets/js/151.e911967c.js"><link rel="prefetch" href="/blog_dev/assets/js/152.ba1a29a5.js"><link rel="prefetch" href="/blog_dev/assets/js/153.47a6243a.js"><link rel="prefetch" href="/blog_dev/assets/js/154.511b473a.js"><link rel="prefetch" href="/blog_dev/assets/js/155.b8cce54b.js"><link rel="prefetch" href="/blog_dev/assets/js/156.8898b2f9.js"><link rel="prefetch" href="/blog_dev/assets/js/157.5f06ed86.js"><link rel="prefetch" href="/blog_dev/assets/js/158.137235af.js"><link rel="prefetch" href="/blog_dev/assets/js/159.0e9ce62a.js"><link rel="prefetch" href="/blog_dev/assets/js/16.456961f6.js"><link rel="prefetch" href="/blog_dev/assets/js/160.38d855a7.js"><link rel="prefetch" href="/blog_dev/assets/js/161.3590c707.js"><link rel="prefetch" href="/blog_dev/assets/js/162.86630534.js"><link rel="prefetch" href="/blog_dev/assets/js/163.6e13f473.js"><link rel="prefetch" href="/blog_dev/assets/js/164.d1fb6be0.js"><link rel="prefetch" href="/blog_dev/assets/js/165.f60ddeb1.js"><link rel="prefetch" href="/blog_dev/assets/js/166.32edcf10.js"><link rel="prefetch" href="/blog_dev/assets/js/167.c186a3aa.js"><link rel="prefetch" href="/blog_dev/assets/js/168.b4d579ba.js"><link rel="prefetch" href="/blog_dev/assets/js/169.67440797.js"><link rel="prefetch" href="/blog_dev/assets/js/17.529aaf8b.js"><link rel="prefetch" href="/blog_dev/assets/js/170.9764038a.js"><link rel="prefetch" href="/blog_dev/assets/js/171.6f3a2180.js"><link rel="prefetch" href="/blog_dev/assets/js/172.519538bf.js"><link rel="prefetch" href="/blog_dev/assets/js/173.9f7d6b1c.js"><link rel="prefetch" href="/blog_dev/assets/js/174.135c3ff2.js"><link rel="prefetch" href="/blog_dev/assets/js/175.fad4b7cd.js"><link rel="prefetch" href="/blog_dev/assets/js/176.a7e8b342.js"><link rel="prefetch" href="/blog_dev/assets/js/177.bc7d98e9.js"><link rel="prefetch" href="/blog_dev/assets/js/178.013841ad.js"><link rel="prefetch" href="/blog_dev/assets/js/179.ea55a800.js"><link rel="prefetch" href="/blog_dev/assets/js/18.c501dfa3.js"><link rel="prefetch" href="/blog_dev/assets/js/180.3fc7fc18.js"><link rel="prefetch" href="/blog_dev/assets/js/181.00d79ee8.js"><link rel="prefetch" href="/blog_dev/assets/js/182.75ce3c02.js"><link rel="prefetch" href="/blog_dev/assets/js/183.a111b430.js"><link rel="prefetch" href="/blog_dev/assets/js/184.934f6bbd.js"><link rel="prefetch" href="/blog_dev/assets/js/185.fd9febdb.js"><link rel="prefetch" href="/blog_dev/assets/js/186.0a342597.js"><link rel="prefetch" href="/blog_dev/assets/js/187.9e4b1686.js"><link rel="prefetch" href="/blog_dev/assets/js/188.2989272b.js"><link rel="prefetch" href="/blog_dev/assets/js/189.f45e0987.js"><link rel="prefetch" href="/blog_dev/assets/js/19.d413d821.js"><link rel="prefetch" href="/blog_dev/assets/js/190.83d10781.js"><link rel="prefetch" href="/blog_dev/assets/js/191.2b4e0c89.js"><link rel="prefetch" href="/blog_dev/assets/js/192.48865ed5.js"><link rel="prefetch" href="/blog_dev/assets/js/193.c01826d8.js"><link rel="prefetch" href="/blog_dev/assets/js/194.74e50b36.js"><link rel="prefetch" href="/blog_dev/assets/js/195.aa29f582.js"><link rel="prefetch" href="/blog_dev/assets/js/196.aca00a42.js"><link rel="prefetch" href="/blog_dev/assets/js/197.40b2c10e.js"><link rel="prefetch" href="/blog_dev/assets/js/198.33842e64.js"><link rel="prefetch" href="/blog_dev/assets/js/199.29e6325b.js"><link rel="prefetch" href="/blog_dev/assets/js/20.c89e4367.js"><link rel="prefetch" href="/blog_dev/assets/js/200.a7bce9d6.js"><link rel="prefetch" href="/blog_dev/assets/js/201.5025c6d3.js"><link rel="prefetch" href="/blog_dev/assets/js/202.c99897b4.js"><link rel="prefetch" href="/blog_dev/assets/js/203.347f1189.js"><link rel="prefetch" href="/blog_dev/assets/js/204.8de572ee.js"><link rel="prefetch" href="/blog_dev/assets/js/205.45483b34.js"><link rel="prefetch" href="/blog_dev/assets/js/206.c31290f0.js"><link rel="prefetch" href="/blog_dev/assets/js/207.e3f41a9a.js"><link rel="prefetch" href="/blog_dev/assets/js/208.d0dfd243.js"><link rel="prefetch" href="/blog_dev/assets/js/209.995ec2cb.js"><link rel="prefetch" href="/blog_dev/assets/js/21.25b239e1.js"><link rel="prefetch" href="/blog_dev/assets/js/210.e7965c3a.js"><link rel="prefetch" href="/blog_dev/assets/js/211.6b257aba.js"><link rel="prefetch" href="/blog_dev/assets/js/212.4a1cc3ec.js"><link rel="prefetch" href="/blog_dev/assets/js/213.31f8bf45.js"><link rel="prefetch" href="/blog_dev/assets/js/214.313c7b41.js"><link rel="prefetch" href="/blog_dev/assets/js/215.ee241838.js"><link rel="prefetch" href="/blog_dev/assets/js/216.3543cf04.js"><link rel="prefetch" href="/blog_dev/assets/js/217.0d6ea85b.js"><link rel="prefetch" href="/blog_dev/assets/js/218.80640071.js"><link rel="prefetch" href="/blog_dev/assets/js/219.151cb78a.js"><link rel="prefetch" href="/blog_dev/assets/js/22.d89f4d90.js"><link rel="prefetch" href="/blog_dev/assets/js/220.0eae0afd.js"><link rel="prefetch" href="/blog_dev/assets/js/221.8f8817b7.js"><link rel="prefetch" href="/blog_dev/assets/js/222.ae4bc9b6.js"><link rel="prefetch" href="/blog_dev/assets/js/223.a7aed6fa.js"><link rel="prefetch" href="/blog_dev/assets/js/224.025821c5.js"><link rel="prefetch" href="/blog_dev/assets/js/225.97d213b8.js"><link rel="prefetch" href="/blog_dev/assets/js/226.4578e374.js"><link rel="prefetch" href="/blog_dev/assets/js/227.dfd2b951.js"><link rel="prefetch" href="/blog_dev/assets/js/228.f25dfcc5.js"><link rel="prefetch" href="/blog_dev/assets/js/229.49de06f2.js"><link rel="prefetch" href="/blog_dev/assets/js/23.37517448.js"><link rel="prefetch" href="/blog_dev/assets/js/230.74de1167.js"><link rel="prefetch" href="/blog_dev/assets/js/231.109f1608.js"><link rel="prefetch" href="/blog_dev/assets/js/232.b199ca54.js"><link rel="prefetch" href="/blog_dev/assets/js/233.e5505590.js"><link rel="prefetch" href="/blog_dev/assets/js/234.540cc14b.js"><link rel="prefetch" href="/blog_dev/assets/js/235.2c3a6404.js"><link rel="prefetch" href="/blog_dev/assets/js/236.7b387bc5.js"><link rel="prefetch" href="/blog_dev/assets/js/237.739ab0f9.js"><link rel="prefetch" href="/blog_dev/assets/js/238.fac109c9.js"><link rel="prefetch" href="/blog_dev/assets/js/239.1e997e2c.js"><link rel="prefetch" href="/blog_dev/assets/js/24.8c152fef.js"><link rel="prefetch" href="/blog_dev/assets/js/240.0b145d5f.js"><link rel="prefetch" href="/blog_dev/assets/js/241.09c4ce68.js"><link rel="prefetch" href="/blog_dev/assets/js/242.1e13a030.js"><link rel="prefetch" href="/blog_dev/assets/js/243.306372f7.js"><link rel="prefetch" href="/blog_dev/assets/js/244.63184878.js"><link rel="prefetch" href="/blog_dev/assets/js/245.8bcac252.js"><link rel="prefetch" href="/blog_dev/assets/js/246.99622cb5.js"><link rel="prefetch" href="/blog_dev/assets/js/247.34bd3960.js"><link rel="prefetch" href="/blog_dev/assets/js/248.2861f31a.js"><link rel="prefetch" href="/blog_dev/assets/js/249.6f62b76b.js"><link rel="prefetch" href="/blog_dev/assets/js/25.3bd7dbd6.js"><link rel="prefetch" href="/blog_dev/assets/js/250.441d1201.js"><link rel="prefetch" href="/blog_dev/assets/js/251.d1e30efd.js"><link rel="prefetch" href="/blog_dev/assets/js/252.1b993b77.js"><link rel="prefetch" href="/blog_dev/assets/js/253.7dd3cb2d.js"><link rel="prefetch" href="/blog_dev/assets/js/254.08d6a027.js"><link rel="prefetch" href="/blog_dev/assets/js/255.a95d32c3.js"><link rel="prefetch" href="/blog_dev/assets/js/256.4c0097ae.js"><link rel="prefetch" href="/blog_dev/assets/js/257.ccef358b.js"><link rel="prefetch" href="/blog_dev/assets/js/258.fcccb1d9.js"><link rel="prefetch" href="/blog_dev/assets/js/259.8c4e2a5b.js"><link rel="prefetch" href="/blog_dev/assets/js/26.357db678.js"><link rel="prefetch" href="/blog_dev/assets/js/260.45184866.js"><link rel="prefetch" href="/blog_dev/assets/js/261.57d645d4.js"><link rel="prefetch" href="/blog_dev/assets/js/262.cec8a62e.js"><link rel="prefetch" href="/blog_dev/assets/js/263.e8923920.js"><link rel="prefetch" href="/blog_dev/assets/js/264.37b490f7.js"><link rel="prefetch" href="/blog_dev/assets/js/265.ee7b00f6.js"><link rel="prefetch" href="/blog_dev/assets/js/266.0c31de3b.js"><link rel="prefetch" href="/blog_dev/assets/js/267.62925b15.js"><link rel="prefetch" href="/blog_dev/assets/js/268.6069bb2b.js"><link rel="prefetch" href="/blog_dev/assets/js/269.3c64c573.js"><link rel="prefetch" href="/blog_dev/assets/js/27.64c767de.js"><link rel="prefetch" href="/blog_dev/assets/js/270.ff44d5ab.js"><link rel="prefetch" href="/blog_dev/assets/js/271.de3eed75.js"><link rel="prefetch" href="/blog_dev/assets/js/272.9d9b6f12.js"><link rel="prefetch" href="/blog_dev/assets/js/273.b66c0be1.js"><link rel="prefetch" href="/blog_dev/assets/js/274.4d1bfedc.js"><link rel="prefetch" href="/blog_dev/assets/js/275.b7eceff6.js"><link rel="prefetch" href="/blog_dev/assets/js/276.eccd169a.js"><link rel="prefetch" href="/blog_dev/assets/js/277.a3a88438.js"><link rel="prefetch" href="/blog_dev/assets/js/278.22309baf.js"><link rel="prefetch" href="/blog_dev/assets/js/279.4373be14.js"><link rel="prefetch" href="/blog_dev/assets/js/28.0eaddbe2.js"><link rel="prefetch" href="/blog_dev/assets/js/280.bd9fb67f.js"><link rel="prefetch" href="/blog_dev/assets/js/281.2d9a98be.js"><link rel="prefetch" href="/blog_dev/assets/js/282.b90e372b.js"><link rel="prefetch" href="/blog_dev/assets/js/283.ec34c046.js"><link rel="prefetch" href="/blog_dev/assets/js/284.512f07f4.js"><link rel="prefetch" href="/blog_dev/assets/js/285.84d0ed1e.js"><link rel="prefetch" href="/blog_dev/assets/js/286.433c7816.js"><link rel="prefetch" href="/blog_dev/assets/js/287.0d3753f9.js"><link rel="prefetch" href="/blog_dev/assets/js/288.1c8d7744.js"><link rel="prefetch" href="/blog_dev/assets/js/289.476af6b9.js"><link rel="prefetch" href="/blog_dev/assets/js/29.5dd473c0.js"><link rel="prefetch" href="/blog_dev/assets/js/290.cbc40d8f.js"><link rel="prefetch" href="/blog_dev/assets/js/291.8346da5f.js"><link rel="prefetch" href="/blog_dev/assets/js/292.7384b627.js"><link rel="prefetch" href="/blog_dev/assets/js/293.63d74868.js"><link rel="prefetch" href="/blog_dev/assets/js/294.1410f408.js"><link rel="prefetch" href="/blog_dev/assets/js/295.952ce9ba.js"><link rel="prefetch" href="/blog_dev/assets/js/296.991a0da7.js"><link rel="prefetch" href="/blog_dev/assets/js/297.ec2fb727.js"><link rel="prefetch" href="/blog_dev/assets/js/298.c43e6ee0.js"><link rel="prefetch" href="/blog_dev/assets/js/299.02e81e03.js"><link rel="prefetch" href="/blog_dev/assets/js/3.bb975429.js"><link rel="prefetch" href="/blog_dev/assets/js/30.351b19a1.js"><link rel="prefetch" href="/blog_dev/assets/js/300.e4df5ed6.js"><link rel="prefetch" href="/blog_dev/assets/js/301.224fc9b4.js"><link rel="prefetch" href="/blog_dev/assets/js/302.ed9189c5.js"><link rel="prefetch" href="/blog_dev/assets/js/303.f0b78d10.js"><link rel="prefetch" href="/blog_dev/assets/js/304.6ec9ed66.js"><link rel="prefetch" href="/blog_dev/assets/js/305.c579e253.js"><link rel="prefetch" href="/blog_dev/assets/js/306.ac462491.js"><link rel="prefetch" href="/blog_dev/assets/js/307.abcd03c4.js"><link rel="prefetch" href="/blog_dev/assets/js/308.401c1772.js"><link rel="prefetch" href="/blog_dev/assets/js/309.84e52cc8.js"><link rel="prefetch" href="/blog_dev/assets/js/310.838924a1.js"><link rel="prefetch" href="/blog_dev/assets/js/311.c2d70590.js"><link rel="prefetch" href="/blog_dev/assets/js/312.892f867d.js"><link rel="prefetch" href="/blog_dev/assets/js/313.3f307c3e.js"><link rel="prefetch" href="/blog_dev/assets/js/314.a3ea90d5.js"><link rel="prefetch" href="/blog_dev/assets/js/315.6b095340.js"><link rel="prefetch" href="/blog_dev/assets/js/316.4f5b4c9b.js"><link rel="prefetch" href="/blog_dev/assets/js/317.66641d59.js"><link rel="prefetch" href="/blog_dev/assets/js/318.652dafd2.js"><link rel="prefetch" href="/blog_dev/assets/js/319.8dd6b519.js"><link rel="prefetch" href="/blog_dev/assets/js/32.fde56041.js"><link rel="prefetch" href="/blog_dev/assets/js/320.1fca28a4.js"><link rel="prefetch" href="/blog_dev/assets/js/321.6a52b165.js"><link rel="prefetch" href="/blog_dev/assets/js/322.4e9919d1.js"><link rel="prefetch" href="/blog_dev/assets/js/323.8a96f35f.js"><link rel="prefetch" href="/blog_dev/assets/js/324.590862d1.js"><link rel="prefetch" href="/blog_dev/assets/js/33.43b6d3a3.js"><link rel="prefetch" href="/blog_dev/assets/js/34.7ba26882.js"><link rel="prefetch" href="/blog_dev/assets/js/35.dd4ed088.js"><link rel="prefetch" href="/blog_dev/assets/js/36.114c5ba1.js"><link rel="prefetch" href="/blog_dev/assets/js/37.1952dd28.js"><link rel="prefetch" href="/blog_dev/assets/js/38.da914b09.js"><link rel="prefetch" href="/blog_dev/assets/js/39.7e26b7b2.js"><link rel="prefetch" href="/blog_dev/assets/js/4.47949fe2.js"><link rel="prefetch" href="/blog_dev/assets/js/40.b53ac1b8.js"><link rel="prefetch" href="/blog_dev/assets/js/41.ae8b1f98.js"><link rel="prefetch" href="/blog_dev/assets/js/42.479e9251.js"><link rel="prefetch" href="/blog_dev/assets/js/43.91d2fa5d.js"><link rel="prefetch" href="/blog_dev/assets/js/44.45a27817.js"><link rel="prefetch" href="/blog_dev/assets/js/45.9ba1f8c4.js"><link rel="prefetch" href="/blog_dev/assets/js/46.2eae6d1e.js"><link rel="prefetch" href="/blog_dev/assets/js/47.95b6f8e1.js"><link rel="prefetch" href="/blog_dev/assets/js/48.f0161ea5.js"><link rel="prefetch" href="/blog_dev/assets/js/49.5d642580.js"><link rel="prefetch" href="/blog_dev/assets/js/5.0ac632f7.js"><link rel="prefetch" href="/blog_dev/assets/js/50.8bd7a35f.js"><link rel="prefetch" href="/blog_dev/assets/js/51.56ae0cc4.js"><link rel="prefetch" href="/blog_dev/assets/js/52.ca920ca8.js"><link rel="prefetch" href="/blog_dev/assets/js/53.173c70ac.js"><link rel="prefetch" href="/blog_dev/assets/js/54.523b339d.js"><link rel="prefetch" href="/blog_dev/assets/js/55.ac75c90f.js"><link rel="prefetch" href="/blog_dev/assets/js/56.2e111d42.js"><link rel="prefetch" href="/blog_dev/assets/js/57.f51b48a0.js"><link rel="prefetch" href="/blog_dev/assets/js/58.1d77fc82.js"><link rel="prefetch" href="/blog_dev/assets/js/59.996c6ec0.js"><link rel="prefetch" href="/blog_dev/assets/js/6.7d92400c.js"><link rel="prefetch" href="/blog_dev/assets/js/60.9b1925f8.js"><link rel="prefetch" href="/blog_dev/assets/js/61.2622607d.js"><link rel="prefetch" href="/blog_dev/assets/js/62.9960ec8b.js"><link rel="prefetch" href="/blog_dev/assets/js/63.cc80d5d8.js"><link rel="prefetch" href="/blog_dev/assets/js/64.cd9d858a.js"><link rel="prefetch" href="/blog_dev/assets/js/65.2e5ca607.js"><link rel="prefetch" href="/blog_dev/assets/js/66.8be3c4c0.js"><link rel="prefetch" href="/blog_dev/assets/js/67.1eefd7d5.js"><link rel="prefetch" href="/blog_dev/assets/js/68.adf762ce.js"><link rel="prefetch" href="/blog_dev/assets/js/69.27c95c35.js"><link rel="prefetch" href="/blog_dev/assets/js/7.01b296e3.js"><link rel="prefetch" href="/blog_dev/assets/js/70.5097ac5d.js"><link rel="prefetch" href="/blog_dev/assets/js/71.e261fe0c.js"><link rel="prefetch" href="/blog_dev/assets/js/72.d5582ca6.js"><link rel="prefetch" href="/blog_dev/assets/js/73.8c99b9a5.js"><link rel="prefetch" href="/blog_dev/assets/js/74.360f75b2.js"><link rel="prefetch" href="/blog_dev/assets/js/75.31152e1a.js"><link rel="prefetch" href="/blog_dev/assets/js/76.1e48dadb.js"><link rel="prefetch" href="/blog_dev/assets/js/77.0d614aa8.js"><link rel="prefetch" href="/blog_dev/assets/js/78.d6dc4f4b.js"><link rel="prefetch" href="/blog_dev/assets/js/79.50283d30.js"><link rel="prefetch" href="/blog_dev/assets/js/8.7983d5a6.js"><link rel="prefetch" href="/blog_dev/assets/js/80.a52496b7.js"><link rel="prefetch" href="/blog_dev/assets/js/81.ea8065b9.js"><link rel="prefetch" href="/blog_dev/assets/js/82.8bc4a3cc.js"><link rel="prefetch" href="/blog_dev/assets/js/83.7fe873c1.js"><link rel="prefetch" href="/blog_dev/assets/js/84.d65a2741.js"><link rel="prefetch" href="/blog_dev/assets/js/85.27a9c21c.js"><link rel="prefetch" href="/blog_dev/assets/js/86.6d7e13c8.js"><link rel="prefetch" href="/blog_dev/assets/js/87.858dd9e0.js"><link rel="prefetch" href="/blog_dev/assets/js/88.c0d83d71.js"><link rel="prefetch" href="/blog_dev/assets/js/89.c6b08127.js"><link rel="prefetch" href="/blog_dev/assets/js/9.f2a5f044.js"><link rel="prefetch" href="/blog_dev/assets/js/90.4338e0cf.js"><link rel="prefetch" href="/blog_dev/assets/js/91.399fb4ca.js"><link rel="prefetch" href="/blog_dev/assets/js/92.ff317d0d.js"><link rel="prefetch" href="/blog_dev/assets/js/93.208e1694.js"><link rel="prefetch" href="/blog_dev/assets/js/94.13d481a5.js"><link rel="prefetch" href="/blog_dev/assets/js/95.984e2214.js"><link rel="prefetch" href="/blog_dev/assets/js/96.c1a273fa.js"><link rel="prefetch" href="/blog_dev/assets/js/97.bcbd1649.js"><link rel="prefetch" href="/blog_dev/assets/js/98.3fa49da9.js"><link rel="prefetch" href="/blog_dev/assets/js/99.fc09a5b7.js">
    <link rel="stylesheet" href="/blog_dev/assets/css/0.styles.e9faf17d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog_dev/" class="home-link router-link-active"><!----> <span class="site-name">hailiting Blog</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <!----></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><!---->  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Angular</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>CSS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Demo笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Flutter</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>HTML</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog_dev/HTTP协议和反向代理.html" class="sidebar-link">浏览器行为与HTTP协议</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Java</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>JavaScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>NodeJS</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>PHP</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>React</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>ReactNative</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Rust</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>TypeScript</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Vue</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>Wechat</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mongodb</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>mysql</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>npm</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>redis</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>区块链</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/blog_dev/区块链/DeFi.html" class="sidebar-link">DeFi 现实世界金融秩序的去中心化重构</a></li><li><a href="/blog_dev/区块链/EVM简介.html" class="sidebar-link">EVM 简介</a></li><li><a href="/blog_dev/区块链/Ethereum.html" class="sidebar-link">以太坊 Ethereum</a></li><li><a href="/blog_dev/区块链/Geth源码解析.html" class="sidebar-link">Geth 源码解析</a></li><li><a href="/blog_dev/区块链/Kotlin学习.html" class="sidebar-link">Kotlin 学习</a></li><li><a href="/blog_dev/区块链/MPT.html" class="sidebar-link">MPT Merkel-Patricia Tree</a></li><li><a href="/blog_dev/区块链/MetaMask报错集.html" class="sidebar-link">MetaMask 报错集</a></li><li><a href="/blog_dev/区块链/MetaMask网络地址.html" class="sidebar-link">MetaMask 网络地址</a></li><li><a href="/blog_dev/%E5%8C%BA%E5%9D%97%E9%93%BE/" aria-current="page" class="sidebar-link">区块链</a></li><li><a href="/blog_dev/区块链/Sha256加密字符串.html" class="sidebar-link">Sha256 加密字符串</a></li><li><a href="/blog_dev/区块链/Solidity简介.html" class="sidebar-link">Solidity 简介</a></li><li><a href="/blog_dev/区块链/SubQuery_HelloWorld.html" class="sidebar-link">SubQuery HelloWorld</a></li><li><a href="/blog_dev/区块链/Substrate入门.html" class="sidebar-link">Substrate 入门</a></li><li><a href="/blog_dev/区块链/solidity深入理解.html" class="sidebar-link">Solidity 深入理解</a></li><li><a href="/blog_dev/区块链/web3js简介.html" class="sidebar-link">web3js</a></li><li><a href="/blog_dev/区块链/一个水龙头合约.html" class="sidebar-link">一个水龙头合约</a></li><li><a href="/blog_dev/区块链/代币合约ERC20.html" class="sidebar-link">ERC20 代币合约</a></li><li><a href="/blog_dev/区块链/代币合约ERC20学习.html" class="sidebar-link">/区块链/代币合约ERC20学习.html</a></li><li><a href="/blog_dev/区块链/代币合约简单.html" class="sidebar-link">简单代币合约</a></li><li><a href="/blog_dev/区块链/以太坊交易.html" class="sidebar-link">以太坊交易</a></li><li><a href="/blog_dev/区块链/以太坊客户端.html" class="sidebar-link">以太坊客户端</a></li><li><a href="/blog_dev/区块链/以太坊白皮书.html" class="sidebar-link">以太坊白皮书</a></li><li><a href="/blog_dev/区块链/以太坊账户.html" class="sidebar-link">以太坊账户 EthereumAccounts</a></li><li><a href="/blog_dev/区块链/以太坊难度调整.html" class="sidebar-link">以太坊难度调整</a></li><li><a href="/blog_dev/区块链/区块链理论基础.html" class="sidebar-link">区块链理论基础</a></li><li><a href="/blog_dev/区块链/基于Polkadot的跨链.html" class="sidebar-link">基于 Polkadot 的跨链</a></li><li><a href="/blog_dev/区块链/基于token的投票.html" class="active sidebar-link">基于 token 的投票 - 用 truffle 构建简单投票 DApp</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#准备工作" class="sidebar-link">准备工作</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#用-geth-启动私链" class="sidebar-link">用 Geth 启动私链</a></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#工作流" class="sidebar-link">工作流：</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#truffle" class="sidebar-link">Truffle</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#安装" class="sidebar-link">安装</a></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#truggle-简介" class="sidebar-link">truggle 简介</a></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#truffle-的客户端" class="sidebar-link">truffle 的客户端</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#创建-voting-项目" class="sidebar-link">创建 Voting 项目</a></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#migration" class="sidebar-link">Migration</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#migration-概念" class="sidebar-link">Migration 概念</a></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#更新-truffle-配置文件" class="sidebar-link">更新 truffle 配置文件</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#合约代码" class="sidebar-link">合约代码</a></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#编译智能合约" class="sidebar-link">编译智能合约</a></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#创建账户" class="sidebar-link">创建账户</a></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#部署" class="sidebar-link">部署</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#出现问题和解决方案" class="sidebar-link">出现问题和解决方案</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#控制台和网页交互" class="sidebar-link">控制台和网页交互</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#控制台交互" class="sidebar-link">控制台交互</a></li></ul></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#测试" class="sidebar-link">测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#solidity" class="sidebar-link">solidity</a></li><li class="sidebar-sub-header"><a href="/blog_dev/区块链/基于token的投票.html#javascript" class="sidebar-link">JavaScript</a></li></ul></li></ul></li><li><a href="/blog_dev/区块链/如何获取DOT测试币.html" class="sidebar-link">如何获取 DOT 测试币</a></li><li><a href="/blog_dev/区块链/用Geth搭建以太坊私链.html" class="sidebar-link">用 Geth 搭建以太坊私链</a></li><li><a href="/blog_dev/区块链/用web3js写以太坊脚本.html" class="sidebar-link">用 web3js 写以太坊脚本</a></li><li><a href="/blog_dev/区块链/简单投票DApp.html" class="sidebar-link">简单投票 DApp</a></li><li><a href="/blog_dev/区块链/简单投票DApp_测试.html" class="sidebar-link">简单投票 DApp 测试</a></li><li><a href="/blog_dev/区块链/简单的投票合约.html" class="sidebar-link">简单的投票合约</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>工程化</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>微信公众号</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>每日一道前端面试题</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>浏览器</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>算法与数据结构</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>计算机服务基础</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>课程笔记</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/blog_dev/课程表.html" class="sidebar-link">/课程表.html</a></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>面试之道</span> <span class="arrow right"></span></p> <!----></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="基于-token-的投票-用-truffle-构建简单投票-dapp"><a href="#基于-token-的投票-用-truffle-构建简单投票-dapp" class="header-anchor">#</a> 基于 token 的投票 - 用 truffle 构建简单投票 DApp</h1> <p>在“简单投票 Dapp”中，我们是构建了一个模拟区块链（ganache）上实现的一个投票合约，并且成功地通过 nodejs 控制台和网页与合约进行交互。<br>
在本案例里，将实现以下内容：</p> <ul><li>安装叫 truffle 的以太坊 dapp 框架，它会被用于编译和部署我们的合约。</li> <li>给“简单的 dapp”上做一些更新来适配 truffle</li> <li>编译合约，并将其部署到自己的测试私链。</li> <li>通过 truffle 控制台和网页与合约进行交互</li> <li>对合约进行扩展，加入 token 并能够购买 token 的功能</li> <li>对前端进行扩展，通过网页前端购买 token，并用这些 token 为候选者投票</li></ul> <p><img src="/blog_dev/assets/img/ep_token_01.b1cab6f5.png" alt="ep_token_01.png"></p> <h2 id="准备工作"><a href="#准备工作" class="header-anchor">#</a> 准备工作</h2> <h3 id="用-geth-启动私链"><a href="#用-geth-启动私链" class="header-anchor">#</a> 用 Geth 启动私链</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;</span> nohup geth <span class="token operator">--</span>datadir <span class="token punctuation">.</span><span class="token operator">/</span>myChain<span class="token operator">/</span> <span class="token operator">--</span>networkid <span class="token number">15</span> <span class="token operator">--</span>rpc <span class="token operator">--</span>rpcapi<span class="token operator">=</span><span class="token string">&quot;db,eth,net,web3,personal,miner&quot;</span> <span class="token operator">--</span>rpcport <span class="token number">8545</span> <span class="token operator">--</span>rpcaddr <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">--</span>rpccorsdomain <span class="token string">&quot;*&quot;</span> <span class="token number">2</span><span class="token operator">&gt;</span>output<span class="token punctuation">.</span>log <span class="token operator">--</span>allow<span class="token operator">-</span>insecure<span class="token operator">-</span>unlock
<span class="token operator">&gt;</span> geth <span class="token operator">--</span>datadir <span class="token punctuation">.</span><span class="token operator">/</span>myChain<span class="token operator">/</span> <span class="token operator">--</span>rpc  <span class="token operator">--</span>rpcapi<span class="token operator">=</span><span class="token string">&quot;db,eth,net,web3,personal,miner&quot;</span> <span class="token operator">--</span>networkid <span class="token number">523</span> <span class="token operator">--</span>nodiscover console <span class="token number">2</span><span class="token operator">&gt;</span>eth_output<span class="token punctuation">.</span>log <span class="token operator">--</span>allow<span class="token operator">-</span>insecure<span class="token operator">-</span>unlock


</code></pre></div><ul><li><code>--datadir</code>: 指定区块链数据的存储目录，这里我们就在<code>./myChain/</code>目录启动</li> <li><code>rpc</code>: 启用 <code>HTTP-RPC</code> 服务器</li> <li><code>rpcport 8545 --recaddr 127.0.0.1</code>: 这是我们将要用 web3js 库与区块链服务器（geth）进行通信的服务器主机地址和监听端口</li> <li><code>rpccorsdomain value</code>: 允许跨域请求和域名列表（逗号分离，浏览器强制）</li></ul> <blockquote><p>本文里的节点<code>node</code>，<code>geth</code>，区块链软件(<code>blockchain software</code>)，区块链服务器(blockchain server)，客户端(client)，实际上指的都是同一个
<strong>如果我们直接链接测试网络，可以用下面的命令</strong></p></blockquote> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;</span>nohup geth <span class="token operator">--</span>testnet <span class="token operator">--</span>syncmode fast <span class="token operator">--</span>rpc <span class="token operator">--</span>rpcapi db<span class="token punctuation">,</span>eth<span class="token punctuation">,</span>net<span class="token punctuation">,</span>web3<span class="token punctuation">,</span>personal <span class="token operator">--</span>cache<span class="token operator">=</span><span class="token number">1024</span> <span class="token operator">--</span>rpcport <span class="token number">8545</span> <span class="token operator">--</span>rpcaddr <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">--</span>rpccorsdomain <span class="token string">&quot;*&quot;</span> <span class="token number">2</span><span class="token operator">&gt;</span>output<span class="token punctuation">.</span>log <span class="token operator">&amp;</span>
</code></pre></div><ul><li><code>testnet</code>: 就是告诉<code>geth</code>启动并连接到最新的 测试 网络。我们所链接的网络是 Ropsten.</li> <li><code>syncmode fast</code>: 用 fast 模式同步区块链</li></ul> <p>启用 Rinkeby 测试网络</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;</span> geth <span class="token operator">--</span>rinkeby <span class="token operator">--</span>syncmode <span class="token string">&quot;fast&quot;</span> <span class="token operator">--</span>rpc <span class="token operator">--</span>rpcapi db<span class="token punctuation">,</span>eth<span class="token punctuation">,</span>net<span class="token punctuation">,</span>web3<span class="token punctuation">,</span>personal <span class="token operator">--</span>cache<span class="token operator">=</span><span class="token number">1024</span> <span class="token operator">--</span>rpcport <span class="token number">8545</span> <span class="token operator">--</span>rpcaddr <span class="token number">127.0</span><span class="token number">.0</span><span class="token number">.1</span> <span class="token operator">--</span>rpccorsdomain <span class="token string">&quot;*&quot;</span> <span class="token operator">--</span>allow<span class="token operator">-</span>insecure<span class="token operator">-</span>unlock
</code></pre></div><ul><li><code>Full Sync</code>: 从周围节点获取 block headers, block bodies,并且从初始化区块开始重演每一步交易以验证每一个状态。</li> <li><code>Fast Sync</code>: 从周围节点获取 block headers, block bodies, 但不会重演交易（只拿 receipts）。这样就会拿到所有状态的快照（不验证），从此跟全节点一样参与到网络中。</li> <li><code>Light Sync</code>: 只拿当前状态（没有历史账本数据）。如果要验证一笔交易，就必须从另外的全节点处获取历史数据。</li></ul> <h3 id="工作流"><a href="#工作流" class="header-anchor">#</a> 工作流：</h3> <p>基于以太坊的去中心化应用，workflow 可能是这样的：</p> <ul><li>Development(开发环境)：Ganache</li> <li>Staging/Testing(模拟/测试环境)：Ropsten, Rinkeby, Kovan or your own private network</li> <li>Production(生产环境)：Mainnet</li></ul> <h2 id="truffle"><a href="#truffle" class="header-anchor">#</a> Truffle</h2> <p>开发前，先启动 geth</p> <h3 id="安装"><a href="#安装" class="header-anchor">#</a> 安装</h3> <p>truffle 是一个 dapp 的开发框架，它可以使得 dapp 的构建和管理非常容易。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;</span> npm install <span class="token operator">-</span>g truffle
<span class="token operator">&gt;</span> truffle <span class="token operator">-</span>v                           <span class="token function">──</span><span class="token punctuation">(</span>四<span class="token punctuation">,</span> <span class="token number">610</span><span class="token punctuation">)</span>─┘
Truffle v5<span class="token punctuation">.</span><span class="token number">3.9</span> <span class="token operator">-</span> a development framework <span class="token keyword">for</span> Ethereum

</code></pre></div><p>然后我们创建一个空目录，在下面创建 truffle 项目</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;</span> mkdir simple_voting_by_truffle_dapp
<span class="token operator">&gt;</span> cd simple_voting_by_truffle_dapp
<span class="token operator">&gt;</span> npm install <span class="token operator">-</span>g webpack
<span class="token operator">&gt;</span> truffle unbox webpack
</code></pre></div><ul><li><code>truffle init</code>: 在当前目录初始化一个新的 truffle 空项目（项目文件只有 truffle-config 和 truffle.js; contracts 目录只有 Migrations.sol;migrations 目录只有 1_initial_migration.js）</li> <li><code>truffle unbox</code>: 直接下载一个<code>truffle.box</code>，即一个预先构建好的 truffle 项目；
<ul><li>unbox 的时间会相对长一点，完成之后应该看到这样的提示</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Unbox successsful<span class="token punctuation">,</span> Sweet<span class="token operator">!</span>
</code></pre></div></li></ul> <h3 id="truggle-简介"><a href="#truggle-简介" class="header-anchor">#</a> truggle 简介</h3> <p>Truffle 是目前最流行的以太坊 DApp 开发框架，（按官网说法）是一个世界级的开发环境和测试框架，也是所有使用了 EVM 的区块链的资产管理通道，它基于 JavaScript，致力于让以太坊上的开发变的简单。<br>
Truffle 有以下功能：</p> <ul><li>内置的智能合约编译，链接，部署和二进制文件的管理</li> <li>合约自动测试，方便快速开发</li> <li>脚本化，可扩展的部署与发布框架</li> <li>可部署到任意数量公网或私链的网络环境管理功能</li> <li>使用 EthPM 和 NPM 提供的包管理，使用 ERC190 标准</li> <li>与合约直接通信的直接交互控制台(写完合约就可以命令行里验证了)</li> <li>可配的构建流程，支持紧密集成</li> <li>在 Truffle 环境里支持执行外部脚本</li></ul> <h3 id="truffle-的客户端"><a href="#truffle-的客户端" class="header-anchor">#</a> truffle 的客户端</h3> <p>测试可以到测试网，也可以到私链上，私链推荐使用以下两种方式</p> <ul><li>Ganache</li> <li>truffle develop</li></ul> <p><strong>Ganache</strong>
Ganache 的前身是 testRPC
<strong>truffle develop</strong>
truffle develop 是 truffle 内置的客户端，<code>&gt; truffle develop</code>直接开启客户端。
需要注意的是：truffle develop 里执行 truffle 命令的时候需要省略前面的 truffle，比如<code>truffle compile</code>只要敲<code>compile</code>就好。</p> <h2 id="创建-voting-项目"><a href="#创建-voting-项目" class="header-anchor">#</a> 创建 Voting 项目</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;</span>  ls
<span class="token constant">README</span><span class="token punctuation">.</span>md contracts node_modules test webpack<span class="token punctuation">.</span>config<span class="token punctuation">.</span>js truffle<span class="token punctuation">.</span>js app migrations
<span class="token operator">&gt;</span> ls app<span class="token operator">/</span>
index<span class="token punctuation">.</span>html  javascripts stylesheets
<span class="token operator">&gt;</span> ls contracts<span class="token operator">/</span>
ConvertLib<span class="token punctuation">.</span>sol MetaCoin<span class="token punctuation">.</span>sol Migrations<span class="token punctuation">.</span>sol
<span class="token operator">&gt;</span> ls migrations<span class="token operator">/</span>
<span class="token number">1</span>_initial_migration<span class="token punctuation">.</span>js <span class="token number">2</span>_deploy_contracts<span class="token punctuation">.</span>js
</code></pre></div><ul><li>app/ - 应用文件运行的默认目录，这里包括推荐的 JavaScript 文件和 css 样式文件目录，但你可以完全决定如何使用这些目录</li> <li>contract/ - Truffle 默认的合约文件存放目录</li> <li>migrations/ - 部署脚本文件的存放目录</li> <li>test/ - 用来测试应用和合约的测试文件目录</li> <li>truffle.js - Truffle 的配置文件</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>rm contracts<span class="token operator">/</span>ConvertLib<span class="token punctuation">.</span>sol contracts<span class="token operator">/</span>MetaCoin<span class="token punctuation">.</span>sol
</code></pre></div><p>找到 truffle.js，将端口号从<code>7545</code>改为<code>8545</code>，因为私链及 ganache 默认端口是这个。</p> <h2 id="migration"><a href="#migration" class="header-anchor">#</a> Migration</h2> <h3 id="migration-概念"><a href="#migration-概念" class="header-anchor">#</a> Migration 概念</h3> <p>迁移文件用于将合约部署到区块链上。truffle 将会部署和跟踪所有的部署。
<code>Migrations</code>(迁移)是 JavaScript 文件，这些文件负责暂存部署的任务，并假定部署需求会随着时间的推移而改变。随着项目的发展，我们应该创建新的迁移脚本，来改变链上的合约状态。所有运行过的 migration 历史记录，都会通过特殊迁移合约记录在链上。
<strong>1_initial_migration.js</strong>
第一个迁移<code>1_inital_migration.js</code>向区块链部署一个叫<code>Migration</code>的合约，并用于存储你已经部署的最新合约。每次你运行 migration 时，truffle 会向区块链查询获取最新已部署好的合约，然后部署尚未部署的任何合约。然后会更新<code>Migrations</code>合约中的<code>last_completed_migration</code>字段指向最新部署的合约。可以简单的当他是一个数据库表。里面有一列<code>last_completed_migration</code>，该列总是保持最新状态。
<strong>migration 文件命名要求</strong></p> <ul><li>前缀必须是一个数字，用于标记迁移是否运行成功</li> <li>后缀是一个描述词汇，只是单纯为提高可读性，方便理解</li></ul> <p>在脚本的开始，我们用<code>artifacts.require()</code>方法告诉 truffle 需要进行部署迁移的合约，这跟 node 里的 require 很类似。不过需要注意 ，最新的官方文档告诫，应该传入定义的合约名称，而不要给 文件名称，因为一个<code>.sol</code>文件中可能包含多个 contract。
<code>migration js</code>里的<code>exports</code>的函数，需要接收一个<code>deployer</code>对象作为第一个参数。这个对象在部署发布的过程中，主要用来提供清晰的语法支持，同时提供一些通用的合约部署职责，比如保存部署的文件以备稍后使用。deployer 对象是用来暂存（stage）部署任务的主要操作接口。
像所有其它 Truffle 中的代码一样，Truffle 提供了代码的合约抽象层（contract abstractions），并且进行初始化，以方便可以便利与以太坊的网络交互。这些抽象接口都是部署流程的一部分。</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// 2_deploy_contracts.js</span>
<span class="token keyword">const</span> ConvertLib <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;ConvertLib&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> MetaCoin <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;MetaCoin&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">deployer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>ConvertLib<span class="token punctuation">)</span><span class="token punctuation">;</span>
  deployer<span class="token punctuation">.</span><span class="token function">link</span><span class="token punctuation">(</span>ConvertLib<span class="token punctuation">,</span> MetaCoin<span class="token punctuation">)</span><span class="token punctuation">;</span>
  deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>MetaCoin<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="更新-truffle-配置文件"><a href="#更新-truffle-配置文件" class="header-anchor">#</a> 更新 truffle 配置文件</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// truffle-config.js</span>
<span class="token comment">// 应用到所有migration 全局变量</span>
<span class="token comment">// 2_deploy_contracts.js 如果不设置gas  将是470000</span>
module<span class="token punctuation">.</span>exports <span class="token operator">=</span> <span class="token punctuation">{</span>
  networks<span class="token operator">:</span> <span class="token punctuation">{</span>
    development<span class="token operator">:</span> <span class="token punctuation">{</span>
      host<span class="token operator">:</span> <span class="token string">&quot;localhost&quot;</span><span class="token punctuation">,</span>
      port<span class="token operator">:</span> <span class="token number">8545</span><span class="token punctuation">,</span>
      network_id<span class="token operator">:</span> <span class="token string">&quot;*&quot;</span><span class="token punctuation">,</span> <span class="token comment">// Match any network id</span>
      gas<span class="token operator">:</span> <span class="token number">5000000</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  compilers<span class="token operator">:</span> <span class="token punctuation">{</span>
    solc<span class="token operator">:</span> <span class="token punctuation">{</span>
      settings<span class="token operator">:</span> <span class="token punctuation">{</span>
        optimizer<span class="token operator">:</span> <span class="token punctuation">{</span>
          enabled<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token comment">// Default: false</span>
          runs<span class="token operator">:</span> <span class="token number">200</span><span class="token punctuation">,</span> <span class="token comment">// Default: 200</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="合约代码"><a href="#合约代码" class="header-anchor">#</a> 合约代码</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;</span> cp <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token operator">/</span>simple_voting_dapp<span class="token operator">/</span>Voting<span class="token punctuation">.</span>sol contracts<span class="token operator">/</span>
<span class="token operator">&gt;</span> ls contracts<span class="token operator">/</span>
Migrations<span class="token punctuation">.</span>sol Voting<span class="token punctuation">.</span>sol
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// Voting.sol</span>
<span class="token comment">// SPDX-License-Identifier: MIT</span>
pragma solidity <span class="token operator">&gt;</span><span class="token number">0.4</span><span class="token number">.22</span><span class="token punctuation">;</span>

contract Voting <span class="token punctuation">{</span>
    struct voter <span class="token punctuation">{</span>
        address voterAddress<span class="token punctuation">;</span>
        uint256 tokensBought<span class="token punctuation">;</span>
        uint256<span class="token punctuation">[</span><span class="token punctuation">]</span> tokensUsedPerCandidate<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token function">mapping</span><span class="token punctuation">(</span><span class="token parameter">address</span> <span class="token operator">=&gt;</span> voter<span class="token punctuation">)</span> <span class="token keyword">public</span> voterInfo<span class="token punctuation">;</span>
    <span class="token function">mapping</span><span class="token punctuation">(</span><span class="token parameter">bytes32</span> <span class="token operator">=&gt;</span> uint256<span class="token punctuation">)</span> <span class="token keyword">public</span> votesReceived<span class="token punctuation">;</span>
    bytes32<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">public</span> candidateList<span class="token punctuation">;</span>
    uint256 <span class="token keyword">public</span> totalTokens<span class="token punctuation">;</span>
    uint256 <span class="token keyword">public</span> balanceTokens<span class="token punctuation">;</span>
    uint256 <span class="token keyword">public</span> tokenPrice<span class="token punctuation">;</span>

    <span class="token function">constructor</span><span class="token punctuation">(</span>
        uint256 tokens<span class="token punctuation">,</span>
        uint256 pricePerToken<span class="token punctuation">,</span>
        bytes32<span class="token punctuation">[</span><span class="token punctuation">]</span> memory candidateNames
    <span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        candidateList <span class="token operator">=</span> candidateNames<span class="token punctuation">;</span>
        totalTokens <span class="token operator">=</span> tokens<span class="token punctuation">;</span>
        balanceTokens <span class="token operator">=</span> tokens<span class="token punctuation">;</span>
        tokenPrice <span class="token operator">=</span> pricePerToken<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> payable <span class="token function">returns</span> <span class="token punctuation">(</span><span class="token parameter">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        uint256 tokensToBuy <span class="token operator">=</span> msg<span class="token punctuation">.</span>value <span class="token operator">/</span> tokenPrice<span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span>tokensToBuy <span class="token operator">&lt;=</span> balanceTokens<span class="token punctuation">)</span><span class="token punctuation">;</span>
        voterInfo<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">.</span>voterAddress <span class="token operator">=</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
        voterInfo<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">.</span>tokensBought <span class="token operator">+=</span> tokensToBuy<span class="token punctuation">;</span>
        balanceTokens <span class="token operator">-=</span> tokensToBuy<span class="token punctuation">;</span>
        <span class="token keyword">return</span> tokensToBuy<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">totalVotesFor</span><span class="token punctuation">(</span><span class="token parameter">bytes32 candidate</span><span class="token punctuation">)</span> <span class="token keyword">public</span> view <span class="token function">returns</span> <span class="token punctuation">(</span><span class="token parameter">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> votesReceived<span class="token punctuation">[</span>candidate<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">voteForCandidate</span><span class="token punctuation">(</span><span class="token parameter">bytes32 candidate<span class="token punctuation">,</span> uint256 votesInTokens</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        uint256 index <span class="token operator">=</span> <span class="token function">indexOfCandidate</span><span class="token punctuation">(</span>candidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span>index <span class="token operator">!=</span> <span class="token function">uint256</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>voterInfo<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">.</span>tokensUsedPerCandidate<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">for</span> <span class="token punctuation">(</span>uint256 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> candidateList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                voterInfo<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">.</span>tokensUsedPerCandidate<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        uint256 availableTokens <span class="token operator">=</span>
            voterInfo<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">.</span>tokensBought <span class="token operator">-</span>
                <span class="token function">totalTokensUsed</span><span class="token punctuation">(</span>voterInfo<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">.</span>tokensUsedPerCandidate<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">require</span><span class="token punctuation">(</span>availableTokens <span class="token operator">&gt;=</span> votesInTokens<span class="token punctuation">)</span><span class="token punctuation">;</span>
        votesReceived<span class="token punctuation">[</span>candidate<span class="token punctuation">]</span> <span class="token operator">+=</span> votesInTokens<span class="token punctuation">;</span>
        voterInfo<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">.</span>tokensUsedPerCandidate<span class="token punctuation">[</span>index<span class="token punctuation">]</span> <span class="token operator">+=</span> votesInTokens<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">totalTokensUsed</span><span class="token punctuation">(</span><span class="token parameter">uint256<span class="token punctuation">[</span><span class="token punctuation">]</span> memory _tokensUsedPerCandidate</span><span class="token punctuation">)</span>
        <span class="token keyword">private</span>
        pure
        <span class="token function">returns</span> <span class="token punctuation">(</span><span class="token parameter">uint256</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        uint256 totalUsedTokens <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>uint256 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> _tokensUsedPerCandidate<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            totalUsedTokens <span class="token operator">+=</span> _tokensUsedPerCandidate<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> totalUsedTokens<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">indexOfCandidate</span><span class="token punctuation">(</span><span class="token parameter">bytes32 candidate</span><span class="token punctuation">)</span> <span class="token keyword">public</span> view <span class="token function">returns</span> <span class="token punctuation">(</span><span class="token parameter">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span>uint256 i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> candidateList<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">if</span> <span class="token punctuation">(</span>candidateList<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">==</span> candidate<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> i<span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        <span class="token keyword">return</span> <span class="token function">uint256</span><span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">tokensSold</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> view <span class="token function">returns</span> <span class="token punctuation">(</span><span class="token parameter">uint256</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> totalTokens <span class="token operator">-</span> balanceTokens<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">voterDetails</span><span class="token punctuation">(</span><span class="token parameter">address user</span><span class="token punctuation">)</span>
        <span class="token keyword">public</span>
        view
        <span class="token function">returns</span> <span class="token punctuation">(</span><span class="token parameter">uint256<span class="token punctuation">,</span> uint256<span class="token punctuation">[</span><span class="token punctuation">]</span> memory</span><span class="token punctuation">)</span>
    <span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token punctuation">(</span>
            voterInfo<span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token punctuation">.</span>tokensBought<span class="token punctuation">,</span>
            voterInfo<span class="token punctuation">[</span>user<span class="token punctuation">]</span><span class="token punctuation">.</span>tokensUsedPerCandidate
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">transferTo</span><span class="token punctuation">(</span><span class="token parameter">address payable account</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
        account<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token function">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">.</span>balance<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">allCandidates</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> view <span class="token function">returns</span> <span class="token punctuation">(</span><span class="token parameter">bytes32<span class="token punctuation">[</span><span class="token punctuation">]</span> memory</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> candidateList<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>candidateList</code>储存所有候选者</li> <li>定义一个 voter 是<code>struct</code>数据类型，<code>struct</code>类型里有<code>getter</code>和 <code>setter</code>方法获取这些属性
<ul><li>address voterAddress</li> <li>uint tokensBough 已经购买的所有 token</li> <li>uint[] tokensUsedPerCandidate 候选者投票所用的 token</li></ul></li> <li>voterInfo 是一个 mapping, 给定一个投票人的账户地址，就可以显示他的信息</li> <li>Tokens: 需要有存储发行 token 总量的合约变量，还需要存储所有剩余 token 和每个 token 价格</li></ul> <h2 id="编译智能合约"><a href="#编译智能合约" class="header-anchor">#</a> 编译智能合约</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;</span> truffle compile
</code></pre></div><h2 id="创建账户"><a href="#创建账户" class="header-anchor">#</a> 创建账户</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;</span> truffle console
<span class="token operator">&gt;</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>personal<span class="token punctuation">.</span><span class="token function">newAccount</span><span class="token punctuation">(</span><span class="token string">&quot;verystrongpassword&quot;</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>personal<span class="token punctuation">.</span><span class="token function">unlockAccount</span><span class="token punctuation">(</span><span class="token string">&quot;0xf1DE2d4c9DA3201B82402b4c3cD06E7E128A1430&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;verystrongpassword&quot;</span><span class="token punctuation">,</span> <span class="token number">15000</span><span class="token punctuation">)</span>
<span class="token operator">&gt;</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span><span class="token string">&quot;0xf1DE2d4c9DA3201B82402b4c3cD06E7E128A1430&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">res</span><span class="token punctuation">)</span><span class="token punctuation">{</span>console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">fromWei</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>res<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">&quot;ether&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre></div><h4 id="buy-函数"><a href="#buy-函数" class="header-anchor">#</a> buy 函数</h4> <div class="language-js extra-class"><pre class="language-js"><code>  <span class="token keyword">function</span> <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span> payable <span class="token keyword">public</span> <span class="token function">returns</span> <span class="token punctuation">(</span><span class="token parameter">uint</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    uint tokensToBuy <span class="token operator">=</span> msg<span class="token punctuation">.</span>value<span class="token operator">/</span>tokenPrice<span class="token punctuation">;</span>
    <span class="token function">require</span><span class="token punctuation">(</span>tokensToBuy<span class="token operator">&lt;=</span>balanceTokens<span class="token punctuation">)</span><span class="token punctuation">;</span>
    voterInfo<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">.</span>voterAddress<span class="token operator">=</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">;</span>
    voterInfo<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span><span class="token punctuation">.</span>tokensBought <span class="token operator">+=</span> tokensToBuy<span class="token punctuation">;</span>
    balanceTokens<span class="token operator">-=</span>tokensToBuy<span class="token punctuation">;</span>
    <span class="token keyword">return</span> tokensToBuy<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
</code></pre></div><ul><li>tokenPrice 每一个 token 的价钱</li> <li>balanceTokens 合约可用 token 总和</li> <li>msg.value 以太的值</li> <li>tokensToBuy 基于以太的值和 token 的价格，可以计算出你所有的 token，并 将这些 token 赋予购买人，购买人的地址通过 msg.sender 可以获取</li> <li>返回总共买了多少 token</li></ul> <h5 id="用-truffle-控制台调用-buy-的一个案例-参数传入一个-options-对象"><a href="#用-truffle-控制台调用-buy-的一个案例-参数传入一个-options-对象" class="header-anchor">#</a> 用 truffle 控制台调用 buy 的一个案例，参数传入一个 options 对象</h5> <ul><li>web3 v0.2.x 的用法</li></ul> <div class="language-js extra-class"><pre class="language-js"><code><span class="token function">truffle</span><span class="token punctuation">(</span>development<span class="token punctuation">)</span> <span class="token operator">&gt;</span>
  Voting<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">contract</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    contract<span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      value<span class="token operator">:</span> web3<span class="token punctuation">.</span><span class="token function">toWei</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ether&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">from</span><span class="token operator">:</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>accounts<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li>web3 v1.0</li></ul> <div class="language-js extra-class"><pre class="language-js"><code>contract<span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span> options <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>如果是消息调用的话应该是</p> <div class="language-js extra-class"><pre class="language-js"><code>contract<span class="token punctuation">.</span><span class="token function">method</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">{</span> options <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="部署"><a href="#部署" class="header-anchor">#</a> 部署</h2> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;</span> truffle compile
Compiling Migrations<span class="token punctuation">.</span>sol<span class="token operator">...</span>Compiling Voting<span class="token punctuation">.</span>sol<span class="token operator">...</span>Writing
<span class="token operator">&gt;</span> truffle migrate
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">var</span> Voting <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;Voting&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
module<span class="token punctuation">.</span><span class="token function-variable function">exports</span> <span class="token operator">=</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">deployer</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  deployer<span class="token punctuation">.</span><span class="token function">deploy</span><span class="token punctuation">(</span>Voting<span class="token punctuation">,</span> <span class="token number">10000</span><span class="token punctuation">,</span> web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">toWei</span><span class="token punctuation">(</span><span class="token string">&quot;0.01&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ether&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>
    web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">fromAscii</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">fromAscii</span><span class="token punctuation">(</span><span class="token string">&quot;Bob&quot;</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">fromAscii</span><span class="token punctuation">(</span><span class="token string">&quot;Cary&quot;</span><span class="token punctuation">,</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><ol><li>一个候选人(比如 Alice)有多少投票?</li></ol></li> <li><ol start="2"><li>一共初始化了多少 token?</li></ol></li> <li><ol start="3"><li>已经售出了多少 token?</li></ol></li> <li><ol start="4"><li>购买 100 token</li></ol></li> <li><ol start="5"><li>购买以后账户余额是多少?</li></ol></li> <li><ol start="6"><li>已经售出了多少?</li></ol></li> <li><ol start="7"><li>给 Alice 投 25 个 token，给 Bob 和 Cary 各投 10 个 token。</li></ol></li> <li><ol start="8"><li>查询你所投账户的投票人信息(除非用了其他账户，否则你的账户默认是 web3.eth.accounts[0])</li></ol></li> <li><ol start="9"><li>现在每个候选人有多少投票?</li></ol></li> <li><ol start="10"><li>合约里有多少 ETH?(当你通过 ETH 购买 token 时，合约接收到的 ETH)</li></ol></li></ul> <div class="language-js extra-class"><pre class="language-js"><code>Voting<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  instance<span class="token punctuation">.</span><span class="token function">totalVotesFor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    instance<span class="token punctuation">.</span><span class="token function">totalTokens</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    instance<span class="token punctuation">.</span><span class="token function">tokensSold</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    instance<span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token operator">:</span> web3<span class="token punctuation">.</span><span class="token function">toWei</span><span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;ether&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
Voting<span class="token punctuation">.</span><span class="token function">deloyed</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    instance<span class="token punctuation">.</span><span class="token function">voteForCandidate</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">,</span> <span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    instance<span class="token punctuation">.</span><span class="token function">voteForCandidate</span><span class="token punctuation">(</span><span class="token string">&quot;Cary&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>
    instance<span class="token punctuation">.</span><span class="token function">voterDetails</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">instance</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    instance<span class="token punctuation">.</span><span class="token function">totalVotesFor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>Voting<span class="token punctuation">.</span>address<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toNumber</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre></div><h3 id="出现问题和解决方案"><a href="#出现问题和解决方案" class="header-anchor">#</a> 出现问题和解决方案</h3> <ol><li>如果由于 gas 不足而部署失败，尝试将<code>migrations/2_deploy_contracts.js</code>里面的<code>gas account</code>增加至 500000。比如：<code>deployer.deploy(Voting, [&quot;Rama&quot;,&quot;Nick&quot;,&quot;Jose&quot;], {gas: 500000})</code>;</li> <li>如果有多个账户，并且更喜欢自选一个账户，而不是<code>accounts[0]</code>，可以在<code>truffle.js</code>中指定想要使用的账户地址，在 network_id 后面添加<code>from: your address</code>，truffle 将会使用你指定的地址来部署和交互。</li></ol> <h2 id="控制台和网页交互"><a href="#控制台和网页交互" class="header-anchor">#</a> 控制台和网页交互</h2> <p>如果部署顺利，可以通过控制台和网页与合约进行交互。</p> <p><strong>app/index.html</strong>
用上个<code>index.html</code>替换<code>app/index.html</code>内容。</p> <div class="language-html extra-class"><pre class="language-html"><code><span class="token doctype"><span class="token punctuation">&lt;!</span><span class="token doctype-tag">DOCTYPE</span> <span class="token name">html</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>html</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>head</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>title</span><span class="token punctuation">&gt;</span></span>Hello World DApp<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>title</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://fonts.googleapis.com/css?family=Open+Sans:400,700<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>link</span>
      <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">rel</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>stylesheet<span class="token punctuation">&quot;</span></span>
      <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text/css<span class="token punctuation">&quot;</span></span>
    <span class="token punctuation">/&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span><span class="token punctuation">&gt;</span></span><span class="token style"><span class="token language-css">
      <span class="token selector">.margin-top-3</span> <span class="token punctuation">{</span>
        <span class="token property">margin-top</span><span class="token punctuation">:</span> 3em<span class="token punctuation">;</span>
      <span class="token punctuation">}</span>
    </span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>head</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>body</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h1</span><span class="token punctuation">&gt;</span></span>A Simple Hello World Voting Application<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h1</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-sm-7 margin-top-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Candidates<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table-responsive<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table table-bordered<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>thead</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Candidate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>th</span><span class="token punctuation">&gt;</span></span>Votes<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>th</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>thead</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tbody</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>candidate-rows<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Alice<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>candidate-1<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Bob<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>candidate-2<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Cary<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>candidate-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tbody</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>container-fluid<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Vote for Candidate<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>candidate<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Enter the candidate name<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
          <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>vote-tokens<span class="token punctuation">&quot;</span></span>
          <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Total no. of tokens to vote<span class="token punctuation">&quot;</span></span>
        <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>br</span> <span class="token punctuation">/&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>App.voteForCandidate()<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Vote<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-sm-offset-1 col-sm-4 margin-top-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Token Stats<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table-responsive<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>table</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>table table-bordered<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Tokens For Sale<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tokens-total<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Tokens Sold<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tokens-sold<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Price Per Token<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>token-cost<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>tr</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span><span class="token punctuation">&gt;</span></span>Balance in the contract<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
              <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>td</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>contract-balance<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>td</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>tr</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>table</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row margin-top-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Purchase Tokens<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-sm-12<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>buy-msg<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>buy<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-sm-8<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Number of tokens to buy<span class="token punctuation">&quot;</span></span>
          <span class="token punctuation">/&gt;</span></span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>App.buyTokens()<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-primary<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>Buy<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>row margin-top-3<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>h2</span><span class="token punctuation">&gt;</span></span>Lookup Voter Info<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>h2</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-sm-12<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>input</span>
            <span class="token attr-name">type</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>text<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>voter-info<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-sm-8<span class="token punctuation">&quot;</span></span>
            <span class="token attr-name">placeholder</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>Enter the voter address<span class="token punctuation">&quot;</span></span>
          <span class="token punctuation">/&gt;</span></span><span class="token entity named-entity" title="&amp;nbsp;">&amp;nbsp;</span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>a</span> <span class="token attr-name">href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>#<span class="token punctuation">&quot;</span></span> <span class="token attr-name">onclick</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>App.lookupVoterInfo()<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>btn btn-primary<span class="token punctuation">&quot;</span></span>
            <span class="token punctuation">&gt;</span></span>Lookup<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>a</span>
          <span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>voter-details row text-left<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>tokens-bought<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>margin-top-3 col-md-12<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>votes-cast<span class="token punctuation">&quot;</span></span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>col-md-12<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>body</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>https://code.jquery.com/jquery-3.1.1.slim.min.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>script</span> <span class="token attr-name">src</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>./index.js<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span><span class="token script"></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>script</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>html</span><span class="token punctuation">&gt;</span></span>
</code></pre></div><p><strong>app/scripts/index.js</strong></p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token keyword">import</span> <span class="token string">&quot;../styles/app.css&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> Web3 <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;web3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">{</span> <span class="token keyword">default</span> <span class="token keyword">as</span> contract <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;truffle-contract&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> voting_artifacts <span class="token keyword">from</span> <span class="token string">&quot;../../build/contracts/Voting.json&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> Voting <span class="token operator">=</span> <span class="token function">contract</span><span class="token punctuation">(</span>voting_artifacts<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">let</span> candidates <span class="token operator">=</span> <span class="token punctuation">{</span>
  Alice<span class="token operator">:</span> <span class="token string">&quot;candidate-1&quot;</span><span class="token punctuation">,</span>
  Bob<span class="token operator">:</span> <span class="token string">&quot;candidate-2&quot;</span><span class="token punctuation">,</span>
  Cary<span class="token operator">:</span> <span class="token string">&quot;candidate-3&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function-variable function">voteForCandidate</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">candidate</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">let</span> candidateName <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#candidate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span> <span class="token string">&quot;Vote has been submitted. The vote count will increment as soon as the vote is recorded on the blockchain. Please wait.&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#candidate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Voting<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">contractInstance</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        contractInstance<span class="token punctuation">.</span><span class="token function">voteForCandidate</span><span class="token punctuation">(</span>candidateName<span class="token punctuation">,</span>
          <span class="token punctuation">{</span>
            gas<span class="token operator">:</span> <span class="token number">140000</span><span class="token punctuation">,</span>
            <span class="token keyword">from</span><span class="token operator">:</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">let</span> div_id <span class="token operator">=</span> candidates<span class="token punctuation">[</span>candidateName<span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">return</span> contractInstance<span class="token punctuation">.</span><span class="token function">totalVotesFor</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>candidateName<span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span> <span class="token operator">+</span> div_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>err<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token function">$</span><span class="token punctuation">(</span>document<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">ready</span><span class="token punctuation">(</span>
  <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token keyword">typeof</span> web3 <span class="token operator">!==</span> <span class="token string">&quot;undefined&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Using web3 detected from external source like Metamask&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        window<span class="token punctuation">.</span>web3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web3</span><span class="token punctuation">(</span>web3<span class="token punctuation">.</span>currentProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span> <span class="token string">&quot;No web3 detected. Falling back to http://localhost:8545. You should remove this fallback when you deploy live, as it's inherently insecure. Consider switching to Metamask for development. More info here: http://truffleframework.com/tutorials/truffle-and-metamask&quot;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
      window<span class="token punctuation">.</span>web3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web3</span><span class="token punctuation">(</span> <span class="token keyword">new</span> <span class="token class-name">Web3<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>HttpProvider</span><span class="token punctuation">(</span><span class="token string">&quot;http://localhost:8545&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    Voting<span class="token punctuation">.</span><span class="token function">setProvider</span><span class="token punctuation">(</span>web3<span class="token punctuation">.</span>currentProvider<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> candidateNames <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>candidates<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">var</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span>i<span class="token operator">&lt;</span>candidateNames<span class="token punctuation">.</span>length<span class="token punctuation">;</span>i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      <span class="token keyword">let</span> name <span class="token operator">=</span> candidateNames<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      Voting<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
            <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">contractInstance</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                contractInstance<span class="token punctuation">.</span><span class="token function">totalVotesFor</span>
                  <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
                  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
                    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span><span class="token operator">+</span>candidates<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
                  <span class="token punctuation">}</span><span class="token punctuation">)</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// app.js  web3 1.+</span>
<span class="token keyword">import</span> Web3 <span class="token keyword">from</span> <span class="token string">&quot;web3&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> votingArtifact <span class="token keyword">from</span> <span class="token string">&quot;../../build/contracts/Voting.json&quot;</span><span class="token punctuation">;</span>

<span class="token keyword">let</span> candidates <span class="token operator">=</span> <span class="token punctuation">{</span>
  Alice<span class="token operator">:</span> <span class="token string">&quot;candidate-1&quot;</span><span class="token punctuation">,</span>
  Bob<span class="token operator">:</span> <span class="token string">&quot;candidate-2&quot;</span><span class="token punctuation">,</span>
  Cary<span class="token operator">:</span> <span class="token string">&quot;candidate-3&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token keyword">const</span> App <span class="token operator">=</span> <span class="token punctuation">{</span>
  web3<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  account<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  voting<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  tokenPrice<span class="token operator">:</span> <span class="token keyword">null</span><span class="token punctuation">,</span>
  <span class="token function-variable function">start</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> web3 <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
    <span class="token keyword">try</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> networkId <span class="token operator">=</span> <span class="token keyword">await</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>net<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> deployedNetwork <span class="token operator">=</span> votingArtifact<span class="token punctuation">.</span>networks<span class="token punctuation">[</span>networkId<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>voting <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>Contract</span><span class="token punctuation">(</span>
        votingArtifact<span class="token punctuation">.</span>abi<span class="token punctuation">,</span>
        deployedNetwork<span class="token punctuation">.</span>address
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> accounts <span class="token operator">=</span> <span class="token keyword">await</span> web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getAccounts</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>account <span class="token operator">=</span> accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token function">loadCandidatesAndVotes</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>error<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">error</span><span class="token punctuation">(</span><span class="token string">&quot;Нет подключения&quot;</span><span class="token punctuation">,</span> error<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">loadCandidatesAndVotes</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> totalVotesFor <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>voting<span class="token punctuation">.</span>methods<span class="token punctuation">;</span>
    <span class="token keyword">let</span> candidateNames <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>candidates<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> candidateNames<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">let</span> name <span class="token operator">=</span> candidateNames<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">totalVotesFor</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">asciiToHex</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span> <span class="token operator">+</span> candidates<span class="token punctuation">[</span>name<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">lookupVoterInfo</span><span class="token operator">:</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> address <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#voter-info&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> voterDetails <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>voting<span class="token punctuation">.</span>methods<span class="token punctuation">;</span>
    console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">voterDetails</span><span class="token punctuation">(</span>address<span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#tokens-bought&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&quot;Total Tokens bought: &quot;</span> <span class="token operator">+</span> v<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> votesPerCandidate <span class="token operator">=</span> v<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#votes-cast&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">empty</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#votes-cast&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span><span class="token string">&quot;Votes cast per candidate: &lt;br&gt;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">let</span> allCandidates <span class="token operator">=</span> Object<span class="token punctuation">.</span><span class="token function">keys</span><span class="token punctuation">(</span>candidates<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">let</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> allCandidates<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#votes-cast&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">append</span><span class="token punctuation">(</span>
            allCandidates<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;: &quot;</span> <span class="token operator">+</span> votesPerCandidate<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">+</span> <span class="token string">&quot;&lt;br&gt;&quot;</span>
          <span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">buyTokens</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> tokensToBuy <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#buy&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> tokenPrice<span class="token punctuation">,</span> buy <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>voting<span class="token punctuation">.</span>methods<span class="token punctuation">;</span>
    <span class="token function">tokenPrice</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        App<span class="token punctuation">.</span>tokenPrice <span class="token operator">=</span> <span class="token function">parseFloat</span><span class="token punctuation">(</span>App<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">fromWei</span><span class="token punctuation">(</span>v<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#token-cost&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>App<span class="token punctuation">.</span>tokenPrice <span class="token operator">+</span> <span class="token string">&quot; Ether&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">let</span> price <span class="token operator">=</span> tokensToBuy <span class="token operator">*</span> App<span class="token punctuation">.</span>tokenPrice<span class="token punctuation">;</span>
        <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#buy-msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&quot;Purchase order has been submitted. Please wait.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
            value<span class="token operator">:</span> App<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">toWei</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>price<span class="token interpolation-punctuation punctuation">}</span></span><span class="token template-punctuation string">`</span></span><span class="token punctuation">,</span> <span class="token string">&quot;ether&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token keyword">from</span><span class="token operator">:</span> App<span class="token punctuation">.</span>account<span class="token punctuation">,</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span>
          <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#buy-msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">`</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            App<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span><span class="token function">getBalance</span><span class="token punctuation">(</span>App<span class="token punctuation">.</span>account<span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">error<span class="token punctuation">,</span> result</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
              <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#contract-balance&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>
                App<span class="token punctuation">.</span>web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">fromWei</span><span class="token punctuation">(</span>result<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token string">&quot; Ether&quot;</span>
              <span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token function-variable function">voteForCandidate</span><span class="token operator">:</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">let</span> candidateName <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#candidate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> voteTokens <span class="token operator">=</span> <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#vote-tokens&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>
      <span class="token string">&quot;Vote has been submitted. The vote count will increment as soon as the vote is recorded on the blockchain. Please wait.&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#candidate&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#vote-tokens&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">val</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> totalVotesFor<span class="token punctuation">,</span> voteForCandidate <span class="token punctuation">}</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>voting<span class="token punctuation">.</span>methods<span class="token punctuation">;</span>
    <span class="token keyword">await</span> <span class="token function">voteForCandidate</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">asciiToHex</span><span class="token punctuation">(</span>candidateName<span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">toHex</span><span class="token punctuation">(</span>voteTokens<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">send</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
      gas<span class="token operator">:</span> <span class="token number">140000</span><span class="token punctuation">,</span>
      <span class="token keyword">from</span><span class="token operator">:</span> App<span class="token punctuation">.</span>account<span class="token punctuation">,</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">let</span> div_id <span class="token operator">=</span> candidates<span class="token punctuation">[</span>candidateName<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">totalVotesFor</span><span class="token punctuation">(</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>web3<span class="token punctuation">.</span>utils<span class="token punctuation">.</span><span class="token function">asciiToHex</span><span class="token punctuation">(</span>candidateName<span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#&quot;</span> <span class="token operator">+</span> div_id<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span>count<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">$</span><span class="token punctuation">(</span><span class="token string">&quot;#msg&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">html</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>
window<span class="token punctuation">.</span>App <span class="token operator">=</span> App<span class="token punctuation">;</span>
window<span class="token punctuation">.</span><span class="token function">addEventListener</span><span class="token punctuation">(</span><span class="token string">&quot;load&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>window<span class="token punctuation">.</span>ethereum<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    App<span class="token punctuation">.</span>web3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web3</span><span class="token punctuation">(</span>window<span class="token punctuation">.</span>ethereum<span class="token punctuation">)</span><span class="token punctuation">;</span>
    window<span class="token punctuation">.</span>ethereum<span class="token punctuation">.</span><span class="token function">enable</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    console<span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span><span class="token string">&quot;Нет web3 провайдера!&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    App<span class="token punctuation">.</span>web3 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Web3</span><span class="token punctuation">(</span>
      <span class="token keyword">new</span> <span class="token class-name">Web3<span class="token punctuation">.</span>providers<span class="token punctuation">.</span>HttpProvider</span><span class="token punctuation">(</span><span class="token string">&quot;http://127.0.0.1:8545&quot;</span><span class="token punctuation">)</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  App<span class="token punctuation">.</span><span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><p>代码中优先使用 Mist 和 MetaMask 提供的 web3 实例，如果没有则从本地环境创建一个。
<strong>Voting.deployed()</strong> <code>Voting.deployed()</code>返回一个合约实例，truffle 的每一个调用会返回一个<code>promise</code>，所以使用<code>.then()</code>。</p> <h3 id="控制台交互"><a href="#控制台交互" class="header-anchor">#</a> 控制台交互</h3> <p>需要重新打开一个新的 console</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token operator">&gt;</span> truffle console
<span class="token operator">&gt;</span> Voting<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">contractInstance</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
  contractInstance<span class="token punctuation">.</span><span class="token function">voteForCandidate</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token operator">&gt;</span> Voting<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">contractInstance</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    contractInstance<span class="token punctuation">.</span><span class="token function">totalVotesFor</span>
      <span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">v</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="测试"><a href="#测试" class="header-anchor">#</a> 测试</h2> <p><strong>solidity 写单元测试</strong> <strong>JavaScript 写功能测试</strong></p> <h3 id="solidity"><a href="#solidity" class="header-anchor">#</a> solidity</h3> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// TestVoting.sol</span>
<span class="token comment">// SPDX-License-Identifier: MIT</span>
pragma solidity <span class="token operator">&gt;</span><span class="token number">0.4</span><span class="token number">.22</span> <span class="token operator">&lt;</span><span class="token number">0.6</span><span class="token number">.0</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;truffle/Assert.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;truffle/DeloyedAddress.sol&quot;</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">&quot;../contracts/Voting.sol&quot;</span><span class="token punctuation">;</span>
contract TestVoting <span class="token punctuation">{</span>
  uint <span class="token keyword">public</span> initialBalance <span class="token operator">=</span> <span class="token number">2</span> ether<span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">testInitialTokenBalanceUsingDeployedContract</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
    Voting voting <span class="token operator">=</span> <span class="token function">Voting</span><span class="token punctuation">(</span>DeployedAddresses<span class="token punctuation">.</span><span class="token function">Voting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    uint expected<span class="token operator">=</span> <span class="token number">10000</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>voting<span class="token punctuation">.</span><span class="token function">balanceTokens</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> expected<span class="token punctuation">,</span> <span class="token string">&quot;1000 Tokens not  initialized for sale&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">testBuyTokens</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">public</span> <span class="token punctuation">{</span>
    Voting voting <span class="token operator">=</span> <span class="token function">Voting</span><span class="token punctuation">(</span>DeployedAddresses<span class="token punctuation">.</span><span class="token function">Voting</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    voting<span class="token punctuation">.</span>buy<span class="token punctuation">.</span><span class="token function">value</span><span class="token punctuation">(</span><span class="token number">1</span> ether<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>voting<span class="token punctuation">.</span><span class="token function">balanceTokens</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">9900</span><span class="token punctuation">,</span> <span class="token string">&quot;9900 tokens should have been available&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><ul><li><code>Assert.sol</code>: 断言库，常用方法：<code>equal</code>,<code>notEqual</code>,<code>isAbove</code>,<code>isBelow</code>,<code>isAtLeast</code>,<code>isAtMost</code>,<code>isZero</code>,<code>isNotZero</code></li> <li><code>DeloyedAddress</code>: 一个 truffle 框架的帮助库，调用<code>DeployedAddress.()</code>即可获取部署合约的地址</li> <li><code>truffle test test/TestVoting.sol</code>运行测试</li></ul> <h3 id="javascript"><a href="#javascript" class="header-anchor">#</a> JavaScript</h3> <p>Truffle 使用了 Mocha 测试框架和 Chai 用于断言</p> <div class="language-js extra-class"><pre class="language-js"><code><span class="token comment">// voting.js</span>
<span class="token keyword">var</span> Voting <span class="token operator">=</span> artifacts<span class="token punctuation">.</span><span class="token function">require</span><span class="token punctuation">(</span><span class="token string">&quot;./Voting.sol&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token function">contract</span><span class="token punctuation">(</span><span class="token string">&quot;Voting&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">accounts</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should be able to buy tokens&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">var</span> tokensSold<span class="token punctuation">;</span>
    <span class="token keyword">var</span> userTokens<span class="token punctuation">;</span>
    <span class="token keyword">return</span> Voting<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        instance <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">.</span><span class="token function">bug</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
          value<span class="token operator">:</span> web3<span class="token punctuation">.</span><span class="token function">toWei</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;ether&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">.</span><span class="token function">tokensSold</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        tokensSold <span class="token operator">=</span> balance<span class="token punctuation">;</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">.</span><span class="token function">voterDetails</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokenDetails</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        userTokens <span class="token operator">=</span> tokenDetails<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>balance<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">&quot;100 tokens were not sold&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>userTokens<span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">100</span><span class="token punctuation">,</span> <span class="token string">&quot;100 tokens were not sold&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">&quot;should be able to vote for candidates&quot;</span><span class="token punctuation">,</span> <span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">var</span> instance<span class="token punctuation">;</span>
    <span class="token keyword">return</span> Voting<span class="token punctuation">.</span><span class="token function">deployed</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">i</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        instance <span class="token operator">=</span> i<span class="token punctuation">;</span>
        <span class="token keyword">return</span> i<span class="token punctuation">.</span><span class="token function">buy</span><span class="token punctuation">(</span><span class="token punctuation">{</span> value<span class="token operator">:</span> web3<span class="token punctuation">.</span><span class="token function">toWei</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">&quot;ether&quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">.</span><span class="token function">voteForCandidate</span><span class="token punctuation">(</span><span class="token string">&quot;Alice&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> instance<span class="token punctuation">.</span><span class="token function">voterDetails</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>web3<span class="token punctuation">.</span>eth<span class="token punctuation">.</span>accounts<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token keyword">function</span> <span class="token punctuation">(</span><span class="token parameter">tokenDetails</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        assert<span class="token punctuation">.</span><span class="token function">equal</span><span class="token punctuation">(</span>
          tokenDetails<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">valueOf</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token number">3</span><span class="token punctuation">,</span>
          <span class="token string">&quot;3 tokens were not used for voting to Alice&quot;</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><ul><li><code>truffle test test/voting.js</code></li></ul></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/blog_dev/区块链/基于Polkadot的跨链.html" class="prev">
        基于 Polkadot 的跨链
      </a></span> <span class="next"><a href="/blog_dev/区块链/如何获取DOT测试币.html">
        如何获取 DOT 测试币
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/blog_dev/assets/js/app.709da227.js" defer></script><script src="/blog_dev/assets/js/2.556b46b5.js" defer></script><script src="/blog_dev/assets/js/31.92bd6220.js" defer></script>
  </body>
</html>
