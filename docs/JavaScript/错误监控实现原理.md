# é”™è¯¯ç›‘æ§å®ç°åŸç†

```js
// jsé”™è¯¯ç›‘å¬
window.addEventListener('error', (event) => {
  const { message, filename, lineno, colno, error } = event;
});
// Promise æœªæ•è·é”™è¯¯
window.addEventListener('unhandledrejection', (event) => {
  const { reason } = event;
});
// èµ„æºåŠ è½½é”™è¯¯
window.addEventListener(
  'error',
  (event) => {
    if (event.target && event.target.tagName) {
      const tagName = event.target.tagName.toLowerCase();
      if (tagName === 'img' || tagName === 'script' || tagName === 'link') {
        // ä¸ŠæŠ¥èµ„æºåŠ è½½å¤±è´¥
      }
    }
  },
  true
);
```

## æ€§èƒ½æ•°æ®é‡‡é›†

### ğŸ“š API é€Ÿè®°å£è¯€

- **`getEntriesByType(type)`** - æŒ‰ç±»å‹è·å–æ€§èƒ½æ¡ç›®ï¼ˆæ ¸å¿ƒæ–¹æ³•ï¼‰
- **`navigation`** - å¯¼èˆª/é¡µé¢åŠ è½½æ€§èƒ½
- **`paint`** - ç»˜åˆ¶æ€§èƒ½ï¼ˆé¦–å±ç›¸å…³ï¼‰
- **`resource`** - èµ„æºåŠ è½½æ€§èƒ½
- **`PerformanceObserver`** - å®æ—¶ç›‘æ§æ€§èƒ½äº‹ä»¶

### 1. é¡µé¢åŠ è½½æ€§èƒ½ï¼ˆNavigation Timingï¼‰

**è®°å¿†ç‚¹ï¼š** `navigation` = æ•´ä¸ªé¡µé¢çš„åŠ è½½è¿‡ç¨‹ï¼Œä» DNS åˆ°é¡µé¢å®Œå…¨åŠ è½½

```js
// è·å–é¡µé¢å¯¼èˆªæ€§èƒ½æ•°æ®ï¼ˆæ•´ä¸ªé¡µé¢åŠ è½½è¿‡ç¨‹ï¼‰
const navigationTiming = performance.getEntriesByType('navigation')[0];

const {
  // DNS æŸ¥è¯¢é˜¶æ®µ
  domainLookupStart, // DNS æŸ¥è¯¢å¼€å§‹æ—¶é—´
  domainLookupEnd, // DNS æŸ¥è¯¢ç»“æŸæ—¶é—´ï¼ˆDNSæŸ¥è¯¢è€—æ—¶ = End - Startï¼‰

  // TCP è¿æ¥é˜¶æ®µ
  connectStart, // TCP è¿æ¥å¼€å§‹æ—¶é—´
  connectEnd, // TCP è¿æ¥ç»“æŸæ—¶é—´ï¼ˆTCPè¿æ¥è€—æ—¶ = End - Startï¼‰

  // è¯·æ±‚å“åº”é˜¶æ®µ
  requestStart, // è¯·æ±‚å¼€å§‹æ—¶é—´
  responseStart, // å“åº”å¼€å§‹æ—¶é—´ï¼ˆè¯·æ±‚å“åº”è€—æ—¶ = responseStart - requestStartï¼‰

  // DOM è§£æé˜¶æ®µ
  domContentLoadedEventEnd, // DOMContentLoaded äº‹ä»¶ç»“æŸæ—¶é—´ï¼ˆDOM è§£æå®Œæˆï¼‰
  loadEventEnd, // load äº‹ä»¶ç»“æŸæ—¶é—´ï¼ˆé¡µé¢å®Œå…¨åŠ è½½ï¼‰
} = navigationTiming;

// å¸¸ç”¨è®¡ç®—
const dnsTime = domainLookupEnd - domainLookupStart; // DNS æŸ¥è¯¢è€—æ—¶
const tcpTime = connectEnd - connectStart; // TCP è¿æ¥è€—æ—¶
const requestTime = responseStart - requestStart; // è¯·æ±‚å“åº”è€—æ—¶
const domReadyTime = domContentLoadedEventEnd; // DOM å°±ç»ªæ—¶é—´
const loadTime = loadEventEnd; // é¡µé¢å®Œå…¨åŠ è½½æ—¶é—´
```

### 2. é¦–å±æ€§èƒ½ï¼ˆPaint Timingï¼‰

**è®°å¿†ç‚¹ï¼š** `paint` = ç»˜åˆ¶ï¼Œå…³æ³¨é¦–å±æ¸²æŸ“æ—¶é—´

```js
// è·å–ç»˜åˆ¶æ€§èƒ½æ•°æ®ï¼ˆé¦–å±ç›¸å…³ï¼‰
const paintEntries = performance.getEntriesByType('paint');

// FP: First Paint - é¦–æ¬¡ç»˜åˆ¶ï¼ˆæµè§ˆå™¨å¼€å§‹ç»˜åˆ¶ï¼‰
const firstPaint = paintEntries.find((entry) => entry.name === 'first-paint');

// FCP: First Contentful Paint - é¦–æ¬¡å†…å®¹ç»˜åˆ¶ï¼ˆæœ‰å®é™…å†…å®¹æ¸²æŸ“ï¼‰
const firstContentfulPaint = paintEntries.find((entry) => entry.name === 'first-contentful-paint');

// ä½¿ç”¨ç¤ºä¾‹
if (firstPaint) {
  console.log('FP:', firstPaint.startTime); // é¦–æ¬¡ç»˜åˆ¶æ—¶é—´
}
if (firstContentfulPaint) {
  console.log('FCP:', firstContentfulPaint.startTime); // é¦–æ¬¡å†…å®¹ç»˜åˆ¶æ—¶é—´
}
```

### 3. èµ„æºåŠ è½½æ€§èƒ½ï¼ˆResource Timingï¼‰

**è®°å¿†ç‚¹ï¼š** `resource` = æ‰€æœ‰èµ„æºï¼ˆJSã€CSSã€å›¾ç‰‡ç­‰ï¼‰çš„åŠ è½½æƒ…å†µ

```js
// è·å–æ‰€æœ‰èµ„æºåŠ è½½æ€§èƒ½æ•°æ®
const resourceEntries = performance.getEntriesByType('resource');

resourceEntries.forEach((resource) => {
  const {
    name, // èµ„æº URL
    duration, // èµ„æºåŠ è½½æ€»è€—æ—¶
    transferSize, // ä¼ è¾“å¤§å°ï¼ˆåŒ…å«å“åº”å¤´ï¼‰
    encodedBodySize, // ç¼–ç åä¸»ä½“å¤§å°
    decodedBodySize, // è§£ç åä¸»ä½“å¤§å°
    initiatorType, // èµ„æºç±»å‹ï¼šscriptã€linkã€img ç­‰
  } = resource;

  // å¯ä»¥æŒ‰èµ„æºç±»å‹åˆ†ç±»ç»Ÿè®¡
  if (initiatorType === 'script') {
    // JS æ–‡ä»¶åŠ è½½æ€§èƒ½
  } else if (initiatorType === 'link') {
    // CSS æ–‡ä»¶åŠ è½½æ€§èƒ½
  }
});
```

### 4. é•¿ä»»åŠ¡ç›‘æ§ï¼ˆPerformance Observerï¼‰

**è®°å¿†ç‚¹ï¼š** `PerformanceObserver` = å®æ—¶ç›‘æ§ï¼Œç”¨äºç›‘å¬æ€§èƒ½äº‹ä»¶

```js
// ç›‘æ§é•¿ä»»åŠ¡ï¼ˆé˜»å¡ä¸»çº¿ç¨‹è¶…è¿‡ 50ms çš„ä»»åŠ¡ï¼‰
const observer = new PerformanceObserver((list) => {
  list.getEntries().forEach((entry) => {
    if (entry.duration > 50) {
      // ä¸ŠæŠ¥é•¿ä»»åŠ¡
      console.log('é•¿ä»»åŠ¡:', {
        name: entry.name,
        duration: entry.duration,
        startTime: entry.startTime,
      });
    }
  });
});

// å¼€å§‹è§‚å¯Ÿé•¿ä»»åŠ¡
observer.observe({ entryTypes: ['longtask'] });

// ä¹Ÿå¯ä»¥è§‚å¯Ÿå…¶ä»–ç±»å‹
// observer.observe({ entryTypes: ['paint', 'measure', 'navigation'] });
```

### ğŸ¯ è®°å¿†æŠ€å·§æ€»ç»“

1. **`getEntriesByType(type)`** - è¿™æ˜¯æ ¸å¿ƒæ–¹æ³•ï¼Œè®°ä½å®ƒå°±èƒ½è·å–å„ç§æ€§èƒ½æ•°æ®

   - `'navigation'` â†’ é¡µé¢åŠ è½½
   - `'paint'` â†’ é¦–å±ç»˜åˆ¶
   - `'resource'` â†’ èµ„æºåŠ è½½

2. **æ—¶é—´çº¿è®°å¿†æ³•ï¼š**

   ```
   DNSæŸ¥è¯¢ â†’ TCPè¿æ¥ â†’ è¯·æ±‚å“åº” â†’ DOMè§£æ â†’ é¡µé¢ç»˜åˆ¶ â†’ èµ„æºåŠ è½½
   ```

3. **å¸¸ç”¨æŒ‡æ ‡ï¼š**

   - **FP/FCP** - é¦–å±æ—¶é—´ï¼ˆç”¨æˆ·ä½“éªŒï¼‰
   - **DOM Ready** - DOM è§£æå®Œæˆ
   - **Load** - é¡µé¢å®Œå…¨åŠ è½½
   - **Duration** - è€—æ—¶ï¼ˆæ‰€æœ‰èµ„æºéƒ½æœ‰è¿™ä¸ªå±æ€§ï¼‰

4. **PerformanceObserver** - ç”¨äºå®æ—¶ç›‘æ§ï¼Œä¸æ˜¯ä¸€æ¬¡æ€§è·å–æ•°æ®
