# MPC é’±åŒ…å®Œæ•´å®ç°

åŸºäºå¤šæ–¹å®‰å…¨è®¡ç®—ï¼ˆMPCï¼‰çš„å»ä¸­å¿ƒåŒ–é’±åŒ…è§£å†³æ–¹æ¡ˆï¼ŒåŒ…å« TypeScript å®¢æˆ·ç«¯å’Œ Go æœåŠ¡ç«¯å®Œæ•´å®ç°ã€‚

## ğŸ“ é¡¹ç›®ç»“æ„

```
mpc_wallet_implementation/
â”œâ”€â”€ client-typescript/          # TypeScript å®¢æˆ·ç«¯å®ç°
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ types.ts           # ç±»å‹å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ crypto.ts          # åŠ å¯†å·¥å…·
â”‚   â”‚   â”œâ”€â”€ keyManager.ts      # å¯†é’¥ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ mpcClient.ts       # MPC å®¢æˆ·ç«¯æ ¸å¿ƒ
â”‚   â”‚   â”œâ”€â”€ example.ts         # ä½¿ç”¨ç¤ºä¾‹
â”‚   â”‚   â””â”€â”€ index.ts           # å…¥å£æ–‡ä»¶
â”‚   â”œâ”€â”€ package.json
â”‚   â””â”€â”€ tsconfig.json
â”‚
â”œâ”€â”€ server-go/                 # Go æœåŠ¡ç«¯å®ç°
â”‚   â”œâ”€â”€ api/                   # API å¤„ç†å™¨
â”‚   â”‚   â”œâ”€â”€ routes.go          # è·¯ç”±å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ wallet_handler.go # é’±åŒ…æ¥å£
â”‚   â”‚   â””â”€â”€ signature_handler.go # ç­¾åæ¥å£
â”‚   â”œâ”€â”€ service/               # ä¸šåŠ¡é€»è¾‘
â”‚   â”‚   â”œâ”€â”€ key_service.go     # å¯†é’¥æœåŠ¡
â”‚   â”‚   â””â”€â”€ signature_service.go # ç­¾åæœåŠ¡
â”‚   â”œâ”€â”€ crypto/                # åŠ å¯†å·¥å…·
â”‚   â”‚   â””â”€â”€ crypto.go
â”‚   â”œâ”€â”€ types/                 # ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ types.go
â”‚   â”œâ”€â”€ config/                # é…ç½®ç®¡ç†
â”‚   â”‚   â””â”€â”€ config.go
â”‚   â”œâ”€â”€ main.go               # æœåŠ¡å™¨å…¥å£
â”‚   â””â”€â”€ go.mod
â”‚
â”œâ”€â”€ README.md                 # æœ¬æ–‡ä»¶
â””â”€â”€ ARCHITECTURE.md           # æ¶æ„è¯´æ˜
```

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### å‰ç½®æ¡ä»¶

**å®¢æˆ·ç«¯ï¼ˆTypeScriptï¼‰ï¼š**
- Node.js >= 16.x
- npm æˆ– yarn

**æœåŠ¡ç«¯ï¼ˆGoï¼‰ï¼š**
- Go >= 1.21

---

### å®‰è£…ä¸è¿è¡Œ

#### 1ï¸âƒ£ å¯åŠ¨æœåŠ¡ç«¯ï¼ˆGoï¼‰

```bash
cd server-go

# ä¸‹è½½ä¾èµ–
go mod download

# è¿è¡ŒæœåŠ¡å™¨
go run main.go
```

æœåŠ¡å™¨å°†åœ¨ `http://localhost:8080` å¯åŠ¨ã€‚

#### 2ï¸âƒ£ å®‰è£…å¹¶è¿è¡Œå®¢æˆ·ç«¯ï¼ˆTypeScriptï¼‰

```bash
cd client-typescript

# å®‰è£…ä¾èµ–
npm install

# ç¼–è¯‘ TypeScript
npm run build

# è¿è¡Œç¤ºä¾‹
npm run dev
```

---

## ğŸ’¡ æ ¸å¿ƒåŠŸèƒ½

### âœ… å·²å®ç°åŠŸèƒ½

| åŠŸèƒ½ | å®¢æˆ·ç«¯ | æœåŠ¡ç«¯ | è¯´æ˜ |
|-----|-------|-------|------|
| **å¯†é’¥ç”Ÿæˆ** | âœ… | âœ… | å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯å„è‡ªç”Ÿæˆç§é’¥ç‰‡æ®µ |
| **è”åˆå…¬é’¥è®¡ç®—** | âœ… | âœ… | è®¡ç®—è”åˆå…¬é’¥å’Œé’±åŒ…åœ°å€ |
| **å¯†é’¥å­˜å‚¨ï¼ˆæ˜æ–‡ï¼‰** | âœ… | - | Base58 ç¼–ç å­˜å‚¨ |
| **å¯†é’¥å­˜å‚¨ï¼ˆåŠ å¯†ï¼‰** | âœ… | - | AES-256 åŠ å¯†å­˜å‚¨ |
| **å¯†é’¥æ¢å¤** | âœ… | - | æ”¯æŒæ˜æ–‡å’ŒåŠ å¯†æ¢å¤ |
| **äº¤æ˜“æ„é€ ** | âœ… | - | æ„é€ æ ‡å‡†äº¤æ˜“æ•°æ® |
| **MPC ç­¾å** | âœ… | âœ… | åŒæ–¹åä½œå®Œæˆç­¾å |
| **ç­¾åéªŒè¯** | âœ… | âœ… | éªŒè¯ç­¾åæœ‰æ•ˆæ€§ |
| **HTTP API** | - | âœ… | RESTful API æ¥å£ |

---

## ğŸ“– API æ–‡æ¡£

### æœåŠ¡ç«¯ API

#### 1. åˆ›å»ºé’±åŒ…

**POST** `/api/wallet/create`

**è¯·æ±‚ä½“ï¼š**
```json
{
  "pkUser": "å®¢æˆ·ç«¯å…¬é’¥ç‰‡æ®µï¼ˆåå…­è¿›åˆ¶ï¼‰"
}
```

**å“åº”ï¼š**
```json
{
  "address": "é’±åŒ…åœ°å€",
  "pkNode": "æœåŠ¡ç«¯å…¬é’¥ç‰‡æ®µï¼ˆåå…­è¿›åˆ¶ï¼‰",
  "pkAgg": "è”åˆå…¬é’¥ï¼ˆåå…­è¿›åˆ¶ï¼‰"
}
```

#### 2. è·å–é’±åŒ…ä¿¡æ¯

**POST** `/api/wallet/info`

**è¯·æ±‚ä½“ï¼š**
```json
{
  "pkUser": "å®¢æˆ·ç«¯å…¬é’¥ç‰‡æ®µï¼ˆåå…­è¿›åˆ¶ï¼‰"
}
```

**å“åº”ï¼š**
```json
{
  "address": "é’±åŒ…åœ°å€",
  "pkNode": "æœåŠ¡ç«¯å…¬é’¥ç‰‡æ®µ",
  "pkAgg": "è”åˆå…¬é’¥"
}
```

#### 3. ç­¾åè¯·æ±‚

**POST** `/api/signature/request`

**è¯·æ±‚ä½“ï¼š**
```json
{
  "txHash": "äº¤æ˜“å“ˆå¸Œ",
  "rUser": "å®¢æˆ·ç«¯ä¸´æ—¶å…¬é’¥ç‚¹",
  "address": "é’±åŒ…åœ°å€"
}
```

**å“åº”ï¼š**
```json
{
  "rNode": "æœåŠ¡ç«¯ä¸´æ—¶å…¬é’¥ç‚¹",
  "sNode": "æœåŠ¡ç«¯éƒ¨åˆ†ç­¾å",
  "r": "æœ€ç»ˆ r å€¼"
}
```

#### 4. åˆ—å‡ºæ‰€æœ‰é’±åŒ…

**GET** `/api/wallet/list`

**å“åº”ï¼š**
```json
{
  "count": 2,
  "wallets": [
    {
      "address": "...",
      "pkNode": "...",
      "pkAgg": "..."
    }
  ]
}
```

---

## ğŸ”§ ä½¿ç”¨ç¤ºä¾‹

### TypeScript å®¢æˆ·ç«¯ç¤ºä¾‹

```typescript
import { MPCWalletClient, MPCKeyManager } from 'mpc-wallet-client';

// 1. åˆ›å»ºå®¢æˆ·ç«¯å®ä¾‹
const client = new MPCWalletClient({
  serverUrl: 'http://localhost:8080',
  timeout: 30000,
});

// 2. åˆ›å»ºé’±åŒ…
const walletInfo = await client.createWallet();
console.log('é’±åŒ…åœ°å€:', walletInfo.address);

// 3. å¯¼å‡ºç§é’¥ï¼ˆåŠ å¯†æ–¹å¼ï¼‰
const password = 'MySecurePassword123';
const encryptedKey = client.exportPrivateKey(password);
console.log('åŠ å¯†ç§é’¥:', encryptedKey);

// 4. ç­¾åäº¤æ˜“
const transaction = {
  from: walletInfo.address,
  to: 'ç›®æ ‡åœ°å€',
  amount: '0.5',
  nonce: 1,
  gas: 21000,
  gasPrice: '20',
  chainId: 1,
};

const signature = await client.signTransaction(transaction);
console.log('ç­¾å:', signature);

// 5. éªŒè¯ç­¾å
const isValid = MPCWalletClient.verifySignature(
  transaction,
  signature,
  walletInfo.publicKey
);
console.log('ç­¾åæœ‰æ•ˆ:', isValid);
```

### Go æœåŠ¡ç«¯ç¤ºä¾‹

```go
package main

import (
    "mpc-wallet-server/service"
    "mpc-wallet-server/types"
)

func main() {
    // åˆ›å»ºæœåŠ¡
    keyService := service.NewKeyService()
    signService := service.NewSignatureService(keyService)
    
    // åˆ›å»ºé’±åŒ…
    wallet, _ := keyService.CreateWallet("å®¢æˆ·ç«¯å…¬é’¥")
    
    // å¤„ç†ç­¾åè¯·æ±‚
    req := &types.SignatureRequest{
        TxHash:  "äº¤æ˜“å“ˆå¸Œ",
        RUser:   "å®¢æˆ·ç«¯ä¸´æ—¶å…¬é’¥",
        Address: wallet.Address,
    }
    
    resp, _ := signService.ProcessSignatureRequest(req)
    println("ç­¾åå®Œæˆ:", resp.R, resp.SNode)
}
```

---

## ğŸ” å®‰å…¨ç‰¹æ€§

### âœ… æ ¸å¿ƒå®‰å…¨æœºåˆ¶

1. **æ— å®Œæ•´ç§é’¥å­˜åœ¨**
   - å®¢æˆ·ç«¯ç§é’¥ç‰‡æ®µï¼š`sk_user`
   - æœåŠ¡ç«¯ç§é’¥ç‰‡æ®µï¼š`sk_node`
   - å®Œæ•´ç§é’¥ï¼š`sk_agg = sk_user + sk_node`ï¼ˆä»ä¸è®¡ç®—ï¼‰

2. **åˆ†å¸ƒå¼ç­¾å**
   - å®¢æˆ·ç«¯è®¡ç®—ï¼š`s_user = (k_user Ã— h + r Ã— sk_user) mod n`
   - æœåŠ¡ç«¯è®¡ç®—ï¼š`s_node = (k_node Ã— h + r Ã— sk_node) mod n`
   - æœ€ç»ˆç­¾åï¼š`s = s_user + s_node`

3. **ä¸´æ—¶éšæœºæ•°ä¿æŠ¤**
   - æ¯æ¬¡ç­¾åç”Ÿæˆæ–°çš„éšæœºæ•° `k_user` å’Œ `k_node`
   - é˜²æ­¢éšæœºæ•°é‡ç”¨å¯¼è‡´ç§é’¥æ³„éœ²

4. **TLS åŠ å¯†ä¼ è¾“**
   - æ‰€æœ‰é€šä¿¡å¿…é¡»é€šè¿‡ HTTPS
   - é˜²æ­¢ä¸­é—´äººæ”»å‡»

5. **å¯†é’¥åŠ å¯†å­˜å‚¨**
   - æ”¯æŒ AES-256 åŠ å¯†
   - ä½¿ç”¨ PBKDF2 å¯†é’¥æ´¾ç”Ÿ
   - Base58 ç¼–ç ä¾¿äºå¤‡ä»½

---

## ğŸ¯ æ•°å­¦åŸç†

### æ¤­åœ†æ›²çº¿åŠ å¯†ï¼ˆEd25519ï¼‰

**åŸºç¡€å‚æ•°ï¼š**
- åŸºç‚¹ï¼š`G`ï¼ˆæ¤­åœ†æ›²çº¿æ ‡å‡†ç”Ÿæˆå…ƒï¼‰
- ç¾¤çš„é˜¶ï¼š`n`ï¼ˆæ›²çº¿ç¾¤çš„é˜¶ï¼‰

**å…¬é’¥è®¡ç®—ï¼š**
```
Pk_user = sk_user Ã— G
Pk_node = sk_node Ã— G
Pk_agg = Pk_user + Pk_node = (sk_user + sk_node) Ã— G
```

**ç­¾åç®—æ³•ï¼ˆMPC ç‰ˆæœ¬ï¼‰ï¼š**

1. **ä¸´æ—¶éšæœºæ•°ç”Ÿæˆï¼š**
   ```
   k = k_user + k_node
   R = k Ã— G = (k_user Ã— G) + (k_node Ã— G)
   r = R.x
   ```

2. **éƒ¨åˆ†ç­¾åè®¡ç®—ï¼š**
   ```
   s_user = (k_user Ã— h + r Ã— sk_user) mod n
   s_node = (k_node Ã— h + r Ã— sk_node) mod n
   ```

3. **ç­¾åèšåˆï¼š**
   ```
   s = (s_user + s_node) mod n
   ç­¾å = (r, s)
   ```

**éªŒè¯ï¼š**
```
éªŒè¯ç­‰å¼: s Ã— G = R + h Ã— Pk_agg
```

---

## ğŸ“Š æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     MPC é’±åŒ…æ¶æ„                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ã€å®¢æˆ·ç«¯ï¼ˆTypeScriptï¼‰ã€‘              ã€æœåŠ¡ç«¯ï¼ˆGoï¼‰ã€‘
        â”‚                                    â”‚
        â”‚ 1. ç”Ÿæˆ sk_user                    â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
        â”‚    å‘é€ Pk_user                    â”‚ 2. ç”Ÿæˆ sk_node
        â”‚                                    â”‚    è®¡ç®— Pk_agg
        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚    è¿”å› Pk_node, Pk_agg, åœ°å€      â”‚
        â”‚                                    â”‚
        â”‚                                    â”‚
ã€ç­¾åé˜¶æ®µã€‘                                 â”‚
        â”‚                                    â”‚
        â”‚ 3. ç”Ÿæˆ k_user                     â”‚
        â”‚    è®¡ç®— R_user                     â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
        â”‚    å‘é€ R_user, tx_hash            â”‚ 4. ç”Ÿæˆ k_node
        â”‚                                    â”‚    è®¡ç®— R_node
        â”‚                                    â”‚    è®¡ç®— s_node
        â”‚â—€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚    è¿”å› R_node, s_node, r          â”‚
        â”‚                                    â”‚
        â”‚ 5. è®¡ç®— s_user                     â”‚
        â”‚    èšåˆ s = s_user + s_node        â”‚
        â”‚                                    â”‚
        â”‚ 6. å¹¿æ’­äº¤æ˜“åˆ°åŒºå—é“¾                â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§ª æµ‹è¯•

### è¿è¡Œå®¢æˆ·ç«¯æµ‹è¯•

```bash
cd client-typescript
npm test
```

### è¿è¡ŒæœåŠ¡ç«¯æµ‹è¯•

```bash
cd server-go
go test ./...
```

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### å½“å‰å®ç°çš„é™åˆ¶

1. **ç®€åŒ–çš„æ¤­åœ†æ›²çº¿è¿ç®—**
   - å½“å‰ä½¿ç”¨äº†ç®€åŒ–çš„ç‚¹åŠ æ³•å®ç°
   - ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨å®Œæ•´çš„ edwards25519 åº“

2. **å†…å­˜å­˜å‚¨**
   - æœåŠ¡ç«¯å½“å‰ä½¿ç”¨å†…å­˜å­˜å‚¨é’±åŒ…ä¿¡æ¯
   - ç”Ÿäº§ç¯å¢ƒåº”ä½¿ç”¨æŒä¹…åŒ–æ•°æ®åº“ï¼ˆPostgreSQL, MySQL ç­‰ï¼‰

3. **æ— ç¾å¤‡æœºåˆ¶**
   - æœåŠ¡ç«¯å•ç‚¹æ•…éšœä¼šå¯¼è‡´æ— æ³•ç­¾å
   - åº”å®ç°å¤šèŠ‚ç‚¹å†—ä½™å’Œæ•…éšœè½¬ç§»

4. **ç¼ºå°‘é›¶çŸ¥è¯†è¯æ˜**
   - å½“å‰æœªéªŒè¯æœåŠ¡ç«¯æ˜¯å¦è¯šå®è®¡ç®—
   - åº”æ·»åŠ  ZK-SNARK æˆ– ZK-STARK è¯æ˜

### ç”Ÿäº§ç¯å¢ƒå»ºè®®

âœ… **å¿…é¡»å®ç°ï¼š**
- ä½¿ç”¨çœŸæ­£çš„ Ed25519 ç‚¹è¿ç®—åº“
- æŒä¹…åŒ–æ•°æ®åº“å­˜å‚¨
- HTTPS/TLS åŠ å¯†é€šä¿¡
- è®¿é—®æ§åˆ¶å’Œèº«ä»½éªŒè¯
- æ—¥å¿—å®¡è®¡å’Œç›‘æ§
- ç¾å¤‡å’Œå¤šèŠ‚ç‚¹éƒ¨ç½²
- é›¶çŸ¥è¯†è¯æ˜éªŒè¯

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Ed25519 ç­¾åç®—æ³•](https://ed25519.cr.yp.to/)
- [å¤šæ–¹å®‰å…¨è®¡ç®—ï¼ˆMPCï¼‰](https://en.wikipedia.org/wiki/Secure_multi-party_computation)
- [æ¤­åœ†æ›²çº¿å¯†ç å­¦](https://en.wikipedia.org/wiki/Elliptic-curve_cryptography)
- [BIP-32 HD é’±åŒ…](https://github.com/bitcoin/bips/blob/master/bip-0032.mediawiki)

---

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

---

## ğŸ“„ è®¸å¯è¯

MIT License

---

## ğŸ‘¨â€ğŸ’» ä½œè€…

Faypay å›¢é˜Ÿ

---

## ğŸ“ è”ç³»æ–¹å¼

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è”ç³»æŠ€æœ¯å›¢é˜Ÿã€‚

